(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7097],{3998:(e,t,s)=>{"use strict";s.d(t,{$:()=>n});var a=s(95155),r=s(12115),l=s(75889),i=s(2821);let n=(0,r.forwardRef)((e,t)=>{let{className:s,variant:r="primary",size:n="md",fullWidth:o,...c}=e;return(0,a.jsx)("button",{ref:t,className:(0,l.QP)((0,i.$)("btn",{primary:"btn-primary",secondary:"btn-outline",ghost:"hover:bg-[color:var(--muted-bg)]",outline:"btn-outline"}[r],{sm:"px-3 py-1 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"}[n],o&&"w-full"),s),...c})});n.displayName="Button"},7613:(e,t,s)=>{Promise.resolve().then(s.bind(s,12126))},12126:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var a=s(95155),r=s(12115),l=s(99018),i=s(3998),n=s(65142),o=s(22663),c=s(33678),d=s(72473),m=s(50569),u=s(55172);function g(e){let{clientName:t,progressData:l,onExport:n,isLoading:o=!1,siteName:c="GZnutrition"}=e,[d,m]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await Promise.all([s.e(5647),s.e(5568)]).then(s.bind(s,46995));p(()=>e.Chart)}catch(e){console.error("Errore caricamento Chart.js:",e)}})()},[]);let b=async function(e){var t,s,a,r,l,i;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:400;if(!h)throw Error("Chart.js non caricato");let c=document.createElement("canvas");c.width=n,c.height=o,c.style.backgroundColor="#ffffff";let d=c.getContext("2d");d.fillStyle="#ffffff",d.fillRect(0,0,n,o);let m=new h(d,{...e,options:{...e.options,responsive:!1,animation:!1,plugins:{...null==(t=e.options)?void 0:t.plugins,legend:{...null==(a=e.options)||null==(s=a.plugins)?void 0:s.legend,display:(null==(i=e.options)||null==(l=i.plugins)||null==(r=l.legend)?void 0:r.display)!==!1}}}});await new Promise(e=>setTimeout(e,100));let u=c.toDataURL("image/jpeg",.9);return m.destroy(),u},f=async()=>{if(!h)return void alert("Chart.js non ancora caricato, riprova tra qualche secondo");x(!0);try{let e=l.map(e=>new Date(e.date).toLocaleDateString("it-IT")),s=l.map(e=>e.weight||null),a=l.map(e=>e.bodyFat||null),r=l.map(e=>e.muscleMass||null),i=l.map(e=>{var t;return(null==(t=e.measurements)?void 0:t.waist)||null}),n=l.map(e=>{var t;return(null==(t=e.measurements)?void 0:t.chest)||null}),o=l.map(e=>{var t;return(null==(t=e.measurements)?void 0:t.hipCircumference)||null});for(let l of[{name:"andamento-peso",title:"Andamento Peso",config:{type:"line",data:{labels:e,datasets:[{label:"Peso (kg)",data:s,borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.2,fill:!0,pointRadius:4,borderWidth:3}]},options:{plugins:{legend:{display:!1},title:{display:!0,text:"Andamento Peso - ".concat(t),font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!1},x:{ticks:{maxTicksLimit:8},grid:{display:!0}}}}}},{name:"massa-grassa",title:"Massa Grassa",config:{type:"line",data:{labels:e,datasets:[{label:"Massa Grassa (%)",data:a,borderColor:"#EF4444",backgroundColor:"rgba(239, 68, 68, 0.1)",tension:.2,fill:!0,pointRadius:4,borderWidth:3}]},options:{plugins:{legend:{display:!1},title:{display:!0,text:"Massa Grassa - ".concat(t),font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!1},x:{ticks:{maxTicksLimit:8},grid:{display:!0}}}}}},{name:"massa-muscolare",title:"Massa Muscolare",config:{type:"line",data:{labels:e,datasets:[{label:"Massa Muscolare (kg)",data:r,borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.2,fill:!0,pointRadius:4,borderWidth:3}]},options:{plugins:{legend:{display:!1},title:{display:!0,text:"Massa Muscolare - ".concat(t),font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!1},x:{ticks:{maxTicksLimit:8},grid:{display:!0}}}}}},{name:"misurazioni-corporee",title:"Misurazioni Corporee",config:{type:"line",data:{labels:e,datasets:[{label:"Vita (cm)",data:i,borderColor:"#8B5CF6",backgroundColor:"rgba(139, 92, 246, 0.1)",tension:.2,pointRadius:4,borderWidth:3},{label:"Petto (cm)",data:n,borderColor:"#F59E0B",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.2,pointRadius:4,borderWidth:3},{label:"Fianchi (cm)",data:o,borderColor:"#06B6D4",backgroundColor:"rgba(6, 182, 212, 0.1)",tension:.2,pointRadius:4,borderWidth:3}]},options:{plugins:{legend:{display:!0,position:"bottom",labels:{padding:20,font:{size:12}}},title:{display:!0,text:"Misurazioni Corporee - ".concat(t),font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!1},x:{ticks:{maxTicksLimit:8},grid:{display:!0}}}}}}]){let e=await b(l.config,1200,600),s=document.createElement("a");s.download="grafico-".concat(l.name,"-").concat(t.replace(/\s+/g,"-").toLowerCase(),".jpg"),s.href=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),await new Promise(e=>setTimeout(e,500))}x(!1)}catch(e){console.error("Errore download grafici:",e),x(!1)}},v=async()=>{m(!0);try{let o=new u.Ay({orientation:"portrait",unit:"mm",format:"a4",compress:!0});o.setProperties({title:"Report Progressi - ".concat(t),subject:"Report progressi cliente",author:c,creator:"PDF Generator",keywords:"nutrition, progress, report"});let d=o.internal.pageSize.getWidth(),g=o.internal.pageSize.getHeight(),x=20;if(o.setFontSize(20),o.setTextColor(0,0,0),o.text("Report Progressi Cliente",d/2,x,{align:"center"}),x+=15,o.setFontSize(10),o.setTextColor(100,100,100),o.text("Generato il ".concat(new Date().toLocaleDateString("it-IT")," - ").concat(c),d/2,x,{align:"center"}),x+=20,o.setDrawColor(0,0,0),o.setLineWidth(.5),o.line(20,x,d-20,x),x+=15,o.setFontSize(14),o.setTextColor(0,0,0),o.text("Informazioni Cliente",20,x),x+=10,o.setFontSize(11),o.setTextColor(0,0,0),o.text("Nome: ".concat(t),20,x),x+=7,o.text("Data Report: ".concat(new Date().toLocaleDateString("it-IT")),20,x),x+=7,o.text("Progressi Registrati: ".concat(l.length),20,x),x+=15,l.length>0){o.setFontSize(14),o.setTextColor(0,0,0),o.text("Storico Progressi",20,x),x+=10,o.setFontSize(9),o.setTextColor(0,0,0),o.text("Data",20,x),o.text("Peso (kg)",45,x),o.text("Massa Grassa (%)",70,x),o.text("Massa Muscolare (kg)",100,x),o.text("Vita (cm)",135,x),x+=8,o.setDrawColor(200,200,200),o.setLineWidth(.2),o.line(20,x,d-20,x),x+=5;let t=Math.min(12,l.length);for(let n=0;n<t;n++){var e,s,a,r,i;let t=l[n];o.setFontSize(8),o.setTextColor(0,0,0);let c=new Date(t.date).toLocaleDateString("it-IT"),d=(null==(e=t.weight)?void 0:e.toString())||"-",m=(null==(s=t.bodyFat)?void 0:s.toString())||"-",u=(null==(a=t.muscleMass)?void 0:a.toString())||"-",g=(null==(i=t.measurements)||null==(r=i.waist)?void 0:r.toString())||"-";o.text(c,20,x),o.text(d,45,x),o.text(m,70,x),o.text(u,100,x),o.text(g,135,x),x+=6}x+=10}o.setFontSize(12),o.setTextColor(0,0,0),o.text("Grafici Progressi",20,x),x+=8,o.setFontSize(9),o.setTextColor(100,100,100),o.text("I grafici sono disponibili come immagini JPEG separate.",20,x),x+=5,o.text('Utilizza il pulsante "Scarica Grafici" per ottenerli.',20,x),x+=15,o.setFontSize(8),o.setTextColor(150,150,150),o.text("Report generato automaticamente da ".concat(c),d/2,g-15,{align:"center"}),o.text("Formato PDF/A per massima compatibilit\xe0",d/2,g-10,{align:"center"}),o.save("report-progressi-".concat(t.replace(/\s+/g,"-").toLowerCase(),".pdf")),m(!1),null==n||n()}catch(e){console.error("Error generating PDF:",e),m(!1)}};return(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)(i.$,{onClick:v,disabled:o||d,className:"bg-red-600 hover:bg-red-700 text-white",children:d?"⏳ Generando PDF...":"\uD83D\uDCC4 Export PDF"}),(0,a.jsx)(i.$,{onClick:f,disabled:o||g||!h,className:"bg-blue-600 hover:bg-blue-700 text-white",children:g?"⏳ Scaricando Grafici...":"\uD83D\uDCCA Scarica Grafici"})]})}function x(e){var t,s,l,o,c;let{client:u,progressData:x=[],onSave:h,onExportPDF:p}=e,[b,f]=(0,r.useState)(!1),[v,j]=(0,r.useState)({date:(0,d.GP)(new Date,"yyyy-MM-dd"),weight:void 0,bodyFat:void 0,muscleMass:void 0,measurements:{},notes:"",photos:[]}),y=async()=>{try{await h(u.id,v),f(!1),j({date:(0,d.GP)(new Date,"yyyy-MM-dd"),weight:void 0,bodyFat:void 0,muscleMass:void 0,measurements:{},notes:"",photos:[]})}catch(e){console.error("Error saving progress:",e)}};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:u.name.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:u.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:u.email}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:u.phone})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"prospect":return"bg-blue-100 text-blue-800"}})(u.status)),children:(e=>{switch(e){case"active":return"Attivo";case"inactive":return"Inattivo";case"prospect":return"Prospect";default:return e}})(u.status)}),(0,a.jsx)(g,{clientName:u.name,progressData:x,onExport:()=>p(u.id)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Cliente dal"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:(0,d.GP)(new Date(u.createdAt),"dd MMM yyyy",{locale:m.it})})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Ultimo aggiornamento"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:x.length>0?(0,d.GP)(new Date(x[0].date),"dd/MM/yyyy",{locale:m.it}):"-"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Progressi registrati"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:x.length})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"\uD83D\uDCC8 Storico Progressi"}),(0,a.jsx)(i.$,{onClick:()=>f(!b),size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:b?"Annulla":"+ Nuovo Progresso"})]}),b&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[(0,a.jsx)("h5",{className:"font-medium text-blue-900 mb-3",children:"Aggiungi Nuovo Progresso"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data"}),(0,a.jsx)(n.p,{type:"date",value:v.date,onChange:e=>j(t=>({...t,date:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso (kg)"}),(0,a.jsx)(n.p,{type:"number",step:"0.1",placeholder:"es. 70.5",value:v.weight||"",onChange:e=>j(t=>({...t,weight:e.target.value?parseFloat(e.target.value):void 0}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Massa Grassa (%)"}),(0,a.jsx)(n.p,{type:"number",step:"0.1",placeholder:"es. 15.2",value:v.bodyFat||"",onChange:e=>j(t=>({...t,bodyFat:e.target.value?parseFloat(e.target.value):void 0}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Massa Muscolare (kg)"}),(0,a.jsx)(n.p,{type:"number",step:"0.1",placeholder:"es. 35.8",value:v.muscleMass||"",onChange:e=>j(t=>({...t,muscleMass:e.target.value?parseFloat(e.target.value):void 0}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vita (cm)"}),(0,a.jsx)(n.p,{type:"number",step:"0.1",placeholder:"es. 85.0",value:(null==(t=v.measurements)?void 0:t.waist)||"",onChange:e=>j(t=>({...t,measurements:{...t.measurements,waist:e.target.value?parseFloat(e.target.value):void 0}}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Petto (cm)"}),(0,a.jsx)(n.p,{type:"number",step:"0.1",placeholder:"es. 95.0",value:(null==(s=v.measurements)?void 0:s.chest)||"",onChange:e=>j(t=>({...t,measurements:{...t.measurements,chest:e.target.value?parseFloat(e.target.value):void 0}}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Circonferenza Fianchi (cm)"}),(0,a.jsx)(n.p,{type:"number",step:"0.1",placeholder:"es. 95.0",value:(null==(l=v.measurements)?void 0:l.hipCircumference)||"",onChange:e=>j(t=>({...t,measurements:{...t.measurements,hipCircumference:e.target.value?parseFloat(e.target.value):void 0}}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Circonferenza Bicipite (cm)"}),(0,a.jsx)(n.p,{type:"number",step:"0.1",placeholder:"es. 35.0",value:(null==(o=v.measurements)?void 0:o.bicepCircumference)||"",onChange:e=>j(t=>({...t,measurements:{...t.measurements,bicepCircumference:e.target.value?parseFloat(e.target.value):void 0}}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Circonferenza Coscia (cm)"}),(0,a.jsx)(n.p,{type:"number",step:"0.1",placeholder:"es. 60.0",value:(null==(c=v.measurements)?void 0:c.thighCircumference)||"",onChange:e=>j(t=>({...t,measurements:{...t.measurements,thighCircumference:e.target.value?parseFloat(e.target.value):void 0}}))})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note"}),(0,a.jsx)("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Note aggiuntive sui progressi...",value:v.notes||"",onChange:e=>j(t=>({...t,notes:e.target.value}))})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,a.jsx)(i.$,{onClick:y,className:"bg-green-600 hover:bg-green-700",children:"\uD83D\uDCBE Salva Progresso"}),(0,a.jsx)(i.$,{onClick:()=>f(!1),variant:"outline",children:"Annulla"})]})]}),x.length>0?(0,a.jsx)("div",{className:"space-y-3",children:x.map((e,t)=>{var s,r,l,i,n;return(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(0,d.GP)(new Date(e.date),"dd MMM yyyy",{locale:m.it})})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 text-sm",children:[e.weight&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Peso:"}),(0,a.jsxs)("span",{className:"ml-1 font-medium",children:[e.weight," kg"]})]}),e.bodyFat&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Massa Grassa:"}),(0,a.jsxs)("span",{className:"ml-1 font-medium",children:[e.bodyFat,"%"]})]}),e.muscleMass&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Massa Muscolare:"}),(0,a.jsxs)("span",{className:"ml-1 font-medium",children:[e.muscleMass," kg"]})]}),(null==(s=e.measurements)?void 0:s.waist)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Vita:"}),(0,a.jsxs)("span",{className:"ml-1 font-medium",children:[e.measurements.waist," cm"]})]}),(null==(r=e.measurements)?void 0:r.chest)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Petto:"}),(0,a.jsxs)("span",{className:"ml-1 font-medium",children:[e.measurements.chest," cm"]})]}),(null==(l=e.measurements)?void 0:l.hipCircumference)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Fianchi:"}),(0,a.jsxs)("span",{className:"ml-1 font-medium",children:[e.measurements.hipCircumference," cm"]})]}),(null==(i=e.measurements)?void 0:i.bicepCircumference)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Bicipite:"}),(0,a.jsxs)("span",{className:"ml-1 font-medium",children:[e.measurements.bicepCircumference," cm"]})]}),(null==(n=e.measurements)?void 0:n.thighCircumference)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Coscia:"}),(0,a.jsxs)("span",{className:"ml-1 font-medium",children:[e.measurements.thighCircumference," cm"]})]})]}),e.notes&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"Note:"})," ",e.notes]})]},e.id||t)})}):(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-gray-600 text-center py-8",children:"\uD83D\uDCCA Nessun progresso registrato ancora. Aggiungi il primo per iniziare a tracciare i risultati!"})})]}),u.notes&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"\uD83D\uDCDD Note Cliente"}),(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-gray-700",children:u.notes})})]})]})}function h(e){let{data:t,type:s,onExportPDF:l}=e,n=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!n.current||0===t.length)return;let e=n.current,a=e.getContext("2d");if(!a)return;e.width=2*e.offsetWidth,e.height=2*e.offsetHeight,a.scale(2,2),a.clearRect(0,0,e.offsetWidth,e.offsetHeight);let r=e.offsetWidth-60-20,l=e.offsetHeight-20-40,i=t.filter(e=>{switch(s){case"weight":return void 0!==e.weight;case"bodyFat":return void 0!==e.bodyFat;case"muscleMass":return void 0!==e.muscleMass;case"measurements":return e.measurements&&(e.measurements.waist||e.measurements.chest);default:return!1}}).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());if(0===i.length){a.fillStyle="#6B7280",a.font="16px Arial",a.textAlign="center",a.fillText("Nessun dato disponibile",e.offsetWidth/2,e.offsetHeight/2);return}let c=i.map(e=>{switch(s){case"weight":return e.weight;case"bodyFat":return e.bodyFat;case"muscleMass":return e.muscleMass;case"measurements":var t,a;return(null==(t=e.measurements)?void 0:t.waist)||(null==(a=e.measurements)?void 0:a.chest)||0;default:return 0}}),d=Math.min(...c),m=Math.max(...c),u=m-d,g=.1*u,x=e=>60+e/(i.length-1)*r,h=e=>20+l-(e-d+g)/(u+2*g)*l;a.strokeStyle="#E5E7EB",a.lineWidth=1,a.beginPath(),a.moveTo(60,20),a.lineTo(60,20+l),a.stroke(),a.beginPath(),a.moveTo(60,20+l),a.lineTo(60+r,20+l),a.stroke(),a.strokeStyle="#F3F4F6",a.lineWidth=.5;for(let e=0;e<=5;e++){let t=20+e/5*l;a.beginPath(),a.moveTo(60,t),a.lineTo(60+r,t),a.stroke()}a.strokeStyle="#3B82F6",a.lineWidth=3,a.beginPath(),i.forEach((e,t)=>{let s=x(t),r=h(c[t]);0===t?a.moveTo(s,r):a.lineTo(s,r)}),a.stroke(),a.fillStyle="#3B82F6",i.forEach((e,t)=>{let s=x(t),r=h(c[t]);a.beginPath(),a.arc(s,r,4,0,2*Math.PI),a.fill()}),a.fillStyle="#374151",a.font="12px Arial",a.textAlign="center";for(let e=0;e<=5;e++){let t=d+(m-d)*(1-e/5),s=20+e/5*l;a.fillText(t.toFixed(1),50,s+4)}i.forEach((e,t)=>{if(t%Math.ceil(i.length/5)==0){let s=x(t),r=new Date(e.date),i="".concat(r.getDate(),"/").concat(r.getMonth()+1);a.fillText(i,s,20+l+20)}}),a.fillStyle="#111827",a.font="bold 16px Arial",a.textAlign="center";let p=o(s);a.fillText(p,e.offsetWidth/2,20)},[t,s]);let o=e=>{switch(e){case"weight":return"Andamento Peso (kg)";case"bodyFat":return"Massa Grassa (%)";case"muscleMass":return"Massa Muscolare (kg)";case"measurements":return"Misure Corporee (cm)";default:return"Grafico Progressi"}};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:o(s)}),(0,a.jsx)(i.$,{onClick:l,size:"sm",className:"bg-red-600 hover:bg-red-700",children:"\uD83D\uDCC4 Export PDF"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("canvas",{ref:n,className:"w-full h-64 border border-gray-200 rounded-lg",style:{maxHeight:"400px"}}),0===t.length&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 rounded-lg",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCA"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Nessun dato disponibile"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Aggiungi progressi per visualizzare il grafico"})]})})]})]})}function p(){let[e,t]=(0,r.useState)([]),[s,m]=(0,r.useState)([]),[u,g]=(0,r.useState)([]),[p,b]=(0,r.useState)(!0),[f,v]=(0,r.useState)("list"),[j,y]=(0,r.useState)(null),[N,C]=(0,r.useState)(""),[w,D]=(0,r.useState)({}),k=async()=>{try{let[e,s,a]=await Promise.all([(0,l.by)(),(0,l.G9)(),(0,l.ZY)()]);t(e),m(s),g(a);let r=e.map(async e=>{if(e.id){let t=await (0,l.HG)(e.id);return{clientId:e.id,progress:t}}return null}),i=await Promise.all(r),n={};i.forEach(e=>{e&&(n[e.clientId]=e.progress)}),D(n)}catch(e){console.error("Error loading data:",e),o.toast.error("Errore nel caricamento dei dati")}finally{b(!1)}};(0,r.useEffect)(()=>{k()},[]);let F=async(e,t)=>{try{let s={id:await (0,l.u2)({clientId:e,...t}),clientId:e,...t,createdAt:new Date().toISOString()};D(t=>({...t,[e]:[s,...t[e]||[]]})),o.toast.success("Progresso salvato con successo!")}catch(e){console.error("Error saving progress:",e),o.toast.error("Errore nel salvare il progresso")}},M=async t=>{try{let s=e.find(e=>e.id===t);if(!s)return;let a=w[t]||[],r=await (0,l.fH)(),i=(null==r?void 0:r.siteName)||"GZnutrition",n=window.open("","_blank");if(!n)return;let o=new Date().toLocaleDateString("it-IT"),c='\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <meta charset="UTF-8">\n            <title>Report Progressi - '.concat(s.name,'</title>\n            <style>\n              body { font-family: Arial, sans-serif; margin: 20px; }\n              .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #3B82F6; padding-bottom: 20px; }\n              .client-info { background: #F9FAFB; padding: 20px; border-radius: 8px; margin-bottom: 30px; }\n              .progress-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n              .progress-table th, .progress-table td { border: 1px solid #D1D5DB; padding: 12px; text-align: left; }\n              .progress-table th { background: #F3F4F6; font-weight: bold; }\n              .footer { margin-top: 40px; text-align: center; color: #6B7280; font-size: 12px; }\n            </style>\n          </head>\n          <body>\n            <div class="header">\n              <h1>\uD83D\uDCCA Report Progressi Cliente</h1>\n              <p>Generato il ').concat(o," - ").concat(i,'</p>\n            </div>\n            <div class="client-info">\n              <h2>\uD83D\uDC64 ').concat(s.name,"</h2>\n              <p><strong>Email:</strong> ").concat(s.email,"</p>\n              <p><strong>Telefono:</strong> ").concat(s.phone,"</p>\n            </div>\n            ").concat(a.length>0?'\n              <h2>\uD83D\uDCC8 Storico Progressi</h2>\n              <table class="progress-table">\n                <thead>\n                  <tr>\n                    <th>Data</th>\n                    <th>Peso (kg)</th>\n                    <th>Massa Grassa (%)</th>\n                    <th>Massa Muscolare (kg)</th>\n                    <th>Vita (cm)</th>\n                    <th>Petto (cm)</th>\n                    <th>Fianchi (cm)</th>\n                    <th>Bicipite (cm)</th>\n                    <th>Coscia (cm)</th>\n                    <th>Note</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  '.concat(a.map(e=>{var t,s,a,r,l;return"\n                    <tr>\n                      <td>".concat(new Date(e.date).toLocaleDateString("it-IT"),"</td>\n                      <td>").concat(e.weight||"-","</td>\n                      <td>").concat(e.bodyFat||"-","</td>\n                      <td>").concat(e.muscleMass||"-","</td>\n                      <td>").concat((null==(t=e.measurements)?void 0:t.waist)||"-","</td>\n                      <td>").concat((null==(s=e.measurements)?void 0:s.chest)||"-","</td>\n                      <td>").concat((null==(a=e.measurements)?void 0:a.hipCircumference)||"-","</td>\n                      <td>").concat((null==(r=e.measurements)?void 0:r.bicepCircumference)||"-","</td>\n                      <td>").concat((null==(l=e.measurements)?void 0:l.thighCircumference)||"-","</td>\n                      <td>").concat(e.notes||"-","</td>\n                    </tr>\n                  ")}).join(""),"\n                </tbody>\n              </table>\n            "):"<p>Nessun progresso registrato ancora.</p>",'\n            <div class="footer">\n              <p>Report generato automaticamente da ').concat(i,"</p>\n            </div>\n          </body>\n        </html>\n      ");n.document.write(c),n.document.close(),n.onload=()=>{setTimeout(()=>{n.print(),n.close()},500)}}catch(e){console.error("Error exporting PDF:",e),o.toast.error("Errore nell'export del PDF")}},P=()=>{y({name:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),id:crypto.randomUUID()}),v("create")},S=async e=>{try{await (0,l.TP)(e),o.toast.success("Cliente salvato con successo!"),await k(),v("list"),y(null)}catch(e){console.error("Error saving client:",e),o.toast.error("Errore nel salvare il cliente")}},E=async e=>{if(window.confirm("Sei sicuro di voler eliminare questo cliente? Questa azione non pu\xf2 essere annullata."))try{await (0,l.zZ)(e),o.toast.success("Cliente eliminato con successo!"),await k(),"detail"===f&&(v("list"),y(null))}catch(e){console.error("Error deleting client:",e),o.toast.error("Errore nell'eliminazione del cliente")}},z=(e,t,s)=>{if(!j)return;let a={id:crypto.randomUUID(),name:"".concat(t,"_").concat((0,d.GP)(new Date,"yyyy-MM-dd")),url:s,type:t,uploadedAt:new Date().toISOString()},r={...j,documents:[...j.documents||[],a]};y(r),S(r)},T=e.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())||e.email.toLowerCase().includes(N.toLowerCase()));if(p)return(0,a.jsxs)("main",{className:"container py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Gestione Clienti"}),(0,a.jsx)("p",{className:"mt-4 text-foreground/70",children:"Caricamento..."})]});let A=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=w[e.id]||[];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(i.$,{onClick:()=>{v("list"),y(null)},variant:"outline",size:"sm",className:"hover:bg-white",children:"← Torna alla Lista"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:t?"➕ Nuovo Cliente":"\uD83D\uDC64 Dettaglio Cliente"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:t?"Compila i campi obbligatori per aggiungere un nuovo cliente":"Gestisci le informazioni e i progressi del cliente"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.$,{onClick:()=>S(e),className:"bg-green-600 hover:bg-green-700 shadow-lg",children:["\uD83D\uDCBE Salva ",t?"Cliente":"Modifiche"]}),!t&&(0,a.jsx)(i.$,{onClick:()=>E(e.id),className:"bg-red-600 hover:bg-red-700 shadow-lg",children:"\uD83D\uDDD1️ Elimina"})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"\uD83D\uDCCB Informazioni Base"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"I campi contrassegnati con * sono obbligatori"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nome Completo *"}),(0,a.jsx)(n.p,{value:e.name,onChange:t=>y({...e,name:t.target.value}),placeholder:"es. Mario Rossi",className:"w-full",required:!0}),!e.name&&t&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:"⚠️ Il nome \xe8 obbligatorio"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email *"}),(0,a.jsx)(n.p,{type:"email",value:e.email,onChange:t=>y({...e,email:t.target.value}),placeholder:"es. mario.rossi@email.com",className:"w-full",required:!0}),!e.email&&t&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:"⚠️ L'email \xe8 obbligatoria"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Telefono *"}),(0,a.jsx)(n.p,{type:"tel",value:e.phone,onChange:t=>y({...e,phone:t.target.value}),placeholder:"es. +39 123 456 7890",className:"w-full",required:!0}),!e.phone&&t&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:"⚠️ Il telefono \xe8 obbligatorio"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Stato Cliente"}),(0,a.jsxs)("select",{value:e.status||"active",onChange:t=>y({...e,status:t.target.value}),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"active",children:"\uD83D\uDFE2 Attivo"}),(0,a.jsx)("option",{value:"inactive",children:"\uD83D\uDD34 Inattivo"}),(0,a.jsx)("option",{value:"pending",children:"\uD83D\uDFE1 In Attesa"})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Note Aggiuntive"}),(0,a.jsx)("textarea",{value:e.notes||"",onChange:t=>y({...e,notes:t.target.value}),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Note aggiuntive sul cliente, obiettivi, preferenze..."})]}),t&&(0,a.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-blue-900",children:"Completamento Form:"}),(0,a.jsxs)("span",{className:"text-sm text-blue-700",children:[[e.name,e.email,e.phone].filter(Boolean).length,"/3 campi obbligatori"]})]}),(0,a.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat([e.name,e.email,e.phone].filter(Boolean).length/3*100,"%")}})}),3===[e.name,e.email,e.phone].filter(Boolean).length&&(0,a.jsx)("p",{className:"text-xs text-green-700 mt-2",children:"✅ Form completo! Puoi salvare il cliente."})]})]}),(0,a.jsx)(x,{client:{id:e.id||"",name:e.name||"",email:e.email||"",phone:e.phone||"",status:"active",notes:e.notes||"",createdAt:e.createdAt||new Date().toISOString()},progressData:s,onSave:F,onExportPDF:M}),s.length>0&&(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsx)(h,{data:s,type:"weight",onExportPDF:()=>M(e.id)}),(0,a.jsx)(h,{data:s,type:"bodyFat",onExportPDF:()=>M(e.id)}),(0,a.jsx)(h,{data:s,type:"muscleMass",onExportPDF:()=>M(e.id)}),(0,a.jsx)(h,{data:s,type:"measurements",onExportPDF:()=>M(e.id)})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:(0,a.jsxs)("details",{className:"group",children:[(0,a.jsxs)("summary",{className:"cursor-pointer text-lg font-semibold text-gray-900 mb-4 list-none",children:[(0,a.jsx)("span",{className:"group-open:hidden",children:"\uD83D\uDCCB Mostra Informazioni Dettagliate"}),(0,a.jsx)("span",{className:"hidden group-open:inline",children:"\uD83D\uDCCB Nascondi Informazioni Dettagliate"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"\uD83D\uDC64 Informazioni Base"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nome Completo *"}),(0,a.jsx)(n.p,{value:e.name,onChange:t=>y({...e,name:t.target.value}),placeholder:"es. Mario Rossi"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Email *"}),(0,a.jsx)(n.p,{type:"email",value:e.email,onChange:t=>y({...e,email:t.target.value}),placeholder:"es. mario.rossi@email.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Telefono *"}),(0,a.jsx)(n.p,{type:"tel",value:e.phone,onChange:t=>y({...e,phone:t.target.value}),placeholder:"es. +39 123 456 7890"})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Note"}),(0,a.jsx)("textarea",{value:e.notes,onChange:t=>y({...e,notes:t.target.value}),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Note aggiuntive sul cliente..."})]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"\uD83D\uDCC4 Documenti"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Carica Certificato Medico"}),(0,a.jsx)(c.s,{folder:"clients/medical",onUploaded:t=>z(e.id,"medical_certificate",t)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Carica Documento d'Identit\xe0"}),(0,a.jsx)(c.s,{folder:"clients/documents",onUploaded:t=>z(e.id,"id_document",t)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Carica Modulo Consenso"}),(0,a.jsx)(c.s,{folder:"clients/consent",onUploaded:t=>z(e.id,"consent_form",t)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Carica Altro Documento"}),(0,a.jsx)(c.s,{folder:"clients/other",onUploaded:t=>z(e.id,"other",t)})]})]}),e.documents&&e.documents.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Documenti caricati:"}),(0,a.jsx)("div",{className:"space-y-2",children:e.documents.map(t=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-lg",children:"medical_certificate"===t.type?"\uD83C\uDFE5":"id_document"===t.type?"\uD83C\uDD94":"consent_form"===t.type?"\uD83D\uDCDD":"\uD83D\uDCC4"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:t.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Caricato il ",(0,d.GP)(new Date(t.uploadedAt),"dd/MM/yyyy")]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"Visualizza"}),(0,a.jsx)(i.$,{onClick:()=>((e,t)=>{var s;if(!j)return;let a={...j,documents:(null==(s=j.documents)?void 0:s.filter(e=>e.id!==t))||[]};y(a),S(a)})(e.id,t.id),className:"bg-red-600 hover:bg-red-700",size:"sm",children:"\uD83D\uDDD1️"})]})]},t.id))})]})]})]})]})]})})]})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-foreground pt-4",children:"Clienti"}),"list"===f&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(n.p,{placeholder:"Cerca per nome o email...",value:N,onChange:e=>C(e.target.value),className:"w-full"})}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(i.$,{onClick:P,className:"bg-blue-600 hover:bg-blue-700",children:"+ Nuovo Cliente"})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:e.name.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.phone})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Cliente dal ",(0,d.GP)(new Date(e.createdAt||new Date),"dd/MM/yyyy")]})}),e.notes&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:e.notes}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{onClick:()=>{y(e),v("detail")},variant:"outline",size:"sm",className:"flex-1",children:"\uD83D\uDC41️ Visualizza"}),(0,a.jsx)(i.$,{onClick:()=>E(e.id),className:"bg-red-600 hover:bg-red-700",size:"sm",children:"\uD83D\uDDD1️"})]})]},e.id))}),0===T.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC65"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nessun cliente trovato"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:N?"Prova a modificare i filtri di ricerca":"Inizia aggiungendo il tuo primo cliente"}),!N&&(0,a.jsx)(i.$,{onClick:P,className:"bg-blue-600 hover:bg-blue-700",children:"+ Aggiungi Primo Cliente"})]})]}),"detail"===f&&j&&A(j),"create"===f&&j&&A(j,!0)]})}},33678:(e,t,s)=>{"use strict";s.d(t,{s:()=>n});var a=s(95155),r=s(12115),l=s(3998),i=s(22663);function n(e){let{folder:t,onUploaded:s,accept:n=".pdf,.doc,.docx,.jpg,.jpeg,.png",maxSize:o=10,children:c}=e,[d,m]=(0,r.useState)(!1),u=(0,r.useId)(),g=(0,r.useRef)(null),x=async e=>{var a;let r=null==(a=e.target.files)?void 0:a[0];if(r){if(r.size>1024*o*1024)return void i.toast.error("File troppo grande. Dimensione massima: ".concat(o,"MB"));m(!0);try{let e=new FormData;e.append("file",r),e.append("folder",t),console.log("[UploadButton] Caricamento file: ".concat(r.name," (").concat(r.size," bytes)"));let a=await fetch("/api/upload",{method:"POST",body:e});if(!a.ok){let e=await a.text();throw console.error("[UploadButton] Upload fallito: ".concat(a.status," - ").concat(e)),Error("Upload fallito: ".concat(a.status))}let l=await a.json();if(l.error)throw console.error("[UploadButton] Errore server:",l.error),Error("Errore server: ".concat(l.error));if(!l.url)throw console.error("[UploadButton] Nessun URL ritornato:",l),Error("Nessun URL ritornato dal server");console.log("[UploadButton] Upload completato: ".concat(l.url)),i.toast.success("File caricato con successo!"),s(l.url)}catch(t){console.error("Upload error:",t);let e=t instanceof Error?t.message:"Errore sconosciuto";i.toast.error("Errore caricamento: ".concat(e))}finally{if(m(!1),e.target)try{e.target.value=""}catch(e){}}}};return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{ref:g,type:"file",accept:n,onChange:x,className:"hidden",id:"upload-".concat(t,"-").concat(u),disabled:d}),(0,a.jsx)(l.$,{type:"button",variant:"outline",disabled:d,className:"cursor-pointer",onClick:()=>{var e;return!d&&(null==(e=g.current)?void 0:e.click())},children:d?"⏳ Caricamento...":c||"\uD83D\uDCC1 Carica File"}),(0,a.jsxs)("span",{className:"text-xs text-foreground/60",children:["Max ",o,"MB"]})]})}},65142:(e,t,s)=>{"use strict";s.d(t,{p:()=>i});var a=s(95155),r=s(12115),l=s(75889);let i=(0,r.forwardRef)((e,t)=>{let{className:s,label:r,error:i,id:n,...o}=e,c=n||o.name||"input";return(0,a.jsxs)("div",{className:"w-full",children:[r&&(0,a.jsx)("label",{htmlFor:c,className:"block text-sm font-medium mb-1 text-foreground",children:r}),(0,a.jsx)("input",{id:c,ref:t,className:(0,l.QP)("w-full rounded-lg border border-foreground/10 bg-background/70 backdrop-blur-sm px-3.5 py-2.5 text-sm text-foreground placeholder:text-foreground/50","focus:outline-none focus:ring-4 focus:ring-[rgba(var(--primary-rgb),0.15)] focus:ring-offset-0",i&&"border-accent",s),"aria-invalid":!!i,"aria-describedby":i?"".concat(c,"-error"):void 0,...o}),i&&(0,a.jsx)("p",{id:"".concat(c,"-error"),className:"mt-1 text-xs text-destructive",children:i})]})});i.displayName="Input"}},e=>{e.O(0,[9135,3965,3930,8744,2663,4909,2473,2599,576,8441,1255,7358],()=>e(e.s=7613)),_N_E=e.O()}]);