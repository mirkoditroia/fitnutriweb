(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6907],{5770:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var s=a(95155),l=a(12115),n=a(99018),r=a(3998),i=a(22663),o=a(72473),c=a(70740);a(99157);var d=a(83936),m=a(47260);let x=(e,t,a,s)=>{let l=e=>e.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",n=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//GZNutrition//Admin Calendar//IT","CALSCALE:GREGORIAN","METHOD:PUBLISH"];return e.filter(e=>{let s=new Date(e.date);return s>=t&&s<=a}).forEach(e=>{let t=new Date(e.date),a=new Date(e.slot?e.slot:t),r=new Date(a.getTime()+36e5);n.push("BEGIN:VEVENT","UID:".concat(e.id||Math.random().toString(36).substr(2,9),"@gznutrition.com"),"DTSTAMP:".concat(l(new Date)),"DTSTART:".concat(l(a)),"DTEND:".concat(l(r)),"SUMMARY:".concat(e.name," - Consulenza Nutrizionale"),"DESCRIPTION:Cliente: ".concat(e.name,"\\nEmail: ").concat(e.email,"\\nTelefono: ").concat(e.phone||"Non fornito","\\nPacchetto: ").concat(((e,t)=>{if(!e)return"Nessun pacchetto";let a=t.find(t=>t.id===e);return a?a.title:"Pacchetto ".concat(e)})(e.packageId,s),"\\nStatus: ").concat("confirmed"===e.status?"Confermata":"pending"===e.status?"In attesa":"Rifiutata"),"STATUS:".concat("confirmed"===e.status?"CONFIRMED":"TENTATIVE"),"ORGANIZER;CN=GZNutrition:mailto:admin@gznutrition.com","ATTENDEE;ROLE=REQ-PARTICIPANT;PARTSTAT=NEEDS-ACTION;CN=".concat(e.name,":mailto:").concat(e.email),"END:VEVENT")}),n.push("END:VCALENDAR"),n.join("\r\n")},u=(e,t)=>{let a=new Blob([e],{type:"text/calendar;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(s.href)};function h(){(0,m.useRouter)();let[e,t]=(0,l.useState)([]),[a,h]=(0,l.useState)([]),[p,b]=(0,l.useState)(!0),[g,f]=(0,l.useState)(null),[j,N]=(0,l.useState)("requests"),[v,y]=(0,l.useState)({name:"",email:"",phone:"",packageId:"",date:"",slot:"",location:"online",notes:""}),[D,C]=(0,l.useState)([]),[k,w]=(0,l.useState)(null),[E,S]=(0,l.useState)([]),[z,I]=(0,l.useState)(new Date),[A,M]=(0,l.useState)([]),[P,T]=(0,l.useState)(null),[R,$]=(0,l.useState)({name:"",email:"",phone:"",packageId:"",date:"",slot:"",status:"pending",notes:""}),[G,_]=(0,l.useState)([]),[L,q]=(0,l.useState)(null),O=async()=>{try{let[e,a]=await Promise.all([(0,n.ZY)(),(0,n.G9)()]);t(Array.isArray(e)?e:[]),h(Array.isArray(a)?a:[])}catch(e){console.error("Error loading data:",e),i.toast.error("Errore nel caricamento dei dati"),t([]),h([])}finally{b(!1)}};(0,l.useEffect)(()=>{O()},[]);let F=e=>{if(!e)return"Nessun pacchetto";let t=a.find(t=>t.id===e);return t?t.title:"Pacchetto ".concat(e)},H=async e=>{if(e.id&&!g){f(e.id);try{await (0,n.vq)({...e,status:"confirmed"}),await O(),i.toast.success("Prenotazione confermata e cliente creato/aggiornato automaticamente!")}catch(e){console.error("Error confirming booking:",e),i.toast.error("Errore nella conferma della prenotazione")}finally{f(null)}}},V=async e=>{if(window.confirm("Sei sicuro di voler rifiutare ed eliminare la prenotazione di ".concat(e.name,"?\n\nQuesta azione non pu\xf2 essere annullata.")))try{await (0,n.VA)(e.id),await O(),i.toast.success("Prenotazione rifiutata ed eliminata. Cliente creato/aggiornato con status inattivo.")}catch(e){console.error("Error deleting booking:",e),i.toast.error("Errore nell'eliminazione della prenotazione")}},B=async e=>{try{await (0,n.Wi)(e),i.toast.success("Cliente creato/aggiornato dalla prenotazione!"),await O()}catch(e){console.error("Error creating client from booking:",e),i.toast.error("Errore nella creazione del cliente")}};(0,l.useEffect)(()=>{(async()=>{let e=Array.from({length:365},(e,t)=>{let a=new Date;return a.setHours(0,0,0,0),a.setDate(a.getDate()+t),"".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0"),"-").concat(String(a.getDate()).padStart(2,"0"))}),t=a.find(e=>e.id===v.packageId),s=!!(null==t?void 0:t.isPromotional);S((await Promise.all(e.map(async e=>{try{var t,a,l;let r=await (0,n.ho)(e);if(!r)return null;if(s)return r.freeConsultationSlots&&r.freeConsultationSlots.length>0?e:null;let i=null!=(a=null!=(t=r.onlineSlots)?t:r.slots)?a:[],o=null!=(l=r.inStudioSlots)?l:[];return("online"===v.location?i:o).length>0?e:null}catch(e){return null}}))).filter(e=>!!e))})()},[v.packageId,v.location,a]);let U=e=>{if(q(e),e){let t=(0,o.GP)(e,"yyyy-MM-dd");$(e=>({...e,date:t})),(0,n.ho)(t).then(e=>{var t,a,s,l;_((null!=(t=null==P?void 0:P.location)?t:"online")==="online"?null!=(s=null!=(a=null==e?void 0:e.onlineSlots)?a:null==e?void 0:e.slots)?s:[]:null!=(l=null==e?void 0:e.inStudioSlots)?l:[])})}else _([])},Y=async e=>{if(e.preventDefault(),P)try{let e={...P,name:R.name,email:R.email,phone:R.phone||void 0,packageId:R.packageId||void 0,date:R.date,slot:R.slot||"",location:P.location,status:R.status,notes:R.notes||void 0};await (0,n.vq)(e),i.toast.success("Prenotazione aggiornata con successo!"),T(null),$({name:"",email:"",phone:"",packageId:"",date:"",slot:"",status:"pending",notes:""}),q(null),_([]),await O()}catch(e){console.error("Error updating booking:",e),i.toast.error("Errore nell'aggiornamento della prenotazione")}},Z=()=>{T(null),$({name:"",email:"",phone:"",packageId:"",date:"",slot:"",status:"pending",notes:""}),q(null),_([])},W=async e=>{if(confirm("Sei sicuro di voler eliminare la prenotazione di ".concat(e.name,"?")))try{await (0,n.VA)(e.id),i.toast.success("Prenotazione eliminata con successo!"),await O()}catch(e){console.error("Error deleting booking:",e),i.toast.error("Errore nell'eliminazione della prenotazione")}};(0,l.useEffect)(()=>{"calendar"===j&&e.length>0&&(async t=>{let a=(0,o.GP)(t,"yyyy-MM-dd");M(e.filter(e=>e.date.startsWith(a)))})(z)},[z,e,j]);let Q=t=>{try{let s,l,n;switch(t){case"day":(s=new Date(z)).setHours(0,0,0,0),(l=new Date(z)).setHours(23,59,59,999),n="calendario_giornaliero_".concat((0,o.GP)(z,"yyyy-MM-dd"),".ics");break;case"week":(s=new Date(z)).setDate(s.getDate()-s.getDay()+1),s.setHours(0,0,0,0),(l=new Date(s)).setDate(l.getDate()+6),l.setHours(23,59,59,999),n="calendario_settimanale_".concat((0,o.GP)(s,"yyyy-MM-dd"),".ics");break;case"month":s=new Date(z.getFullYear(),z.getMonth(),1),(l=new Date(z.getFullYear(),z.getMonth()+1,0)).setHours(23,59,59,999),n="calendario_mensile_".concat((0,o.GP)(s,"yyyy-MM"),".ics");break;case"all":s=new Date(2020,0,1),l=new Date(2030,11,31),n="calendario_completo_".concat((0,o.GP)(new Date,"yyyy-MM-dd"),".ics")}let r=x(e,s,l,a);u(r,n),i.toast.success("Calendario esportato con successo! (".concat("day"===t?"Giorno":"week"===t?"Settimana":"month"===t?"Mese":"Completo",")"))}catch(e){console.error("Error exporting calendar:",e),i.toast.error("Errore nell'esportazione del calendario")}},J=Array.isArray(e)?e.filter(e=>"pending"===e.status):[],K=Array.isArray(e)?e.filter(e=>"confirmed"===e.status):[],X=Array.isArray(e)?e.filter(e=>"cancelled"===e.status):[];if(p)return(0,s.jsxs)("main",{className:"container py-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Gestione Prenotazioni"}),(0,s.jsx)("p",{className:"mt-4 text-foreground/70",children:"Caricamento..."})]});let ee=e=>{var t;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-card border border-border rounded-lg p-4 shadow-sm",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"font-semibold text-foreground",children:e.name}),(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("confirmed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"pending"===e.status?"In attesa":"confirmed"===e.status?"Confermata":"Rifiutata"}),e.priority&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-orange-100 text-orange-800 text-xs font-medium",children:"Priorit\xe0"})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["\uD83D\uDCE7 ",e.email," ",e.phone&&"• \uD83D\uDCF1 ".concat(e.phone)]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["\uD83D\uDCC5 ",new Date(e.date).toLocaleDateString("it-IT"),e.slot&&" • ⏰ ".concat(e.slot)]}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.isFreeConsultation?"\uD83D\uDCCD Sede: Online (gratuita)":"studio"===e.location?"\uD83D\uDCCD Sede: In studio".concat(e.studioLocation?" • ".concat(e.studioLocation):""):"\uD83D\uDCCD Sede: Online"}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["\uD83D\uDCE6 ",F(e.packageId)]}),e.notes&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground mt-2",children:[(0,s.jsx)("div",{className:"font-medium text-foreground mb-1",children:"\uD83D\uDCDD Note del cliente:"}),(0,s.jsx)("div",{className:"bg-muted/50 p-2 rounded border-l-2 border-primary/30 text-xs",children:e.notes})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground/70 mt-1",children:["Richiesta il: ",new Date(null!=(t=e.createdAt)?t:e.date).toLocaleString("it-IT")]})]}),(0,s.jsxs)("div",{className:"flex gap-2 flex-wrap",children:["pending"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.$,{size:"sm",onClick:()=>H(e),disabled:g===e.id,className:"bg-green-600 hover:bg-green-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:g===e.id?"⏳ Confermando...":"✅ Conferma"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>B(e),className:"border-blue-300 text-blue-600 hover:bg-blue-50 button-responsive-sm",children:(0,s.jsx)("span",{className:"flex flex-col items-center justify-center gap-1 text-center",children:(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"\uD83D\uDC65"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Crea Cliente"}),(0,s.jsx)("span",{className:"sm:hidden",children:"Crea"})]})})}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>V(e),className:"border-red-300 text-red-600 hover:bg-red-50",children:"\uD83D\uDDD1️ Rifiuta"})]}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>{T(e),$({name:e.name,email:e.email,phone:e.phone||"",packageId:e.packageId||"",date:e.date,slot:e.slot||"",status:e.status,notes:e.notes||""}),q(new Date(e.date));let t=(0,o.GP)(new Date(e.date),"yyyy-MM-dd");(0,n.ho)(t).then(e=>{_((null==e?void 0:e.slots)||[])}).catch(e=>{console.error("Errore nel caricamento disponibilit\xe0:",e),_([])})},className:"border-gray-300 text-gray-600 hover:bg-gray-50",children:"✏️ Modifica"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>W(e),className:"border-red-300 text-red-600 hover:bg-red-50",children:"\uD83D\uDDD1️ Elimina"})]})]})}),(null==P?void 0:P.id)===e.id&&(0,s.jsxs)("div",{className:"bg-card border border-border rounded-lg p-6 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-black",children:"Modifica Prenotazione"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:Z,className:"text-xs px-3 py-1",children:"❌ Annulla"})]}),(0,s.jsxs)("form",{onSubmit:Y,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Nome e cognome *"}),(0,s.jsx)("input",{type:"text",value:R.name,onChange:e=>$(t=>({...t,name:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Email *"}),(0,s.jsx)("input",{type:"email",value:R.email,onChange:e=>$(t=>({...t,email:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Telefono"}),(0,s.jsx)("input",{type:"text",value:R.phone,onChange:e=>$(t=>({...t,phone:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Pacchetto"}),(0,s.jsxs)("select",{value:R.packageId,onChange:e=>$(t=>({...t,packageId:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",children:[(0,s.jsx)("option",{value:"",children:"Nessun pacchetto"}),a.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Data *"}),(0,s.jsx)(c.Ay,{selected:L,onChange:U,dateFormat:"dd/MM/yyyy",className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",minDate:new Date,placeholderText:"Seleziona una data"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Slot orario *"}),(0,s.jsxs)("select",{value:R.slot,onChange:e=>$(t=>({...t,slot:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",disabled:!L||0===G.length,required:!0,children:[(0,s.jsx)("option",{value:"",children:"Seleziona un orario disponibile"}),G.map(e=>(0,s.jsx)("option",{value:e,children:new Date(e).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})},e))]}),L&&0===G.length&&(0,s.jsx)("p",{className:"text-xs text-destructive mt-1",children:"Nessun slot disponibile per questa data"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Status"}),(0,s.jsxs)("select",{value:R.status,onChange:e=>$(t=>({...t,status:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",children:[(0,s.jsx)("option",{value:"pending",children:"In attesa"}),(0,s.jsx)("option",{value:"confirmed",children:"Confermata"}),(0,s.jsx)("option",{value:"cancelled",children:"Rifiutata"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Note"}),(0,s.jsx)("textarea",{value:R.notes,onChange:e=>$(t=>({...t,notes:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",rows:3})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,s.jsx)(r.$,{type:"submit",children:"\uD83D\uDCBE Salva Modifiche"}),(0,s.jsx)(r.$,{type:"button",variant:"outline",onClick:Z,children:"❌ Annulla"})]})]})]})]},e.id)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-6 gap-4 pt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-black",children:"Gestione Prenotazioni"}),(0,s.jsx)("p",{className:"text-sm text-black/70 mt-1",children:"Amministrazione sistema prenotazioni"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(r.$,{variant:"outline",size:"sm",onClick:()=>window.open("/","_blank"),className:"flex items-center gap-2",children:"\uD83C\uDFE0 Homepage"}),(0,s.jsx)(r.$,{variant:"outline",size:"sm",onClick:()=>window.open("/admin","_blank"),className:"flex items-center gap-2",children:"⚙️ Admin Panel"})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-6 border-b border-foreground/20",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("button",{onClick:()=>N("requests"),className:"px-4 py-2 font-medium border-b-2 transition-colors ".concat("requests"===j?"border-primary text-primary":"border-transparent text-foreground/70 hover:text-foreground"),children:["\uD83D\uDCCB Richieste (",J.length,")"]}),(0,s.jsx)("button",{onClick:()=>N("manual"),className:"px-4 py-2 font-medium border-b-2 transition-colors ".concat("manual"===j?"border-primary text-primary":"border-transparent text-foreground/70 hover:text-foreground"),children:"➕ Inserimento Manuale"}),(0,s.jsx)("button",{onClick:()=>N("calendar"),className:"px-4 py-2 font-medium border-b-2 transition-colors ".concat("calendar"===j?"border-primary text-primary":"border-transparent text-foreground/70 hover:text-foreground"),children:"\uD83D\uDCC5 Calendario"})]}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>Q("all"),className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta Calendario Completo"})]}),"requests"===j&&(0,s.jsxs)("div",{className:"mt-6",children:[J.length>0&&(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold flex items-center gap-2",children:["⏳ Richieste in Attesa (",J.length,")"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>{let t=e.filter(e=>"pending"===e.status);u(x(t,new Date(2020,0,1),new Date(2030,11,31),a),"richieste_in_attesa_".concat((0,o.GP)(new Date,"yyyy-MM-dd"),".ics")),i.toast.success("Calendario richieste in attesa esportato!")},className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta In Attesa"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>{Promise.all(J.map(B)).then(()=>{i.toast.success("".concat(J.length," clienti creati/aggiornati dalle prenotazioni in attesa!"))}).catch(()=>{i.toast.error("Errore nella creazione di alcuni clienti")})},className:"text-xs px-3 py-1 bg-blue-50 text-blue-700 border-blue-300 hover:bg-blue-100 button-responsive-sm",children:(0,s.jsx)("span",{className:"flex flex-col items-center justify-center gap-1 text-center",children:(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"\uD83D\uDC65"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Crea Clienti da In Attesa"}),(0,s.jsx)("span",{className:"sm:hidden",children:"Crea Clienti"})]})})})]})]}),(0,s.jsx)("div",{className:"space-y-4",children:J.map(ee)})]}),K.length>0&&(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold flex items-center gap-2",children:["✅ Prenotazioni Confermate (",K.length,")"]}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>{let t=e.filter(e=>"confirmed"===e.status);u(x(t,new Date(2020,0,1),new Date(2030,11,31),a),"prenotazioni_confermate_".concat((0,o.GP)(new Date,"yyyy-MM-dd"),".ics")),i.toast.success("Calendario prenotazioni confermate esportato!")},className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta Confermate"})]}),(0,s.jsx)("div",{className:"space-y-4",children:K.map(e=>(0,s.jsxs)("div",{children:[ee(e),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>B(e),className:"border-blue-300 text-blue-600 hover:bg-blue-50",children:"\uD83D\uDC65 Crea Cliente"})})]},e.id))})]}),X.length>0&&(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold flex items-center gap-2",children:["❌ Prenotazioni Rifiutate (",X.length,")"]}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>{let t=e.filter(e=>"cancelled"===e.status);u(x(t,new Date(2020,0,1),new Date(2030,11,31),a),"prenotazioni_rifiutate_".concat((0,o.GP)(new Date,"yyyy-MM-dd"),".ics")),i.toast.success("Calendario prenotazioni rifiutate esportato!")},className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta Rifiutate"})]}),(0,s.jsx)("div",{className:"space-y-4",children:X.map(ee)})]}),0===e.length&&(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-black/70",children:"Nessuna prenotazione trovata."}),(0,s.jsx)("p",{className:"text-sm text-black/50 mt-1",children:"Le nuove richieste appariranno qui."})]})]}),P&&(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsxs)("div",{className:"bg-card border border-border rounded-lg p-6 max-w-2xl shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-black",children:"Modifica Prenotazione"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:Z,className:"text-xs px-3 py-1",children:"❌ Annulla"})]}),(0,s.jsxs)("form",{onSubmit:Y,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Nome e cognome *"}),(0,s.jsx)("input",{type:"text",value:R.name,onChange:e=>$(t=>({...t,name:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Email *"}),(0,s.jsx)("input",{type:"email",value:R.email,onChange:e=>$(t=>({...t,email:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Telefono"}),(0,s.jsx)("input",{type:"text",value:R.phone,onChange:e=>$(t=>({...t,phone:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Pacchetto"}),(0,s.jsxs)("select",{value:R.packageId,onChange:e=>$(t=>({...t,packageId:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",children:[(0,s.jsx)("option",{value:"",children:"Nessun pacchetto"}),a.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Data *"}),(0,s.jsx)(c.Ay,{selected:L,onChange:U,dateFormat:"dd/MM/yyyy",className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",minDate:new Date,placeholderText:"Seleziona una data"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Slot orario *"}),(0,s.jsxs)("select",{value:R.slot,onChange:e=>$(t=>({...t,slot:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",disabled:!L||0===G.length,required:!0,children:[(0,s.jsx)("option",{value:"",children:"Seleziona un orario disponibile"}),G.map(e=>(0,s.jsx)("option",{value:e,children:new Date(e).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})},e))]}),L&&0===G.length&&(0,s.jsx)("p",{className:"text-xs text-destructive mt-1",children:"Nessun slot disponibile per questa data"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Status"}),(0,s.jsxs)("select",{value:R.status,onChange:e=>$(t=>({...t,status:e.target.value})),className:"w-full rounded-md border border-border bg-white px-3 py-2 text-sm text-black placeholder:text-black/70",children:[(0,s.jsx)("option",{value:"pending",children:"In attesa"}),(0,s.jsx)("option",{value:"confirmed",children:"Confermata"}),(0,s.jsx)("option",{value:"cancelled",children:"Rifiutata"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-black",children:"Note"}),(0,s.jsx)("textarea",{value:R.notes,onChange:e=>$(t=>({...t,notes:e.target.value})),className:"w-full rounded-md border border-white/30 bg-white/10 px-3 py-2 text-sm text-white placeholder:text-white/70",rows:3})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,s.jsx)(r.$,{type:"submit",children:"\uD83D\uDCBE Salva Modifiche"}),(0,s.jsx)(r.$,{type:"button",variant:"outline",onClick:Z,children:"❌ Annulla"})]})]})]})}),"manual"===j&&(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsxs)("div",{className:"bg-card border border-border rounded-lg p-6 max-w-2xl shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-black",children:"Inserimento Manuale Prenotazione"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>Q("all"),className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta Calendario"})]}),(0,s.jsx)(d.BookingForm,{adminMode:!0,requirePackage:!0,hidePackageSelect:!0})]})}),"calendar"===j&&(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsxs)("div",{className:"bg-card border border-border rounded-lg p-6 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Vista Calendario"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>Q("day"),className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta Giorno"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>Q("week"),className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta Settimana"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>Q("month"),className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta Mese"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>Q("all"),className:"text-xs px-3 py-1",children:"\uD83D\uDCC5 Esporta Tutto"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,s.jsxs)("div",{className:"flex-shrink-0",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4 text-foreground",children:"Seleziona Data"}),(0,s.jsx)(c.Ay,{selected:z,onChange:e=>e&&I(e),inline:!0,calendarStartDay:1})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-foreground",children:["\uD83D\uDCC5 Agenda del ",z.toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),(0,s.jsxs)("div",{className:"text-sm text-foreground/60",children:[A.length," appuntamento",1!==A.length?"i":""]})]}),A.length>0?(0,s.jsx)("div",{className:"space-y-4",children:(()=>{let e=[],t=new Date(z);for(let a=9;a<=18;a++){let s=new Date(t);s.setHours(a,0,0,0),e.push("".concat((0,o.GP)(s,"yyyy-MM-dd"),"T").concat((0,o.GP)(s,"HH:mm"),":00"))}return e})().map(e=>{let t=[...A.filter(t=>{if(!t.slot)return!1;let[a,s]=t.slot.split(":").map(Number),l=new Date(z);l.setHours(a||0,s||0,0,0);let n=new Date(e);return 18e5>Math.abs(l.getTime()-n.getTime())}),...A.filter(t=>!t.slot&&e.endsWith("09:00:00"))];return 0===t.length?null:(0,s.jsxs)("div",{className:"border-l-4 border-primary/30 pl-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"bg-primary/10 text-primary font-mono text-sm px-3 py-1 rounded-full",children:new Date(e).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})}),(0,s.jsx)("div",{className:"flex-1 h-px bg-foreground/10"})]}),(0,s.jsx)("div",{className:"space-y-3",children:t.map(e=>{var t;return(0,s.jsxs)("div",{className:"bg-background/80 rounded-lg p-4 border border-foreground/10 hover:border-primary/30 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("span",{className:"font-semibold text-lg",children:e.name}),(0,s.jsx)("span",{className:"chip text-xs ".concat("confirmed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"pending"===e.status?"⏳ In attesa":"confirmed"===e.status?"✅ Confermata":"❌ Rifiutata"}),e.priority&&(0,s.jsx)("span",{className:"chip bg-orange-100 text-orange-800 text-xs",children:"\uD83D\uDD25 Priorit\xe0"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-foreground/70",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-4 h-4",children:"\uD83D\uDCE7"}),(0,s.jsx)("span",{children:e.email})]}),e.phone&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-4 h-4",children:"\uD83D\uDCF1"}),(0,s.jsx)("span",{children:e.phone})]}),e.packageId&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-4 h-4",children:"\uD83D\uDCE6"}),(0,s.jsx)("span",{children:F(e.packageId)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-4 h-4",children:"\uD83D\uDCAC"}),(0,s.jsx)("span",{className:"capitalize",children:e.channelPreference||"whatsapp"})]})]})]}),"pending"===e.status&&(0,s.jsxs)("div",{className:"flex flex-col gap-2 ml-4",children:[(0,s.jsx)(r.$,{size:"sm",onClick:()=>H(e),disabled:g===e.id,className:"bg-green-600 hover:bg-green-700 text-white text-xs px-3 py-1 disabled:opacity-50 disabled:cursor-not-allowed",children:g===e.id?"⏳ Confermando...":"✅ Conferma"}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>B(e),className:"border-blue-300 text-blue-600 hover:bg-blue-50 text-xs px-3 py-1 button-responsive-xs",children:(0,s.jsx)("span",{className:"flex flex-col items-center justify-center gap-1 text-center",children:(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"\uD83D\uDC65"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Crea Cliente"}),(0,s.jsx)("span",{className:"sm:inline",children:"Crea"})]})})}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>V(e),className:"border-red-300 text-red-600 hover:bg-red-50 text-xs px-3 py-1",children:"❌ Rifiuta"})]})]}),(0,s.jsxs)("div",{className:"text-xs text-foreground/50 pt-2 border-t border-foreground/10",children:["Richiesta il: ",new Date(null!=(t=e.createdAt)?t:e.date).toLocaleString("it-IT")]})]},e.id)})})]},e)})}):(0,s.jsxs)("div",{className:"text-center py-12 text-foreground/50",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCC5"}),(0,s.jsx)("p",{className:"text-lg font-medium mb-2",children:"Nessun appuntamento per questa data"}),(0,s.jsx)("p",{className:"text-sm",children:"La giornata \xe8 libera per nuove prenotazioni"})]})]})]})]})})]})}},40825:(e,t,a)=>{Promise.resolve().then(a.bind(a,5770))}},e=>{e.O(0,[3038,9135,3965,5579,2545,8744,2663,4909,2473,3237,8596,576,3936,8441,1255,7358],()=>e(e.s=40825)),_N_E=e.O()}]);