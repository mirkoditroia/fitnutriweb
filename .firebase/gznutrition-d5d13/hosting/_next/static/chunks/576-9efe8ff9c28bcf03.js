"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[576],{576:(e,t,o)=>{o.d(t,{X2:()=>c,cY:()=>r,f9:()=>s});var a=o(9018);let i=null,n=0;async function l(){let e=Date.now();if(null!==i&&e<n)return i;try{let t=await (0,a.getSiteContent)();return i=(null==t?void 0:t.debugLogsEnabled)!==!1,n=e+3e4,i}catch(t){return i=!0,n=e+3e4,!0}}async function r(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];await l()&&console.log(...t)}function s(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];!1!==i&&console.log(...t)}function c(){i=null,n=0}},1272:(e,t,o)=>{o.d(t,{j2:()=>u,db:()=>g});var a=o(2078),i=o(2553),n=o(9708),l=o(2377),r=o(5704);let s=l.Ik({NEXT_PUBLIC_FIREBASE_API_KEY:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_PROJECT_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_APP_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID:l.Yj().optional().default("")}).parse({NEXT_PUBLIC_FIREBASE_API_KEY:"AIzaSyAp1IXe0d2yE-BSrZLGKHfDkdkm1NuSwfs",NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:"gznutrition-d5d13.firebaseapp.com",NEXT_PUBLIC_FIREBASE_PROJECT_ID:"gznutrition-d5d13",NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:"gznutrition-d5d13.firebasestorage.app",NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:"658719519730",NEXT_PUBLIC_FIREBASE_APP_ID:"1:658719519730:web:37dafec47d6f4e6c0db16b",NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID:r.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID});o(4663);let c={apiKey:s.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:s.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:s.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:s.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:s.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:s.NEXT_PUBLIC_FIREBASE_APP_ID},d=s.NEXT_PUBLIC_FIREBASE_API_KEY&&s.NEXT_PUBLIC_FIREBASE_PROJECT_ID&&s.NEXT_PUBLIC_FIREBASE_APP_ID?(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)(c):null,u=d?(0,i.xI)(d):void 0,g=d?(0,n.aU)(d):void 0},4368:(e,t,o)=>{o.d(t,{EZ:()=>A,Ej:()=>D,G9:()=>d,HG:()=>L,KB:()=>B,Kh:()=>u,TP:()=>v,VA:()=>b,Wi:()=>z,ZY:()=>f,_L:()=>y,by:()=>T,dd:()=>S,deletePackage:()=>g,fH:()=>C,ho:()=>h,sH:()=>p,u2:()=>N,vq:()=>m,wb:()=>I,zZ:()=>k});var a=o(9708),i=o(5197),n=o(576),l=o(1272),r=o(5704);async function s(e,t,o,a,i){try{(0,n.f9)("\uD83D\uDCE4 sendBookingNotification chiamata con:",{bookingId:e.id,isFreeConsultation:e.isFreeConsultation,packageTitle:t,notificationEmail:o});let l=await fetch("https://sendbookingnotification-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"new-booking",booking:e,packageTitle:t,notificationEmail:o,businessName:a,colorPalette:i})});(0,n.f9)("\uD83D\uDCEC Risposta Firebase Functions:",l.status);let r=await l.json();(0,n.f9)("\uD83D\uDCCB Risultato email:",r),r.success?(0,n.f9)("✅ Booking notification sent successfully:",r.sentTo):console.error("❌ Failed to send booking notification:",r.message)}catch(e){console.error("❌ Error sending booking notification:",e)}}let c={packages:e=>(0,a.rJ)(e,"packages"),bookings:e=>(0,a.rJ)(e,"bookings"),clients:e=>(0,a.rJ)(e,"clients"),content:e=>(0,a.H9)(e,"content/landing"),availability:(e,t)=>(0,a.H9)(e,"availability/".concat(t))};async function d(){if(!l.db)return(0,n.f9)("getPackages: Database non configurato"),[];try{(0,n.f9)("getPackages: Caricamento pacchetti da Firebase...");let e=l.db,t=await (0,a.GG)((0,a.P)(c.packages(e),(0,a.My)("createdAt","desc")));(0,n.f9)("getPackages: Snap ricevuto:",t),(0,n.f9)("getPackages: Numero documenti:",t.docs.length);let o=t.docs.map(e=>{let t=e.data();(0,n.f9)("getPackages: Documento ".concat(e.id,":"),t);let o={id:e.id,title:t.title||"",description:t.description||"",price:t.price||0,imageUrl:t.imageUrl||"",isActive:void 0!==t.active?t.active:t.isActive||!1,featured:t.featured||!1,badge:t.badge||"",isPromotional:t.isPromotional||!1,hasDiscount:t.hasDiscount||!1,basePrice:t.basePrice||void 0,discountedPrice:t.discountedPrice||void 0,discountPercentage:t.discountPercentage||void 0,paymentText:t.paymentText||void 0,details:t.details||void 0,createdAt:t.createdAt?t.createdAt.toDate?t.createdAt.toDate().toISOString():t.createdAt:void 0};return(0,n.f9)("getPackages: Pacchetto mappato ".concat(e.id,":"),o),o});return(0,n.f9)("getPackages: Pacchetti processati:",o),o}catch(e){return console.error("getPackages: Errore nel caricamento da Firebase:",e),[]}}async function u(e){var t,o,i,n,r,s,d,u,g,f,p,m,b,v,S,C,y,h;if(!l.db)throw Error("Firestore not configured");return e.id?(await (0,a.mZ)((0,a.H9)(l.db,"packages",e.id),{title:e.title,description:e.description,price:e.price,imageUrl:null!=(t=e.imageUrl)?t:null,active:e.isActive,featured:null!=(o=e.featured)&&o,badge:null!=(i=e.badge)?i:null,isPromotional:null!=(n=e.isPromotional)&&n,hasDiscount:null!=(r=e.hasDiscount)&&r,basePrice:null!=(s=e.basePrice)?s:null,discountedPrice:null!=(d=e.discountedPrice)?d:null,discountPercentage:null!=(u=e.discountPercentage)?u:null,paymentText:e.paymentText||null,details:null!=(g=e.details)?g:null,createdAt:(0,a.O5)()}),e.id):(await (0,a.gS)(c.packages(l.db),{title:e.title,description:e.description,price:e.price,imageUrl:null!=(f=e.imageUrl)?f:null,active:e.isActive,featured:null!=(p=e.featured)&&p,badge:null!=(m=e.badge)?m:null,isPromotional:null!=(b=e.isPromotional)&&b,hasDiscount:null!=(v=e.hasDiscount)&&v,basePrice:null!=(S=e.basePrice)?S:null,discountedPrice:null!=(C=e.discountedPrice)?C:null,discountPercentage:null!=(y=e.discountPercentage)?y:null,paymentText:e.paymentText||null,details:null!=(h=e.details)?h:null,createdAt:(0,a.O5)()})).id}async function g(e){if(!l.db)throw Error("Firestore not configured");if(!e)throw Error("Package ID is required for deletion");await (0,a.kd)((0,a.H9)(l.db,"packages",e))}async function f(){if(!l.db)return[];let e=l.db;return(await (0,a.GG)((0,a.P)(c.bookings(e),(0,a.My)("createdAt","desc")))).docs.map(e=>w(e.id,e.data()))}async function p(e,t){var o,r,d,u,g,f,p,m,b,y,E,w,P,T,A,k,N,L,D,B,z,O,_,F,R,x,U,G,j,M,H;let J,K;if((0,n.f9)("\uD83D\uDD25 createBooking Firebase iniziato:",{isFreeConsultation:e.isFreeConsultation,slot:e.slot,date:e.date,dateFormatted:new Date(e.date).toISOString().split("T")[0],packageId:e.packageId}),!l.db)throw Error("Firestore not configured");let X=await C();if((null==X?void 0:X.recaptchaEnabled)&&t)try{(0,n.f9)("\uD83D\uDD11 Inizio verifica CAPTCHA con token:",t?t.substring(0,20)+"...":"null");let e=new AbortController,o=setTimeout(()=>e.abort(),5e3),a=await fetch("https://verifycaptcha-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t}),signal:e.signal});clearTimeout(o),(0,n.f9)("\uD83D\uDCE1 Risposta Firebase Function status:",a.status);let i=await a.json();if((0,n.f9)("\uD83D\uDD0D Risultato verifica CAPTCHA:",i),!i.success)throw console.error("❌ CAPTCHA verifica fallita:",i.message,i.errors),Error("Verifica CAPTCHA fallita: ".concat(i.message||"Errore sconosciuto"));(0,n.f9)("✅ CAPTCHA verificato con successo!")}catch(e){if(console.error("\uD83D\uDCA5 Errore verifica CAPTCHA:",e),e instanceof Error&&"AbortError"===e.name)throw Error("Verifica CAPTCHA timeout. Riprova.");throw Error("Errore nella verifica CAPTCHA. Riprova.")}else if((null==X?void 0:X.recaptchaEnabled)&&!t)throw Error("Token CAPTCHA mancante. Completa la verifica CAPTCHA.");if(!e.slot)throw Error("Lo slot orario \xe8 obbligatorio per la prenotazione");let V=e.date.includes("T")?e.date.split("T")[0]:e.date;(0,n.f9)("\uD83D\uDD0D FORMATO DATA DEBUG:"),(0,n.f9)("\uD83D\uDCC5 Data originale dal form:",e.date),(0,n.f9)("\uD83D\uDCC5 Data standardizzata per query:",V);let Z=await h(V),Y=e.isFreeConsultation?"online":e.location||"online",q=[];if(e.isFreeConsultation){let t=null!=(o=null==Z?void 0:Z.freeConsultationSlots)?o:[];if(t.length>0&&"object"==typeof t[0]){q=t.map(e=>e.time);let o=t.find(t=>t.time===e.slot);J=null==o?void 0:o.duration}else q=t.map(e=>"string"==typeof e?e:e.time);if((0,n.f9)("\uD83D\uDD0D Consulenza gratuita - Slot promozionali disponibili:",q.length,"slot"),(0,n.f9)("\uD83D\uDCC5 Slot richiesto:",e.slot),(0,n.f9)("⏱️ Durata consultazione:",J,"minuti"),0===q.length)throw Error("❌ Nessun slot per consulenze gratuite disponibile per questa data")}else q="online"===Y?null!=(u=null!=(d=null==Z?void 0:Z.onlineSlots)?d:null==Z?void 0:Z.slots)?u:[]:e.studioLocation?null!=(g=null==Z||null==(r=Z.studioSlots)?void 0:r[e.studioLocation])?g:[]:null!=(f=null==Z?void 0:Z.inStudioSlots)?f:[];if(!Z||!q.includes(e.slot))throw console.error("❌ VALIDAZIONE SLOT FALLITA!"),console.error("  - availability presente:",!!Z),console.error("  - pool.length:",q.length),console.error("  - slot richiesto:",e.slot),console.error("  - isFreeConsultation:",e.isFreeConsultation),Error("L'orario selezionato non \xe8 pi\xf9 disponibile");if((0,n.f9)("✅ Slot validato correttamente:",e.slot),e.isFreeConsultation){let e=J||10;K="Consultazione Gratuita (".concat(e," minuti)")}else if(e.packageId)try{let t=await (0,a.x7)((0,a.H9)(l.db,"packages",e.packageId));t.exists()&&(K=t.data().title)}catch(e){console.error("Error getting package title for calendar event:",e)}(0,n.f9)("\uD83D\uDCBE Salvando prenotazione nel database...");let W=await (0,a.gS)(c.bookings(l.db),{clientId:null!=(p=e.clientId)?p:null,name:e.name,email:e.email,phone:null!=(m=e.phone)?m:null,packageId:null!=(b=e.packageId)?b:null,date:e.date,slot:null!=(y=e.slot)?y:null,location:Y,studioLocation:null!=(E=e.studioLocation)?E:null,status:e.status||"confirmed",priority:!!e.priority,channelPreference:null!=(w=e.channelPreference)?w:null,isFreeConsultation:!!e.isFreeConsultation,consultationDuration:null!=J?J:null,notes:null!=(P=e.notes)?P:null,createdAt:(0,a.O5)()});if((0,n.f9)("✅ Prenotazione salvata con ID:",W.id),e.isFreeConsultation){let t,o=null!=(T=null==Z?void 0:Z.freeConsultationSlots)?T:[];t=o.length>0&&"object"==typeof o[0]?o.filter(t=>t.time!==e.slot):o.filter(t=>"string"==typeof t?t!==e.slot:t.time!==e.slot).map(e=>"string"==typeof e?e:e.time),(0,n.f9)("\uD83D\uDDD1️ Rimuovendo slot promozionale:",e.slot),(0,n.f9)("\uD83D\uDCCB Slot promozionali rimanenti:",t),await I(V,null!=(k=null!=(A=Z.onlineSlots)?A:Z.slots)?k:[],t,null!=(N=Z.inStudioSlots)?N:[],null!=(L=Z.studioSlots)?L:{})}else if("online"===Y){let t=(null!=(B=null!=(D=Z.onlineSlots)?D:Z.slots)?B:[]).filter(t=>t!==e.slot);await I(V,t,Z.freeConsultationSlots,null!=(z=Z.inStudioSlots)?z:[],null!=(O=Z.studioSlots)?O:{})}else if(e.studioLocation){let t={...null!=(_=Z.studioSlots)?_:{}};t[e.studioLocation]=(null!=(F=t[e.studioLocation])?F:[]).filter(t=>t!==e.slot),await I(V,null!=(x=null!=(R=Z.onlineSlots)?R:Z.slots)?x:[],Z.freeConsultationSlots,null!=(U=Z.inStudioSlots)?U:[],t)}else{let t=(null!=(G=Z.inStudioSlots)?G:[]).filter(t=>t!==e.slot);await I(V,null!=(M=null!=(j=Z.onlineSlots)?j:Z.slots)?M:[],Z.freeConsultationSlots,t,null!=(H=Z.studioSlots)?H:{})}if("confirmed"===e.status)try{let t=await S(e.email);if(t)await v({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"active",source:t.source||"website"});else{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione confermata del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"active",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await v(t)}}catch(e){console.error("Error creating/updating client from booking:",e)}let Q=[];return"confirmed"===e.status&&Q.push((async()=>{try{let t=await (0,i.hX)(void 0,e,K);t&&"pending"!==t?(await (0,a.mZ)((0,a.H9)(l.db,"bookings",W.id),{googleCalendarEventId:t}),(0,n.f9)("Google Calendar event created and linked to booking:",t)):"pending"===t&&(console.log("⚠️ [BOOKING] Evento calendario creato ma con ID 'pending' - non salvato nel database"),console.log("⚠️ [BOOKING] L'evento esiste nel calendario ma non pu\xf2 essere tracciato per la cancellazione"))}catch(e){console.error("Error creating Google Calendar event:",e)}})()),Q.push((async()=>{try{(0,n.f9)("\uD83D\uDCE7 Preparando invio email notifica...");let t={...e,id:W.id},o=await C(),a=(null==o?void 0:o.notificationEmail)||"mirkoditroia@gmail.com",i=(null==o?void 0:o.businessName)||"GZ Nutrition",l=(null==o?void 0:o.colorPalette)||"gz-default";(0,n.f9)("\uD83D\uDCEC Inviando email a:",a,"per",K),await s(t,K,a,i,l),(0,n.f9)("✅ Email al dottore inviata con successo!")}catch(e){console.error("❌ Errore invio email:",e)}})()),Q.length>0&&Promise.all(Q).catch(e=>{console.error("❌ Errore in operazioni non critiche:",e)}),W.id}async function m(e){var t,o,r,s,d,u,g,f,p,m,b,C,y;if(!l.db)throw Error("Firestore not configured");if(!e.id)throw Error("Booking ID is required for update");let I=await (0,a.x7)((0,a.H9)(l.db,"bookings",e.id));if(!I.exists())throw Error("Prenotazione non trovata");let E=w(e.id,I.data());if(E.slot!==e.slot&&e.slot){let a=await h(e.date),i="online"===(e.isFreeConsultation?"online":e.location||"online")?null!=(o=null!=(t=null==a?void 0:a.onlineSlots)?t:null==a?void 0:a.slots)?o:[]:null!=(r=null==a?void 0:a.inStudioSlots)?r:[];if(!a||!i.includes(e.slot))throw Error("Il nuovo orario selezionato non \xe8 pi\xf9 disponibile")}if(E.date!==e.date&&e.slot){let t=await h(e.date),o="online"===(e.isFreeConsultation?"online":e.location||"online")?null!=(d=null!=(s=null==t?void 0:t.onlineSlots)?s:null==t?void 0:t.slots)?d:[]:null!=(u=null==t?void 0:t.inStudioSlots)?u:[];if(!t||!o.includes(e.slot))throw Error("L'orario selezionato non \xe8 disponibile per la nuova data")}let P=e.id,T={clientId:null!=(g=e.clientId)?g:null,name:e.name,email:e.email,phone:null!=(f=e.phone)?f:null,packageId:null!=(p=e.packageId)?p:null,date:e.date,slot:null!=(m=e.slot)?m:null,location:e.isFreeConsultation?"online":null!=(b=e.location)?b:null,studioLocation:null!=(C=e.studioLocation)?C:null,status:e.status,priority:!!e.priority,channelPreference:null!=(y=e.channelPreference)?y:null};if(await (0,a.BN)((0,a.H9)(l.db,"bookings",P),T,{merge:!0}),console.log("\uD83D\uDD27 GOOGLE CALENDAR SYNC - Existing Event ID:",E.googleCalendarEventId),console.log("\uD83D\uDD27 GOOGLE CALENDAR SYNC - Booking Status:",e.status),console.log("\uD83D\uDD27 GOOGLE CALENDAR SYNC - Previous Status:",E.status),E.googleCalendarEventId)try{let t;if(console.log("\uD83D\uDCC5 Updating existing Google Calendar event..."),e.packageId)try{let o=await (0,a.x7)((0,a.H9)(l.db,"packages",e.packageId));o.exists()&&(t=o.data().title)}catch(e){console.error("Error getting package title for calendar event update:",e)}let o="confirmed"===e.status?!!await (0,i.hX)(E.googleCalendarEventId,e,t):await (0,i.At)(E.googleCalendarEventId);console.log("\uD83D\uDCC5 Google Calendar sync result:",o),o?(0,n.f9)("confirmed"===e.status?"Google Calendar event updated:":"Google Calendar event deleted (booking not confirmed):",E.googleCalendarEventId):console.error("Failed to update Google Calendar event:",E.googleCalendarEventId)}catch(e){console.error("Error updating Google Calendar event:",e)}else{console.log("\uD83D\uDCC5 No existing Google Calendar event, checking if we should create one...");try{let t;if(e.packageId)try{let o=await (0,a.x7)((0,a.H9)(l.db,"packages",e.packageId));o.exists()&&(t=o.data().title)}catch(e){console.error("Error getting package title for calendar event create:",e)}if("confirmed"===e.status){console.log("\uD83D\uDCC5 Creating new Google Calendar event for confirmed booking...");let o=await (0,i.hX)(void 0,e,t);console.log("\uD83D\uDCC5 New event creation result:",o?"SUCCESS":"FAILED"),o&&"pending"!==o?(await (0,a.BN)((0,a.H9)(l.db,"bookings",e.id),{googleCalendarEventId:o},{merge:!0}),(0,n.f9)("Google Calendar event created for existing booking:",o)):"pending"===o&&console.log("⚠️ [BOOKING] Evento calendario creato ma con ID 'pending' - non salvato nel database")}else console.log("\uD83D\uDCC5 Booking not confirmed, skipping calendar event creation")}catch(e){console.error("Error creating Google Calendar event on update:",e)}}if("confirmed"===e.status)try{let t=await S(e.email);if(t)await v({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"active",source:t.source||"website"});else{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione confermata del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"active",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await v(t)}}catch(e){console.error("Error creating/updating client from booking:",e)}if("confirmed"===e.status&&e.slot&&e.date)try{let t=e.date.split("T")[0],o=c.availability(l.db,t),i=await (0,a.x7)(o);if(i.exists()){let n=i.data(),l=e.isFreeConsultation?"online":e.location||"online";if("online"===l){let i=n.onlineSlots||n.slots||[];if(i.includes(e.slot)){let n=i.filter(t=>t!==e.slot);await (0,a.BN)(o,{date:t,onlineSlots:n},{merge:!0})}else console.warn("Slot ".concat(e.slot," non pi\xf9 disponibile (online) per la data ").concat(t))}else{let i=n.inStudioSlots||[];if(i.includes(e.slot)){let n=i.filter(t=>t!==e.slot);await (0,a.BN)(o,{date:t,inStudioSlots:n},{merge:!0})}else console.warn("Slot ".concat(e.slot," non pi\xf9 disponibile (studio) per la data ").concat(t))}}if(E.slot&&E.slot!==e.slot){let e=E.date.split("T")[0],t=c.availability(l.db,e),o=await (0,a.x7)(t);if(o.exists()){let i=o.data(),n=E.isFreeConsultation?"online":E.location||"online";if("online"===n){let o=i.onlineSlots||i.slots||[];if(!o.includes(E.slot)){let i=[...o,E.slot];await (0,a.BN)(t,{date:e,onlineSlots:i},{merge:!0})}}else{let o=i.inStudioSlots||[];if(!o.includes(E.slot)){let i=[...o,E.slot];await (0,a.BN)(t,{date:e,inStudioSlots:i},{merge:!0})}}}}if(E.date!==e.date&&E.slot){let e=E.date.split("T")[0],t=c.availability(l.db,e),o=await (0,a.x7)(t);if(o.exists()){let i=o.data(),n=E.isFreeConsultation?"online":E.location||"online";if("online"===n){let o=i.onlineSlots||i.slots||[];if(!o.includes(E.slot)){let i=[...o,E.slot];await (0,a.BN)(t,{date:e,onlineSlots:i},{merge:!0})}}else{let o=i.inStudioSlots||[];if(!o.includes(E.slot)){let i=[...o,E.slot];await (0,a.BN)(t,{date:e,inStudioSlots:i},{merge:!0})}}}}}catch(e){console.error("Error updating availability in Firebase:",e)}}async function b(e){if(!l.db)throw Error("Firestore not configured");let t=null;try{let r=await (0,a.x7)((0,a.H9)(l.db,"bookings",e));if(r.exists()){if((t=w(e,r.data())).googleCalendarEventId)try{console.log("\uD83D\uDDD1️ [BOOKING] Tentativo cancellazione evento calendario:",t.googleCalendarEventId),"pending"===t.googleCalendarEventId?(console.log("⚠️ [BOOKING] EventId \xe8 'pending' - tentativo cancellazione per nome e data"),console.log("\uD83D\uDD0D [BOOKING] Cercando evento nel calendario per:",{name:t.name,date:t.date,slot:t.slot}),await (0,i.At)(t.googleCalendarEventId,{name:t.name,date:t.date,slot:t.slot||""})?console.log("✅ [BOOKING] Evento calendario cancellato tramite ricerca"):(console.log("⚠️ [BOOKING] L'evento potrebbe essere presente nel calendario ma non tracciabile"),console.log("⚠️ [BOOKING] Controlla manualmente il calendario Google per eventi non cancellati"),o.e(2663).then(o.bind(o,2663)).then(e=>{let{toast:t}=e;t.error("⚠️ Controlla il calendario Google: l'evento potrebbe non essere stato cancellato automaticamente",{duration:8e3})}))):await (0,i.At)(t.googleCalendarEventId,{name:t.name,date:t.date,slot:t.slot||""})?(0,n.f9)("✅ [BOOKING] Google Calendar event deleted successfully:",t.googleCalendarEventId):(console.error("❌ [BOOKING] Failed to delete Google Calendar event:",t.googleCalendarEventId),console.warn("⚠️ [BOOKING] La prenotazione \xe8 stata eliminata dal database ma l'evento calendario potrebbe essere ancora presente"),o.e(2663).then(o.bind(o,2663)).then(e=>{let{toast:t}=e;t.error("⚠️ Controlla il calendario Google: l'evento potrebbe non essere stato cancellato automaticamente",{duration:8e3})}))}catch(a){console.error("❌ [BOOKING] Error deleting Google Calendar event:",{error:a,eventId:t.googleCalendarEventId,bookingId:e}),console.warn("⚠️ [BOOKING] La prenotazione \xe8 stata eliminata dal database ma l'evento calendario potrebbe essere ancora presente"),o.e(2663).then(o.bind(o,2663)).then(e=>{let{toast:t}=e;t.error("⚠️ Controlla il calendario Google: l'evento potrebbe non essere stato cancellato automaticamente",{duration:8e3})})}else console.log("ℹ️ [BOOKING] Nessun evento calendario da cancellare per questa prenotazione");let a=await S(t.email);if(a)await v({...a,status:"inactive",notes:a.notes?"".concat(a.notes,"\n\nPrenotazione rifiutata il ").concat(new Date().toLocaleDateString("it-IT")):"Prenotazione rifiutata il ".concat(new Date().toLocaleDateString("it-IT"))});else{let e={name:t.name,email:t.email,phone:t.phone,notes:"Cliente creato automaticamente dalla prenotazione rifiutata del ".concat(new Date(t.date).toLocaleDateString("it-IT")),status:"inactive",source:"website",assignedPackage:t.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await v(e)}}}catch(e){console.error("Error creating client from rejected booking:",e)}if(await (0,a.kd)((0,a.H9)(l.db,"bookings",e)),t&&"confirmed"===t.status&&t.slot&&t.date)try{let e=t.date.split("T")[0],o=c.availability(l.db,e),i=await (0,a.x7)(o);if(i.exists()){let n=i.data(),l=t.isFreeConsultation?"online":t.location||"online";if("online"===l){let i=n.onlineSlots||n.slots||[];if(!i.includes(t.slot)){let n=[...i,t.slot].sort();await (0,a.BN)(o,{date:e,onlineSlots:n},{merge:!0})}}else if(t.studioLocation){let i=n.studioSlots||{},l=i[t.studioLocation]||[];l.includes(t.slot)||(i[t.studioLocation]=[...l,t.slot].sort(),await (0,a.BN)(o,{date:e,studioSlots:i},{merge:!0}))}else{let i=n.inStudioSlots||[];if(!i.includes(t.slot)){let n=[...i,t.slot].sort();await (0,a.BN)(o,{date:e,inStudioSlots:n},{merge:!0})}}}}catch(e){console.error("Error restoring availability after booking deletion in Firebase:",e)}}async function v(e){var t,o,i,n,r,s,d,u,g,f,p,m,b,v,S,C,y,h,I;if(!l.db)throw Error("Firestore not configured");if(e.id){let{id:t,...o}=e,i={};return Object.entries(o).forEach(e=>{let[t,o]=e;void 0!==o&&(i[t]=o)}),await (0,a.BN)((0,a.H9)(l.db,"clients",t),i,{merge:!0}),t}return(await (0,a.gS)(c.clients(l.db),{name:e.name,email:e.email,phone:null!=(t=e.phone)?t:null,notes:null!=(o=e.notes)?o:null,birthDate:null!=(i=e.birthDate)?i:null,gender:null!=(n=e.gender)?n:null,address:null!=(r=e.address)?r:null,city:null!=(s=e.city)?s:null,postalCode:null!=(d=e.postalCode)?d:null,emergencyContact:null!=(u=e.emergencyContact)?u:null,height:null!=(g=e.height)?g:null,weight:null!=(f=e.weight)?f:null,fitnessLevel:null!=(p=e.fitnessLevel)?p:null,goals:null!=(m=e.goals)?m:[],medicalConditions:null!=(b=e.medicalConditions)?b:[],allergies:null!=(v=e.allergies)?v:[],medications:null!=(S=e.medications)?S:[],source:null!=(C=e.source)?C:null,status:null!=(y=e.status)?y:"prospect",assignedPackage:null!=(h=e.assignedPackage)?h:null,documents:null!=(I=e.documents)?I:[],createdAt:(0,a.O5)()})).id}async function S(e){var t,o;if(!l.db)return null;let i=(0,a.P)((0,a.rJ)(l.db,"clients"),(0,a._M)("email","==",e)),n=await (0,a.GG)(i);if(n.empty)return null;let r=n.docs[0],s=r.data();return{id:r.id,name:s.name,email:s.email,phone:null!=(t=s.phone)?t:void 0,notes:null!=(o=s.notes)?o:void 0,createdAt:E(s.createdAt)}}async function C(){if((0,n.f9)("getSiteContent: Inizio funzione"),(0,n.f9)("getSiteContent: Database configurato:",!!l.db),(0,n.f9)("getSiteContent: Tipo database:",typeof l.db),!l.db)return(0,n.f9)("getSiteContent: Database non configurato, return null"),null;try{var e,t,o,i,s,d,u,g,f,p,m,b,v,S,C,h,I,E,w,P,T,A,k,N,L,D,B,z,O,_,F,R,x,U;let G;(0,n.f9)("getSiteContent: Caricamento contenuto da Firebase...");let j=await (0,a.x7)(c.content(l.db));if((0,n.f9)("getSiteContent: Snap ricevuto:",j),(0,n.f9)("getSiteContent: Snap exists:",j.exists()),!j.exists()){(0,n.f9)("getSiteContent: Nessun contenuto trovato in Firebase, creo contenuto di default");let e={heroTitle:"Trasforma il tuo fisico. Potenzia la tua performance.",heroSubtitle:"Coaching nutrizionale e training su misura per giovani adulti 20–35.",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",sectionVisibility:{hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},aboutTitle:"Chi Sono",aboutBody:"Sono Gabriele Zambonin, nutrizionista e personal trainer. Ti guido con un metodo scientifico e pratico per raggiungere forma fisica, energia e benessere reale.",aboutImageUrl:"",images:[],contactTitle:"\uD83D\uDCDE Contattami",contactSubtitle:"Siamo qui per aiutarti nel tuo percorso verso una vita pi\xf9 sana. Contattaci per qualsiasi domanda o per prenotare una consulenza.",contactPhone:"+39 123 456 7890",contactEmail:"info@gznutrition.it",contactAddresses:[{name:"Studio Principale",address:"Via Roma 123",city:"Milano",postalCode:"20100",coordinates:{lat:45.4642,lng:9.19}}],socialChannels:[{platform:"Instagram",url:"https://instagram.com/gznutrition",icon:"\uD83D\uDCF8"},{platform:"LinkedIn",url:"https://linkedin.com/in/gznutrition",icon:"\uD83D\uDCBC"}],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"Siamo qui per aiutarti",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"Trova lo studio pi\xf9 vicino a te",freeConsultationPopup:{isEnabled:!0,title:"\uD83C\uDFAF 10 Minuti Consultivi Gratuiti",subtitle:"Valuta i tuoi obiettivi gratuitamente",description:"Prenota il tuo primo incontro conoscitivo gratuito per valutare i tuoi obiettivi di benessere e performance.",ctaText:"Prenota Ora - \xc8 Gratis!",packageUrl:"free-consultation"},colorPalette:"gz-default",favicon:void 0,debugLogsEnabled:!0,notificationEmail:"mirkoditroia@gmail.com",businessName:"GZ Nutrition",recaptchaEnabled:!1,recaptchaSiteKey:r.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY||"6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI",resultsSection:{isEnabled:!1,title:"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:[]},metaTags:{title:"",description:"",siteUrl:"",image:"",siteName:"GZnutrition",twitterCard:"summary_large_image",ogType:"website",locale:"it_IT"}};try{return await y(e),(0,n.f9)("getSiteContent: Contenuto di default salvato in Firebase"),e}catch(t){return console.error("getSiteContent: Errore nel salvare contenuto di default:",t),e}}let M=j.data();(0,n.f9)("getSiteContent: Contenuto caricato da Firebase:",M),(0,n.f9)("getSiteContent: Contatti - phone:",M.contactPhone),(0,n.f9)("getSiteContent: Contatti - email:",M.contactEmail),(0,n.f9)("getSiteContent: Contatti - addresses:",M.contactAddresses),(0,n.f9)("getSiteContent: Contatti - social:",M.socialChannels),(0,n.f9)("getSiteContent: Popup - freeConsultationPopup:",M.freeConsultationPopup),(0,n.f9)("getSiteContent: Popup - isEnabled:",null==(e=M.freeConsultationPopup)?void 0:e.isEnabled),(0,n.f9)("getSiteContent: Popup - title:",null==(t=M.freeConsultationPopup)?void 0:t.title);let H={heroTitle:M.heroTitle||"Trasforma il tuo fisico. Potenzia la tua performance.",heroSubtitle:M.heroSubtitle||"Coaching nutrizionale e training su misura per giovani adulti 20–35.",heroCta:M.heroCta||"Prenota ora",heroBackgroundImage:M.heroBackgroundImage||"",heroBadgeText:M.heroBadgeText||"Performance • Estetica • Energia",heroBadgeColor:M.heroBadgeColor||"bg-primary text-primary-foreground",sectionVisibility:M.sectionVisibility?{hero:!1!==M.sectionVisibility.hero,about:!1!==M.sectionVisibility.about,images:!1!==M.sectionVisibility.images,packages:!1!==M.sectionVisibility.packages,bookingForm:!1!==M.sectionVisibility.bookingForm,contact:!1!==M.sectionVisibility.contact}:{hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},navbarLogoMode:(G=M.navbarLogoMode,"image"===G||"text"===G?G:void 0),navbarLogoImageUrl:M.navbarLogoImageUrl||void 0,navbarLogoHeight:"number"==typeof M.navbarLogoHeight?M.navbarLogoHeight:void 0,navbarLogoAutoRemoveBg:!!M.navbarLogoAutoRemoveBg,navbarLogoText:M.navbarLogoText||void 0,navbarLogoTextColor:M.navbarLogoTextColor||void 0,navbarLogoTextWeight:"number"==typeof M.navbarLogoTextWeight?M.navbarLogoTextWeight:void 0,navbarLogoTextSize:"number"==typeof M.navbarLogoTextSize?M.navbarLogoTextSize:void 0,aboutTitle:M.aboutTitle||"Chi Sono",aboutBody:M.aboutBody||"Sono Gabriele Zambonin, nutrizionista e personal trainer. Ti guido con un metodo scientifico e pratico per raggiungere forma fisica, energia e benessere reale.",aboutImageUrl:M.aboutImageUrl||"",images:Array.isArray(M.images)?M.images:[],contactTitle:M.contactTitle||"\uD83D\uDCDE Contattami",contactSubtitle:M.contactSubtitle||"Siamo qui per aiutarti nel tuo percorso verso una vita pi\xf9 sana. Contattaci per qualsiasi domanda o per prenotare una consulenza.",contactPhone:M.contactPhone||"+39 123 456 7890",contactEmail:M.contactEmail||"info@gznutrition.it",contactAddresses:Array.isArray(M.contactAddresses)&&M.contactAddresses.length>0?M.contactAddresses:[{name:"Studio Principale",address:"Via Roma 123",city:"Milano",postalCode:"20100",coordinates:{lat:45.4642,lng:9.19}}],socialChannels:Array.isArray(M.socialChannels)&&M.socialChannels.length>0?M.socialChannels:[{platform:"Instagram",url:"https://instagram.com/gznutrition",icon:"\uD83D\uDCF8"},{platform:"LinkedIn",url:"https://linkedin.com/in/gznutrition",icon:"\uD83D\uDCBC"}],contactSectionTitle:M.contactSectionTitle||"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:M.contactSectionSubtitle||"Siamo qui per aiutarti",studiosSectionTitle:M.studiosSectionTitle||"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:M.studiosSectionSubtitle||"Trova lo studio pi\xf9 vicino a te",freeConsultationPopup:{isEnabled:(null==(o=M.freeConsultationPopup)?void 0:o.isEnabled)===!0||(null==(i=M.freeConsultationPopup)?void 0:i.isEnabled)==="true"||"true"===String(null==(s=M.freeConsultationPopup)?void 0:s.isEnabled),title:(null==(d=M.freeConsultationPopup)?void 0:d.title)||"\uD83C\uDFAF 10 Minuti Consultivi Gratuiti",subtitle:(null==(u=M.freeConsultationPopup)?void 0:u.subtitle)||"Valuta i tuoi obiettivi gratuitamente",description:(null==(g=M.freeConsultationPopup)?void 0:g.description)||"Prenota il tuo primo incontro conoscitivo gratuito per valutare i tuoi obiettivi di benessere e performance.",ctaText:(null==(f=M.freeConsultationPopup)?void 0:f.ctaText)||"Prenota Ora - \xc8 Gratis!",packageUrl:(null==(p=M.freeConsultationPopup)?void 0:p.packageUrl)||"free-consultation"},googleCalendar:(()=>{var e,t,o,a;let i={isEnabled:(null==(e=M.googleCalendar)?void 0:e.isEnabled)||!1,calendarId:"dc16aa394525fb01f5906273e6a3f1e47cf616ee466cedd511698e3f285288d6@group.calendar.google.com",timezone:(null==(t=M.googleCalendar)?void 0:t.timezone)||"Europe/Rome",serviceAccountEmail:(null==(o=M.googleCalendar)?void 0:o.serviceAccountEmail)||"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"};return console.log("\uD83D\uDD0D [CALENDAR CONFIG] ID utilizzato:",i.calendarId),console.log("\uD83D\uDD0D [CALENDAR CONFIG] Da database:",null==(a=M.googleCalendar)?void 0:a.calendarId),i})(),colorPalette:M.colorPalette||"gz-default",favicon:M.favicon||void 0,metaTags:M.metaTags?{title:M.metaTags.title||"",description:M.metaTags.description||"",siteUrl:M.metaTags.siteUrl||"",image:M.metaTags.image||"",siteName:M.metaTags.siteName||"GZnutrition",twitterCard:M.metaTags.twitterCard||"summary_large_image",ogType:M.metaTags.ogType||"website",locale:M.metaTags.locale||"it_IT"}:{title:"",description:"",siteUrl:"",image:"",siteName:"GZnutrition",twitterCard:"summary_large_image",ogType:"website",locale:"it_IT"},debugLogsEnabled:!1!==M.debugLogsEnabled,notificationEmail:M.notificationEmail||"mirkoditroia@gmail.com",businessName:M.businessName||"GZ Nutrition",recaptchaEnabled:!0===M.recaptchaEnabled,recaptchaSiteKey:M.recaptchaSiteKey||r.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY||"6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI",resultsSection:M.resultsSection?{isEnabled:!0===M.resultsSection.isEnabled,title:M.resultsSection.title||"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:M.resultsSection.subtitle||"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:Array.isArray(M.resultsSection.photos)?M.resultsSection.photos:[]}:{isEnabled:!1,title:"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:[]},bmiCalculator:M.bmiCalculator&&"object"==typeof M.bmiCalculator?{enabled:!0===M.bmiCalculator.enabled,title:M.bmiCalculator.title||"\uD83D\uDCCA Calcola il tuo BMI",subtitle:M.bmiCalculator.subtitle||"Scopri il tuo Indice di Massa Corporea"}:void 0,googleReviews:M.googleReviews&&"object"==typeof M.googleReviews?{enabled:!1!==M.googleReviews.enabled,title:M.googleReviews.title||"⭐ Recensioni Google",subtitle:M.googleReviews.subtitle||"Cosa dicono i nostri clienti",businessName:M.googleReviews.businessName||"GZ Nutrition",placeId:M.googleReviews.placeId||void 0,fallbackReviews:Array.isArray(M.googleReviews.fallbackReviews)?M.googleReviews.fallbackReviews.map(e=>({...e,source:e.source||"fallback"})):[]}:void 0,legalInfo:M.legalInfo?{companyName:M.legalInfo.companyName||"",vatNumber:M.legalInfo.vatNumber||"",taxCode:M.legalInfo.taxCode||"",email:M.legalInfo.email||"",registeredAddress:M.legalInfo.registeredAddress||"",footerText:M.legalInfo.footerText||"",showLegalLinks:!1!==M.legalInfo.showLegalLinks,gdprConsentText:M.legalInfo.gdprConsentText||"",cookieBanner:{enabled:(null==(m=M.legalInfo.cookieBanner)?void 0:m.enabled)!==!1,title:(null==(b=M.legalInfo.cookieBanner)?void 0:b.title)||"\uD83C\uDF6A Utilizzo dei Cookie",message:(null==(v=M.legalInfo.cookieBanner)?void 0:v.message)||"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:(null==(S=M.legalInfo.cookieBanner)?void 0:S.acceptText)||"Accetta",declineText:(null==(C=M.legalInfo.cookieBanner)?void 0:C.declineText)||"Rifiuta",learnMoreText:(null==(h=M.legalInfo.cookieBanner)?void 0:h.learnMoreText)||"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:(null==(E=M.legalInfo.legalPages)||null==(I=E.privacyPolicy)?void 0:I.title)||"Privacy Policy",lastUpdated:(null==(P=M.legalInfo.legalPages)||null==(w=P.privacyPolicy)?void 0:w.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(A=M.legalInfo.legalPages)||null==(T=A.privacyPolicy)?void 0:T.content)||""},cookiePolicy:{title:(null==(N=M.legalInfo.legalPages)||null==(k=N.cookiePolicy)?void 0:k.title)||"Cookie Policy",lastUpdated:(null==(D=M.legalInfo.legalPages)||null==(L=D.cookiePolicy)?void 0:L.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(z=M.legalInfo.legalPages)||null==(B=z.cookiePolicy)?void 0:B.content)||""},termsOfService:{title:(null==(_=M.legalInfo.legalPages)||null==(O=_.termsOfService)?void 0:O.title)||"Termini di Servizio",lastUpdated:(null==(R=M.legalInfo.legalPages)||null==(F=R.termsOfService)?void 0:F.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(U=M.legalInfo.legalPages)||null==(x=U.termsOfService)?void 0:x.content)||""}}}:{companyName:"",vatNumber:"",taxCode:"",email:"",registeredAddress:"",footerText:"",showLegalLinks:!0,gdprConsentText:"",cookieBanner:{enabled:!0,title:"\uD83C\uDF6A Utilizzo dei Cookie",message:"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:"Accetta",declineText:"Rifiuta",learnMoreText:"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:"Privacy Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},cookiePolicy:{title:"Cookie Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},termsOfService:{title:"Termini di Servizio",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""}}}};return(0,n.f9)("getSiteContent: Contenuto finale mappato:",H),(0,n.f9)("\uD83D\uDD0D getSiteContent: BMI raw da DB:",M.bmiCalculator),(0,n.f9)("\uD83D\uDD0D getSiteContent: BMI mappato finale:",H.bmiCalculator),(0,n.f9)("\uD83D\uDD0D getSiteContent: Reviews raw da DB:",M.googleReviews),(0,n.f9)("\uD83D\uDD0D getSiteContent: Reviews mappate finale:",H.googleReviews),(0,n.f9)("\uD83D\uDD0D getSiteContent: LegalInfo raw da DB:",M.legalInfo),(0,n.f9)("\uD83D\uDD0D getSiteContent: LegalInfo mappato finale:",H.legalInfo),(0,n.f9)("\uD83C\uDFAF getSiteContent: FAVICON raw da DB:",M.favicon),(0,n.f9)("\uD83C\uDFAF getSiteContent: FAVICON mappato finale:",H.favicon),(0,n.f9)("\uD83D\uDD17 getSiteContent: META TAGS raw da DB:",M.metaTags),(0,n.f9)("\uD83D\uDD17 getSiteContent: META TAGS mappati finale:",H.metaTags),H}catch(e){return console.error("getSiteContent: Errore nel caricamento da Firebase:",e),null}}async function y(e){if(!l.db)throw Error("Firestore not configured");(0,n.f9)("\uD83D\uDD25 [Firebase] upsertSiteContent chiamato"),(0,n.f9)("\uD83D\uDD25 [Firebase] Content originale:",e),(0,n.f9)("\uD83D\uDD25 [Firebase] BMI config:",e.bmiCalculator),(0,n.f9)("\uD83D\uDD25 [Firebase] Reviews config:",e.googleReviews),(0,n.f9)("\uD83D\uDD25 [Firebase] LegalInfo config:",e.legalInfo),(0,n.f9)("\uD83C\uDFAF [Firebase] FAVICON config:",e.favicon||"NESSUN FAVICON");let t=JSON.parse(JSON.stringify(e));if(t.sectionVisibility?t.sectionVisibility={hero:!1!==t.sectionVisibility.hero,about:!1!==t.sectionVisibility.about,images:!1!==t.sectionVisibility.images,packages:!1!==t.sectionVisibility.packages,bookingForm:!1!==t.sectionVisibility.bookingForm,contact:!1!==t.sectionVisibility.contact}:t.sectionVisibility={hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},t.legalInfo){var o,i,r,s,d,u,g,f,p,m,b,v,S,C,y,h,I,E,w,P,T,A,k,N;t.legalInfo={companyName:t.legalInfo.companyName||"",vatNumber:t.legalInfo.vatNumber||"",taxCode:t.legalInfo.taxCode||"",email:t.legalInfo.email||"",registeredAddress:t.legalInfo.registeredAddress||"",footerText:t.legalInfo.footerText||"",showLegalLinks:!1!==t.legalInfo.showLegalLinks,gdprConsentText:t.legalInfo.gdprConsentText||"",cookieBanner:{enabled:(null==(o=t.legalInfo.cookieBanner)?void 0:o.enabled)!==!1,title:(null==(i=t.legalInfo.cookieBanner)?void 0:i.title)||"\uD83C\uDF6A Utilizzo dei Cookie",message:(null==(r=t.legalInfo.cookieBanner)?void 0:r.message)||"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:(null==(s=t.legalInfo.cookieBanner)?void 0:s.acceptText)||"Accetta",declineText:(null==(d=t.legalInfo.cookieBanner)?void 0:d.declineText)||"Rifiuta",learnMoreText:(null==(u=t.legalInfo.cookieBanner)?void 0:u.learnMoreText)||"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:(null==(f=t.legalInfo.legalPages)||null==(g=f.privacyPolicy)?void 0:g.title)||"Privacy Policy",lastUpdated:(null==(m=t.legalInfo.legalPages)||null==(p=m.privacyPolicy)?void 0:p.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(v=t.legalInfo.legalPages)||null==(b=v.privacyPolicy)?void 0:b.content)||""},cookiePolicy:{title:(null==(C=t.legalInfo.legalPages)||null==(S=C.cookiePolicy)?void 0:S.title)||"Cookie Policy",lastUpdated:(null==(h=t.legalInfo.legalPages)||null==(y=h.cookiePolicy)?void 0:y.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(E=t.legalInfo.legalPages)||null==(I=E.cookiePolicy)?void 0:I.content)||""},termsOfService:{title:(null==(P=t.legalInfo.legalPages)||null==(w=P.termsOfService)?void 0:w.title)||"Termini di Servizio",lastUpdated:(null==(A=t.legalInfo.legalPages)||null==(T=A.termsOfService)?void 0:T.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(N=t.legalInfo.legalPages)||null==(k=N.termsOfService)?void 0:k.content)||""}}}}else t.legalInfo={companyName:"",vatNumber:"",taxCode:"",email:"",registeredAddress:"",footerText:"",showLegalLinks:!0,gdprConsentText:"",cookieBanner:{enabled:!0,title:"\uD83C\uDF6A Utilizzo dei Cookie",message:"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:"Accetta",declineText:"Rifiuta",learnMoreText:"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:"Privacy Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},cookiePolicy:{title:"Cookie Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},termsOfService:{title:"Termini di Servizio",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""}}};t.metaTags?t.metaTags={title:t.metaTags.title||"",description:t.metaTags.description||"",siteUrl:t.metaTags.siteUrl||"",image:t.metaTags.image||"",siteName:t.metaTags.siteName||"GZnutrition",twitterCard:t.metaTags.twitterCard||"summary_large_image",ogType:t.metaTags.ogType||"website",locale:t.metaTags.locale||"it_IT"}:t.metaTags={title:"",description:"",siteUrl:"",image:"",siteName:"GZnutrition",twitterCard:"summary_large_image",ogType:"website",locale:"it_IT"},(0,n.f9)("\uD83D\uDD25 [Firebase] Content sanitizzato:",t),(0,n.f9)("\uD83D\uDD25 [Firebase] BMI sanitizzato:",t.bmiCalculator),(0,n.f9)("\uD83D\uDD25 [Firebase] Reviews sanitizzato:",t.googleReviews),(0,n.f9)("\uD83D\uDD25 [Firebase] LegalInfo sanitizzato:",t.legalInfo),(0,n.f9)("\uD83D\uDD25 [Firebase] \uD83D\uDD17 META TAGS sanitizzato:",t.metaTags),(0,n.f9)("\uD83D\uDD25 [Firebase] Chiamando setDoc..."),await (0,a.BN)(c.content(l.db),t,{merge:!0}),(0,n.f9)("\uD83D\uDD25 [Firebase] ✅ setDoc completato con successo")}async function h(e){if(!l.db)return null;(0,n.f9)("\uD83D\uDD0D getAvailabilityByDate Firebase per data:",e);let t=await (0,a.x7)(c.availability(l.db,e));if(!t.exists())return(0,n.f9)("❌ Nessun documento availability trovato per data:",e),null;let o=t.data();(0,n.f9)("\uD83D\uDCCA Dati raw da Firebase per",e,":",o);let i={date:e,onlineSlots:Array.isArray(o.onlineSlots)?o.onlineSlots:Array.isArray(o.slots)?o.slots:[],inStudioSlots:Array.isArray(o.inStudioSlots)?o.inStudioSlots:[],studioSlots:o.studioSlots&&"object"==typeof o.studioSlots?o.studioSlots:{},slots:Array.isArray(o.slots)?o.slots:void 0,freeConsultationSlots:Array.isArray(o.freeConsultationSlots)?o.freeConsultationSlots:[],legacyFreeConsultationSlots:Array.isArray(o.legacyFreeConsultationSlots)?o.legacyFreeConsultationSlots:void 0};return(0,n.f9)("✅ Availability processata:",i),(0,n.f9)("\uD83C\uDFAF freeConsultationSlots trovati:",i.freeConsultationSlots),i}async function I(e,t,o,i,n){if(!l.db)throw Error("Firestore not configured");let r={date:e,onlineSlots:t};Array.isArray(o)&&(r.freeConsultationSlots=o),Array.isArray(i)&&(r.inStudioSlots=i),n&&"object"==typeof n&&(r.studioSlots=n),await (0,a.BN)(c.availability(l.db,e),r,{merge:!0})}function E(e){if(e)try{return e.toDate().toISOString()}catch(e){return}}function w(e,t){var o,a,i,n,l,r,s,c,d,u;return{id:e,clientId:null!=(o=t.clientId)?o:void 0,name:t.name,email:t.email,phone:null!=(a=t.phone)?a:void 0,packageId:null!=(i=t.packageId)?i:void 0,date:t.date,slot:null!=(n=t.slot)?n:void 0,location:null!=(l=t.location)?l:void 0,studioLocation:null!=(r=t.studioLocation)?r:void 0,status:t.status,priority:!!t.priority,channelPreference:null!=(s=t.channelPreference)?s:void 0,isFreeConsultation:!!t.isFreeConsultation,consultationDuration:null!=(c=t.consultationDuration)?c:void 0,notes:null!=(d=t.notes)?d:void 0,createdAt:E(t.createdAt),googleCalendarEventId:null!=(u=t.googleCalendarEventId)?u:void 0}}function P(e,t){var o,a,i,n,l,r,s,c,d,u,g,f,p,m;return{id:e,name:t.name,email:t.email,phone:null!=(o=t.phone)?o:void 0,notes:null!=(a=t.notes)?a:void 0,birthDate:null!=(i=t.birthDate)?i:void 0,gender:null!=(n=t.gender)?n:void 0,address:null!=(l=t.address)?l:void 0,city:null!=(r=t.city)?r:void 0,postalCode:null!=(s=t.postalCode)?s:void 0,emergencyContact:null!=(c=t.emergencyContact)?c:void 0,height:null!=(d=t.height)?d:void 0,weight:null!=(u=t.weight)?u:void 0,fitnessLevel:null!=(g=t.fitnessLevel)?g:void 0,goals:Array.isArray(t.goals)?t.goals:[],medicalConditions:Array.isArray(t.medicalConditions)?t.medicalConditions:[],allergies:Array.isArray(t.allergies)?t.allergies:[],medications:Array.isArray(t.medications)?t.medications:[],source:null!=(f=t.source)?f:void 0,status:null!=(p=t.status)?p:"prospect",assignedPackage:null!=(m=t.assignedPackage)?m:void 0,documents:Array.isArray(t.documents)?t.documents:[],createdAt:E(t.createdAt)}}async function T(){return l.db?(await (0,a.GG)((0,a.P)(c.clients(l.db),(0,a.My)("createdAt","desc")))).docs.map(e=>P(e.id,e.data())):[]}async function A(e){if(!l.db)return null;let t=l.db,o=await (0,a.x7)((0,a.H9)(t,"clients",e));return o.exists()?P(o.id,o.data()):null}async function k(e){if(!l.db)throw Error("Firestore not configured");await (0,a.kd)((0,a.H9)(l.db,"clients",e))}async function N(e){if(!l.db)throw Error("Firestore not configured");let t={...e,createdAt:(0,a.O5)()};return(await (0,a.gS)((0,a.rJ)(l.db,"clientProgress"),t)).id}async function L(e){if(!l.db)return[];try{let t=(0,a.P)((0,a.rJ)(l.db,"clientProgress"),(0,a._M)("clientId","==",e),(0,a.My)("date","desc"));return(await (0,a.GG)(t)).docs.map(e=>{var t,o,a;let i=e.data();return{id:e.id,clientId:i.clientId,date:i.date,weight:i.weight,bodyFat:i.bodyFat,muscleMass:i.muscleMass,measurements:i.measurements,notes:i.notes,photos:i.photos,createdAt:(null==(a=i.createdAt)||null==(o=a.toDate)||null==(t=o.call(a))?void 0:t.toISOString())||new Date().toISOString()}})}catch(o){(0,n.f9)("Indice non ancora pronto, uso query senza ordinamento");let t=(0,a.P)((0,a.rJ)(l.db,"clientProgress"),(0,a._M)("clientId","==",e));return(await (0,a.GG)(t)).docs.map(e=>{var t,o,a;let i=e.data();return{id:e.id,clientId:i.clientId,date:i.date,weight:i.weight,bodyFat:i.bodyFat,muscleMass:i.muscleMass,measurements:i.measurements,notes:i.notes,photos:i.photos,createdAt:(null==(a=i.createdAt)||null==(o=a.toDate)||null==(t=o.call(a))?void 0:t.toISOString())||new Date().toISOString()}}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())}}async function D(e,t){if(!l.db)throw Error("Firestore not configured");let{id:o,createdAt:i,...n}=t;await (0,a.mZ)((0,a.H9)(l.db,"clientProgress",e),n)}async function B(e){if(!l.db)throw Error("Firestore not configured");await (0,a.kd)((0,a.H9)(l.db,"clientProgress",e))}async function z(e){if(!l.db)throw Error("Firestore not configured");let t=await S(e.email);if(t)return await v({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"prospect",source:t.source||"website"}),t.id;{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione in attesa del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"prospect",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};return await v(t)}}},5197:(e,t,o)=>{async function a(e,t){console.log("\uD83D\uDD27 createCalendarEvent called for booking:",e.name,"Status:",e.status);try{let o=await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",booking:e,packageTitle:t})});if(console.log("\uD83D\uDD27 createCalendarEvent API response status:",o.status),!o.ok){let e=await o.text();throw console.error("\uD83D\uDD27 createCalendarEvent API error:",e),Error("HTTP error! status: ".concat(o.status))}let a=await o.json();if(console.log("\uD83D\uDD27 createCalendarEvent API result:",a),!a.success)return console.error("Failed to create calendar event:",a.message),null;if(console.log("Google Calendar event created:",a.eventId),"pending"===a.eventId)return console.log('⚠️ [CALENDAR] EventId \xe8 "pending" - evento in creazione asincrona'),console.log("⚠️ [CALENDAR] L'evento verr\xe0 creato nel calendario ma non avremo l'ID reale"),null;return a.eventId}catch(e){return console.error("Error creating Google Calendar event:",e),null}}async function i(e,t,o){try{let a=await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update",eventId:e,booking:t,packageTitle:o})});if(!a.ok)return!1;let i=await a.json();if(i.success)return console.log("Google Calendar event updated:",e),!0;return console.error("Failed to update calendar event:",i.message),!1}catch(e){return console.error("Error updating Google Calendar event:",e),!1}}async function n(e,t,o){return(console.log("\uD83D\uDD27 ensureCalendarEvent called - existingEventId:",e,"booking:",t.name),e&&"pending"!==e)?(console.log("\uD83D\uDD27 ensureCalendarEvent - updating existing event:",e),await i(e,t,o))?(console.log("\uD83D\uDD27 ensureCalendarEvent - update successful"),e):(console.log("\uD83D\uDD27 ensureCalendarEvent - update failed, creating new event"),await a(t,o)):("pending"===e?console.log("\uD83D\uDD27 ensureCalendarEvent - existing eventId is pending, creating new event"):console.log("\uD83D\uDD27 ensureCalendarEvent - no existing event, creating new one"),await a(t,o))}async function l(e,t,o){console.log("\uD83D\uDD0D [CALENDAR] Tentativo cancellazione per ricerca:",{bookingName:e,bookingDate:t,bookingSlot:o});try{let a=await fetch("/api/calendar",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete_by_search",bookingName:e,bookingDate:t,bookingSlot:o})});if(a.ok&&(await a.json()).success)return console.log("✅ [CALENDAR] Evento cancellato tramite ricerca"),!0;return console.log("⚠️ [CALENDAR] Cancellazione per ricerca non supportata o fallita"),!1}catch(e){return console.error("❌ [CALENDAR] Errore nella cancellazione per ricerca:",e),!1}}async function r(e,t){if(console.log("\uD83D\uDDD1️ [CALENDAR] Inizio cancellazione evento:",e),"pending"===e)return(console.log('⚠️ [CALENDAR] EventId \xe8 "pending" - tentativo cancellazione per ricerca'),t)?(console.log("\uD83D\uDD0D [CALENDAR] Tentativo cancellazione per nome e data:",t),await l(t.name,t.date,t.slot)):(console.log("⚠️ [CALENDAR] Nessun dato prenotazione fornito per ricerca"),console.log("✅ [CALENDAR] Considerato successo (evento potrebbe non esistere)"),!0);try{let t=await fetch("/api/calendar",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:e})});if(console.log("\uD83D\uDDD1️ [CALENDAR] Response status:",t.status),console.log("\uD83D\uDDD1️ [CALENDAR] Response headers:",Object.fromEntries(t.headers.entries())),!t.ok){let e=await t.text();throw console.error("❌ [CALENDAR] HTTP error response:",{status:t.status,statusText:t.statusText,errorText:e}),Error("HTTP error! status: ".concat(t.status,", message: ").concat(e))}let o=await t.json();if(console.log("\uD83D\uDDD1️ [CALENDAR] Response result:",o),o.success)return console.log("✅ [CALENDAR] Google Calendar event deleted successfully:",e),!0;return console.error("❌ [CALENDAR] Failed to delete calendar event:",{message:o.message,error:o.error,eventId:e}),!1}catch(t){return console.error("❌ [CALENDAR] Error deleting Google Calendar event:",{error:t,eventId:e,errorMessage:t instanceof Error?t.message:"Unknown error"}),!1}}async function s(){try{let e=await fetch("/api/calendar",{method:"GET"});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){return console.error("Google Calendar connection test failed:",e),{success:!1,message:e instanceof Error?e.message:"Connection test failed"}}}o.d(t,{At:()=>r,Zl:()=>s,hX:()=>n}),o(5704)},9018:(e,t,o)=>{o.r(t),o.d(t,{createBooking:()=>f,createClientFromPendingBooking:()=>h,deleteBooking:()=>m,deleteClient:()=>y,deleteClientProgress:()=>L,deletePackage:()=>u,getAvailabilityByDate:()=>w,getClientByEmail:()=>v,getClientById:()=>C,getClientProgress:()=>k,getDataMode:()=>n,getPackages:()=>c,getSiteContent:()=>I,listBookings:()=>g,listClients:()=>S,saveClientProgress:()=>A,updateBooking:()=>p,updateClientProgress:()=>N,upsertAvailabilityForDate:()=>P,upsertClient:()=>b,upsertPackage:()=>d,upsertSiteContent:()=>E});var a=o(4368),i=o(5704);function n(){let e=i.env.NEXT_PUBLIC_DATA_MODE;if("local"===e||"demo"===e||"firebase"===e)return console.log("[DataMode] Override detected:",e),e;let t="AIzaSyAp1IXe0d2yE-BSrZLGKHfDkdkm1NuSwfs";return(console.log("[DataMode] Production mode, Firebase configured:",t),t)?(console.log("[DataMode] Using firebase mode"),"firebase"):(console.log("[DataMode] Using demo mode"),"demo")}var l=o(576);async function r(e){try{let t,o=await I(),a=(null==o?void 0:o.notificationEmail)||"mirkoditroia@gmail.com",i=(null==o?void 0:o.businessName)||"GZ Nutrition",n=(null==o?void 0:o.colorPalette)||"gz-default";if(e.packageId)try{let o=(await c()).find(t=>t.id===e.packageId);o&&(t=o.title)}catch(e){console.error("Error getting package title for calendar event:",e)}e.isFreeConsultation&&(t="Consultazione Gratuita (10 minuti)");let r=await fetch("https://sendbookingnotification-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"new-booking",booking:e,packageTitle:t,notificationEmail:a,businessName:i,colorPalette:n})}),s=await r.json();s.success?((0,l.f9)("✅ Booking notification (dottore) sent successfully:",s.sentTo),e.isFreeConsultation&&(0,l.f9)("\uD83D\uDCE7 Email sent for free consultation booking")):console.error("❌ Failed to send booking notification:",s.message)}catch(e){console.error("❌ Error sending booking notification:",e)}}async function s(e,t){try{let o=await fetch(e,{cache:"no-store"});if(!o.ok)return t;return await o.json()}catch(e){return t}}async function c(){let e=n();if("firebase"===e)return(0,a.G9)();if("demo"===e)return s("/demo/packages.json",[]);try{let e=await fetch("/api/localdb/packages",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function d(e){var t;let o=n();if("firebase"===o)return(0,a.Kh)(e);if("demo"===o)throw Error("Preprod demo read-only");let i=null!=(t=e.id)?t:T(),l=await c(),r=[{...e,id:i},...l.filter(e=>e.id!==i)];return await fetch("/api/localdb/packages",{method:"POST",body:JSON.stringify(r)}),i}async function u(e){let t=n();if("firebase"===t){let{deletePackage:t}=await Promise.resolve().then(o.bind(o,4368));return t(e)}if("demo"===t)throw Error("Preprod demo read-only");let a=(await c()).filter(t=>t.id!==e);await fetch("/api/localdb/packages",{method:"POST",body:JSON.stringify(a)})}async function g(){let e=n();if("firebase"===e)return(0,a.ZY)();if("demo"===e)return s("/demo/bookings.json",[]);try{let e=await fetch("/api/localdb/bookings",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function f(e,t){var o,i,l,s,c,d,u,g,f,p,m,b,v,S,C,y,h,I;let E=n();if("firebase"===E)return(0,a.sH)(e,t);if("demo"===E)throw Error("Preprod demo read-only");if(!e.slot)throw Error("Lo slot orario \xe8 obbligatorio per la prenotazione");let A=await w(e.date),k=e.isFreeConsultation?"online":e.location||"online",N="online"===k?null!=(l=null!=(i=null==A?void 0:A.onlineSlots)?i:null==A?void 0:A.slots)?l:[]:e.studioLocation?null!=(s=null==A||null==(o=A.studioSlots)?void 0:o[e.studioLocation])?s:[]:null!=(c=null==A?void 0:A.inStudioSlots)?c:[];if(!A||!N.includes(e.slot))throw Error("L'orario selezionato non \xe8 pi\xf9 disponibile");let L=T(),D=new Date().toISOString();try{let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),o=t.ok?await t.json():[],a=[{...e,id:L,createdAt:D},...o];if(await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(a)}),"online"===k){let t=(null!=(u=null!=(d=A.onlineSlots)?d:A.slots)?u:[]).filter(t=>t!==e.slot);await P(e.date,t,A.freeConsultationSlots,null!=(g=A.inStudioSlots)?g:[],null!=(f=A.studioSlots)?f:{})}else if(e.studioLocation){let t={...null!=(p=A.studioSlots)?p:{}};t[e.studioLocation]=(null!=(m=t[e.studioLocation])?m:[]).filter(t=>t!==e.slot),await P(e.date,null!=(v=null!=(b=A.onlineSlots)?b:A.slots)?v:[],A.freeConsultationSlots,null!=(S=A.inStudioSlots)?S:[],t)}else{let t=(null!=(C=A.inStudioSlots)?C:[]).filter(t=>t!==e.slot);await P(e.date,null!=(h=null!=(y=A.onlineSlots)?y:A.slots)?h:[],A.freeConsultationSlots,t,null!=(I=A.studioSlots)?I:{})}let i={...e,id:L,createdAt:D};return r(i).catch(e=>{console.error("❌ Errore invio notifica locale:",e)}),L}catch(t){return await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify([{...e,id:L,createdAt:D}])}),r({...e,id:L,createdAt:D}).catch(e=>{console.error("❌ Errore invio notifica locale (fallback):",e)}),L}}async function p(e){let t=n();if("firebase"===t)return(0,a.vq)(e);if("demo"===t)throw Error("Preprod demo read-only");try{var o,i,r,s,c,d;let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),a=t.ok?await t.json():[],n=a.find(t=>t.id===e.id);if(n&&n.slot!==e.slot&&e.slot){let t=await w(e.date),a=e.isFreeConsultation?"online":e.location||"online",n="online"===a?null!=(i=null!=(o=null==t?void 0:t.onlineSlots)?o:null==t?void 0:t.slots)?i:[]:null!=(r=null==t?void 0:t.inStudioSlots)?r:[];if(!t||!n.includes(e.slot))throw Error("Il nuovo orario selezionato non \xe8 pi\xf9 disponibile")}if(n&&n.date!==e.date&&e.slot){let t=await w(e.date),o=e.isFreeConsultation?"online":e.location||"online",a="online"===o?null!=(c=null!=(s=null==t?void 0:t.onlineSlots)?s:null==t?void 0:t.slots)?c:[]:null!=(d=null==t?void 0:t.inStudioSlots)?d:[];if(!t||!a.includes(e.slot))throw Error("L'orario selezionato non \xe8 disponibile per la nuova data")}let u=a.map(t=>t.id===e.id?e:t);await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(u)}),(0,l.f9)("\uD83D\uDCCB Prenotazione aggiornata:",e.id,"- gestione disponibilit\xe0 delegata al sistema principale")}catch(e){throw console.error("Error updating booking:",e),e}}async function m(e){let t=n();if("firebase"===t)return(0,a.VA)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),o=t.ok?await t.json():[],a=o.find(t=>t.id===e),i=o.filter(t=>t.id!==e);await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(i)}),(0,l.f9)("\uD83D\uDCCB Prenotazione cancellata:",null==a?void 0:a.id,"- availability gestita dal sistema principale")}catch(e){throw console.error("Error deleting booking:",e),e}}async function b(e){var t,o,i;let l=n();if("firebase"===l)return(0,a.TP)(e);if("demo"===l)throw Error("Preprod demo read-only");let r=function(e,t){try{let o=localStorage.getItem(e);return o?JSON.parse(o):t}catch(e){return t}}("gzn:clients",[]),s=null!=(t=e.id)?t:T();return o="gzn:clients",i=[{...e,id:s},...r.filter(e=>e.id!==s)],localStorage.setItem(o,JSON.stringify(i)),s}async function v(e){var t,o;let i=n();if("firebase"===i)return(0,a.dd)(e);if("demo"===i)return null!=(t=(await s("/demo/clients.json",[])).find(t=>t.email===e))?t:null;try{let t=await fetch("/api/localdb/clients",{cache:"no-store"});return null!=(o=(t.ok?await t.json():[]).find(t=>t.email===e))?o:null}catch(e){return null}}async function S(){let e=n();if("firebase"===e)return(0,a.by)();if("demo"===e)return s("/demo/clients.json",[]);try{let e=await fetch("/api/localdb/clients",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function C(e){var t,o;let i=n();if("firebase"===i)return(0,a.EZ)(e);if("demo"===i)return null!=(t=(await s("/demo/clients.json",[])).find(t=>t.id===e))?t:null;try{let t=await fetch("/api/localdb/clients",{cache:"no-store"});return null!=(o=(t.ok?await t.json():[]).find(t=>t.id===e))?o:null}catch(e){return null}}async function y(e){let t=n();if("firebase"===t)return(0,a.zZ)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/clients",{cache:"no-store"}),o=(t.ok?await t.json():[]).filter(t=>t.id!==e);await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(o)})}catch(e){throw console.error("Error deleting client:",e),e}}async function h(e){let t=n();if("firebase"===t)return(0,a.Wi)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/clients",{cache:"no-store"}),o=t.ok?await t.json():[],a=o.find(t=>t.email===e.email);if(a){let t={...a,name:e.name,phone:e.phone||a.phone,assignedPackage:e.packageId||a.assignedPackage,status:"prospect",source:a.source||"website"},i=o.map(e=>e.id===a.id?t:e);return await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(i)}),a.id}{let t={id:crypto.randomUUID(),name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione in attesa del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"prospect",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()},a=[t,...o];return await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(a)}),t.id}}catch(e){throw console.error("Error creating client from pending booking:",e),e}}async function I(){let e=n();if((0,l.f9)("[getSiteContent] Modalit\xe0:",e,"Server:",!1),"firebase"===e)return(0,a.fH)();if("demo"===e)return s("/demo/siteContent.json",{heroTitle:"",heroSubtitle:"",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",images:[],contactTitle:"",contactSubtitle:"",contactPhone:"",contactEmail:"",contactAddresses:[],socialChannels:[],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"",colorPalette:"gz-default",googleCalendar:{isEnabled:!1,calendarId:"dc16aa394525fb01f5906273e6a3f1e47cf616ee466cedd511698e3f285288d6@group.calendar.google.com",timezone:"Europe/Rome",serviceAccountEmail:"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"}});try{(0,l.f9)("[getSiteContent] Tentativo caricamento da:","".concat("","/api/localdb/siteContent"));let e=await fetch("".concat("","/api/localdb/siteContent"),{cache:"no-store"});if((0,l.f9)("[getSiteContent] Risposta API:",e.status,e.statusText),e.ok){let t=await e.json();return(0,l.f9)("[getSiteContent] Contenuto caricato, favicon:",(null==t?void 0:t.favicon)||"nessuno"),t}}catch(e){console.error("[getSiteContent] Errore nel caricamento locale:",e)}return{heroTitle:"",heroSubtitle:"",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",aboutTitle:"",aboutBody:"",aboutImageUrl:"",images:[],contactTitle:"",contactSubtitle:"",contactPhone:"",contactEmail:"",contactAddresses:[],socialChannels:[],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"",colorPalette:"gz-default",favicon:void 0,googleCalendar:{isEnabled:!1,calendarId:"dc16aa394525fb01f5906273e6a3f1e47cf616ee466cedd511698e3f285288d6@group.calendar.google.com",timezone:"Europe/Rome",serviceAccountEmail:"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"}}}async function E(e){let t=n();if((0,l.f9)("[upsertSiteContent] Current mode:",t),(0,l.f9)("[upsertSiteContent] \uD83D\uDCCA BMI config being saved:",e.bmiCalculator),(0,l.f9)("[upsertSiteContent] ⭐ Reviews config being saved:",e.googleReviews),(0,l.f9)("[upsertSiteContent] ⚖️ LegalInfo config being saved:",e.legalInfo),(0,l.f9)("[upsertSiteContent] \uD83D\uDD17 META TAGS being saved:",e.metaTags),(0,l.f9)("[upsertSiteContent] \uD83C\uDFAF FAVICON being saved:",e.favicon||"NESSUN FAVICON"),"firebase"===t){(0,l.f9)("[upsertSiteContent] Using Firebase"),(0,l.f9)("[upsertSiteContent] \uD83D\uDD25 Calling Firebase upsert..."),await (0,a._L)(e),(0,l.f9)("[upsertSiteContent] ✅ Firebase upsert completed");return}if("demo"===t)throw(0,l.f9)("[upsertSiteContent] Demo mode - throwing read-only error"),Error("Preprod demo read-only");(0,l.f9)("[upsertSiteContent] Using local API"),(0,l.f9)("[upsertSiteContent] \uD83D\uDCE4 Sending to local API...");let o=await fetch("/api/localdb/siteContent",{method:"POST",body:JSON.stringify(e)});if((0,l.f9)("[upsertSiteContent] \uD83D\uDCE5 Local API response:",o.status,o.statusText),!o.ok)throw Error("Local API failed: ".concat(o.status," ").concat(o.statusText))}async function w(e){let t=n();if((0,l.f9)("\uD83C\uDF10 [SITO PUBBLICO] getAvailabilityByDate chiamata per:",e,"modalit\xe0:",t),"firebase"===t){let t=await (0,a.ho)(e);return(0,l.f9)("\uD83D\uDD25 [SITO PUBBLICO] Risultato da Firebase:",t),t}if("demo"===t)return s("/demo/availability/".concat(e,".json"),{date:e,slots:[]});try{let t=await fetch("/api/localdb/availability",{cache:"no-store"}),a=(t.ok?await t.json():{})[e];if((0,l.f9)("\uD83D\uDCBE [SITO PUBBLICO] Dati locali per",e,":",a),a){var o,i,r,c,d;let t={date:e,onlineSlots:null!=(i=null!=(o=a.onlineSlots)?o:a.slots)?i:[],inStudioSlots:null!=(r=a.inStudioSlots)?r:[],studioSlots:null!=(c=a.studioSlots)?c:{},slots:a.slots,freeConsultationSlots:(null!=(d=a.freeConsultationSlots)?d:[]).map(e=>"string"==typeof e?{time:e,duration:10}:e)};return(0,l.f9)("✅ [SITO PUBBLICO] Risultato locale processato:",t),t}return(0,l.f9)("❌ [SITO PUBBLICO] Nessun dato trovato per:",e),{date:e,onlineSlots:[],inStudioSlots:[],freeConsultationSlots:[]}}catch(t){return console.error("❌ [SITO PUBBLICO] Errore caricamento dati:",t),{date:e,onlineSlots:[],inStudioSlots:[],freeConsultationSlots:[]}}}async function P(e,t,o,i,l){let r=n();if("firebase"===r)return(0,a.wb)(e,t,o,i,l);if("demo"===r)throw Error("Preprod demo read-only");try{var s,c;let a=await fetch("/api/localdb/availability",{cache:"no-store"}),n=a.ok?await a.json():{};n[e]={onlineSlots:t,inStudioSlots:i||[],freeConsultationSlots:Array.isArray(o)?o.map(e=>"string"==typeof e?e:e.time):[],studioSlots:null!=(c=null!=l?l:null==(s=n[e])?void 0:s.studioSlots)?c:{}},await fetch("/api/localdb/availability",{method:"POST",body:JSON.stringify(n)})}catch(e){}}function T(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)}async function A(e){if("local"===n()){let t=T(),o={...e,id:t,createdAt:new Date().toISOString()},a=JSON.parse(localStorage.getItem("clientProgress")||"[]");return a.push(o),localStorage.setItem("clientProgress",JSON.stringify(a)),t}return(0,a.u2)(e)}async function k(e){return"local"===n()?JSON.parse(localStorage.getItem("clientProgress")||"[]").filter(t=>t.clientId===e).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()):(0,a.HG)(e)}async function N(e,t){if("local"===n()){let o=JSON.parse(localStorage.getItem("clientProgress")||"[]"),a=o.findIndex(t=>t.id===e);-1!==a&&(o[a]={...o[a],...t},localStorage.setItem("clientProgress",JSON.stringify(o)));return}return(0,a.Ej)(e,t)}async function L(e){if("local"===n()){let t=JSON.parse(localStorage.getItem("clientProgress")||"[]").filter(t=>t.id!==e);localStorage.setItem("clientProgress",JSON.stringify(t));return}return(0,a.KB)(e)}}}]);