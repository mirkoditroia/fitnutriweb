"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3936],{3998:(e,t,o)=>{o.d(t,{$:()=>l});var a=o(95155),r=o(12115),n=o(75889),i=o(2821);let l=(0,r.forwardRef)((e,t)=>{let{className:o,variant:r="primary",size:l="md",fullWidth:s,...c}=e;return(0,a.jsx)("button",{ref:t,className:(0,n.QP)((0,i.$)("btn",{primary:"btn-primary",secondary:"btn-outline",ghost:"hover:bg-[color:var(--muted-bg)]",outline:"btn-outline"}[r],{sm:"px-3 py-1 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"}[l],s&&"w-full"),o),...c})});l.displayName="Button"},29060:(e,t,o)=>{o.d(t,{AT:()=>r,LH:()=>a});let a={"gz-default":{name:"Default",description:"Palette originale verde professionale",primary:"#0B5E0B",accent:"#00D084",background:"#FFFFFF",foreground:"#0E0F12",border:"#E2E8F0",card:"#FFFFFF",muted:"#F1F5F9",navbarBg:"rgba(0,0,0,0.8)",navbarText:"#FFFFFF",secondaryBg:"#F8FAFC",secondaryText:"#475569"},"modern-blue":{name:"Modern Blue",description:"Blu moderno e professionale",primary:"#2563EB",accent:"#3B82F6",background:"#FFFFFF",foreground:"#1E293B",border:"#E2E8F0",card:"#FFFFFF",muted:"#F1F5F9",navbarBg:"rgba(30, 41, 59, 0.9)",navbarText:"#FFFFFF",secondaryBg:"#EFF6FF",secondaryText:"#1E40AF"},"elegant-dark":{name:"Elegant Dark",description:"Elegante scuro con accenti dorati",primary:"#D97706",accent:"#F59E0B",background:"#FFFFFF",foreground:"#1F2937",border:"#E5E7EB",card:"#FFFFFF",muted:"#F9FAFB",navbarBg:"rgba(17, 24, 39, 0.95)",navbarText:"#F9FAFB",secondaryBg:"#FEF3C7",secondaryText:"#92400E"},"nature-green":{name:"Nature Green",description:"Verde naturale e rilassante",primary:"#059669",accent:"#10B981",background:"#FFFFFF",foreground:"#1F2937",border:"#D1FAE5",card:"#FFFFFF",muted:"#F0FDF4",navbarBg:"rgba(6, 78, 59, 0.9)",navbarText:"#FFFFFF",secondaryBg:"#ECFDF5",secondaryText:"#047857"},"warm-orange":{name:"Warm Orange",description:"Arancione caldo ed energico",primary:"#EA580C",accent:"#FB923C",background:"#FFFFFF",foreground:"#1C1917",border:"#E7E5E4",card:"#FFFFFF",muted:"#FAFAF9",navbarBg:"rgba(124, 45, 18, 0.9)",navbarText:"#FFFFFF",secondaryBg:"#FED7AA",secondaryText:"#C2410C"},"professional-gray":{name:"Professional Gray",description:"Grigio professionale e neutro",primary:"#374151",accent:"#6B7280",background:"#FFFFFF",foreground:"#111827",border:"#E5E7EB",card:"#FFFFFF",muted:"#F9FAFB",navbarBg:"rgba(17, 24, 39, 0.9)",navbarText:"#F9FAFB",secondaryBg:"#F3F4F6",secondaryText:"#374151"}};function r(e){return a[e]||a["gz-default"]}},64986:(e,t,o)=>{o.d(t,{J5:()=>r,v4:()=>n});let a="gznutrition_state",r=()=>{let e=new URLSearchParams(window.location.search).get("packageId");if(e){let t={selectedPackageId:e,isFreeConsultation:"free-consultation"===e};return localStorage.setItem(a,JSON.stringify(t)),t}try{let e=localStorage.getItem(a);if(e)return JSON.parse(e)}catch(e){console.error("DirectState: Errore lettura localStorage:",e)}return{selectedPackageId:null,isFreeConsultation:!1}},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={selectedPackageId:e,isFreeConsultation:t};if(console.log("DirectState: Impostazione stato:",o),localStorage.setItem(a,JSON.stringify(o)),e){let t=new URL(window.location.href);t.searchParams.set("packageId",e),window.history.replaceState({},"",t.toString())}window.dispatchEvent(new CustomEvent("directStateChange",{detail:o}))}},65142:(e,t,o)=>{o.d(t,{p:()=>i});var a=o(95155),r=o(12115),n=o(75889);let i=(0,r.forwardRef)((e,t)=>{let{className:o,label:r,error:i,id:l,...s}=e,c=l||s.name||"input";return(0,a.jsxs)("div",{className:"w-full",children:[r&&(0,a.jsx)("label",{htmlFor:c,className:"block text-sm font-medium mb-1 text-foreground",children:r}),(0,a.jsx)("input",{id:c,ref:t,className:(0,n.QP)("w-full rounded-lg border border-foreground/10 bg-background/70 backdrop-blur-sm px-3.5 py-2.5 text-sm text-foreground placeholder:text-foreground/50","focus:outline-none focus:ring-4 focus:ring-[rgba(var(--primary-rgb),0.15)] focus:ring-offset-0",i&&"border-accent",o),"aria-invalid":!!i,"aria-describedby":i?"".concat(c,"-error"):void 0,...s}),i&&(0,a.jsx)("p",{id:"".concat(c,"-error"),className:"mt-1 text-xs text-destructive",children:i})]})});i.displayName="Input"},83936:(e,t,o)=>{o.d(t,{BookingForm:()=>S});var a=o(95155),r=o(12115),n=o(22544),i=o(66942),l=o(72377),s=o(3998),c=o(65142),d=o(99018),m=o(10576),u=o(78674),p=o(88901),g=o(87205),x=o(75513),b=o(99228),f=o(72473),h=o(70063),v=o(92381),y=o(93366),F=o(50569),N=o(64986),j=o(22663),k=o(1141),P=o(29060);let C=l.Ik({name:l.Yj().min(2,"Nome troppo corto"),email:l.Yj().email("Email non valida"),phone:l.Yj().min(7,"Telefono obbligatorio").regex(/^[+0-9\s-]+$/,"Formato non valido"),date:l.Yj().min(1,"Seleziona una data"),slot:l.Yj().min(1,"Seleziona un orario disponibile"),location:l.k5(["online","studio"]).optional(),packageId:l.Yj().optional(),notes:l.Yj().optional(),gdprConsent:l.zM().refine(e=>!0===e,{message:"Devi accettare il trattamento dei dati personali per continuare"})});function w(e){let{availableDates:t,selectedDate:o,onDateSelect:n,showPromotionalBanner:i}=e,[l,s]=(0,r.useState)(new Date),[c,d]=(0,r.useState)(!1),m=(0,u.w)(l),v=(0,p.p)(l),y=(0,g.k)({start:m,end:v}),N=e=>{let o=(0,f.GP)(e,"yyyy-MM-dd");return t.includes(o)};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-full p-3 border border-border rounded-lg bg-background text-foreground cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>d(!c),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:o?"text-foreground":"text-foreground/60",children:o?(0,f.GP)(new Date(o),"EEEE d MMMM yyyy",{locale:F.it}):"Seleziona una data"}),(0,a.jsx)("span",{className:"text-gray-600",children:"\uD83D\uDCC5"})]})}),c&&(0,a.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-2 bg-background border border-border rounded-lg shadow-lg z-50 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("button",{onClick:()=>s((0,b.a)(l,1)),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:"←"}),(0,a.jsx)("h3",{className:"font-semibold text-foreground",children:(0,f.GP)(l,"MMMM yyyy",{locale:F.it})}),(0,a.jsx)("button",{onClick:()=>s((0,x.P)(l,1)),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:"→"})]}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Lun","Mar","Mer","Gio","Ven","Sab","Dom"].map(e=>(0,a.jsx)("div",{className:"w-10 h-10 flex items-center justify-center text-xs font-medium text-foreground",children:e},e))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1",children:y.map((e,t)=>(0,a.jsx)("div",{className:(e=>{let t="w-10 h-10 flex items-center justify-center text-sm rounded-full cursor-pointer transition-all duration-200";return((0,h.c)(e)&&(t+=" ring-2 ring-primary/50"),o===(0,f.GP)(e,"yyyy-MM-dd"))?t+=" bg-primary text-primary-foreground font-semibold":N(e)?t+=" bg-emerald-100 text-emerald-800 hover:bg-emerald-200 font-medium border border-emerald-200":t+=" bg-gray-100 text-gray-400 cursor-not-allowed",t})(e),onClick:()=>(e=>{let t=(0,f.GP)(e,"yyyy-MM-dd");N(e)&&(n(t),d(!1))})(e),children:(0,f.GP)(e,"d")},t))}),(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-border",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-4 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full border border-green-700"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Disponibile"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-gray-100 rounded-full"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Non disponibile"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-primary rounded-full"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Selezionato"})]})]})}),i&&(0,a.jsx)("div",{className:"mt-3 p-2 bg-green-50 border border-green-200 rounded text-center",children:(0,a.jsx)("p",{className:"text-xs text-green-700",children:"\uD83C\uDFAF Solo date con slot promozionali disponibili"})})]}),c&&(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)})]})}function S(e){var t;let{adminMode:l=!1,requirePackage:u=!1,hidePackageSelect:p=!1}=e,[g,x]=(0,r.useState)(!1),[b,h]=(0,r.useState)(""),[F,S]=(0,r.useState)(""),[E,I]=(0,r.useState)([]),[z,T]=(0,r.useState)([]),[B,D]=(0,r.useState)(null),[A,O]=(0,r.useState)([]),[R,M]=(0,r.useState)(null),[L,G]=(0,r.useState)(""),[U,H]=(0,r.useState)([]),[_,V]=(0,r.useState)(null),[W,J]=(0,r.useState)(null),Y=(0,r.useRef)([]),Z=(0,r.useRef)([]),$=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{let o=await (0,d.fH)();if(e){var t;V(o);let e=null!=(t=null==o?void 0:o.contactAddresses)?t:[];H(e),1===e.length&&G(e[0].name)}}catch(e){}})(),()=>{e=!1}},[]);let[Q,q]=(0,r.useState)((0,N.J5)());(0,r.useEffect)(()=>{let e=e=>{(0,m.f9)("\uD83D\uDD04 DirectState cambiato:",e.detail),q(e.detail)};return window.addEventListener("directStateChange",e),()=>{window.removeEventListener("directStateChange",e)}},[]);let K=Q.isFreeConsultation||(null==B?void 0:B.isPromotional)===!0;(0,m.f9)("\uD83C\uDFAF BookingForm - isFreeConsultation:",K),(0,m.f9)("\uD83C\uDFAF BookingForm - directState completo:",Q),(0,m.f9)("\uD83C\uDFAF BookingForm - selectedPackage promozionale:",null==B?void 0:B.isPromotional),(0,m.f9)("\uD83C\uDFAF BookingForm - fonte consulenza gratuita:",Q.isFreeConsultation?"popup":(null==B?void 0:B.isPromotional)?"dropdown pacchetto promozionale":"nessuna"),(0,m.f9)("\uD83D\uDCC5 BookingForm - selectedDate:",F);let X=C.refine(e=>!e.date||!e.slot||Y.current.includes(e.slot),{message:"L'orario selezionato non \xe8 pi\xf9 disponibile",path:["slot"]}),{register:ee,handleSubmit:et,formState:{errors:eo},setValue:ea,watch:er}=(0,n.mN)({resolver:(0,i.u)(X),defaultValues:{name:"",email:"",phone:"",date:"",slot:"",notes:"",packageId:Q.selectedPackageId||"",gdprConsent:!1}});(0,r.useEffect)(()=>{(0,m.f9)("BookingForm: NUOVO SISTEMA - Inizializzazione"),(async()=>{try{(0,m.f9)("BookingForm: Caricamento pacchetti...");let e=await (0,d.G9)();(0,m.f9)("BookingForm: Pacchetti caricati:",e),(0,m.f9)("\uD83C\uDFAF PACCHETTI PROMOZIONALI TROVATI:",e.filter(e=>e.isPromotional)),(0,m.f9)("\uD83C\uDFAF TUTTI I PACCHETTI CON FLAG PROMOZIONALE:",e.map(e=>({title:e.title,isPromotional:e.isPromotional}))),(0,m.f9)("\uD83C\uDFAF TUTTI GLI ID DEI PACCHETTI:",e.map(e=>e.id)),(0,m.f9)("\uD83C\uDFAF PACCHETTO FREE-CONSULTATION ESISTE?",e.some(e=>"free-consultation"===e.id));let t=e||[];O(t),Z.current=t;let o=(0,N.J5)();if((0,m.f9)("BookingForm: Stato diretto attuale:",o),o.selectedPackageId&&t.length>0){(0,m.f9)("BookingForm: Cercando pacchetto con ID:",o.selectedPackageId),(0,m.f9)("BookingForm: Pacchetti disponibili:",t.map(e=>({id:e.id,title:e.title,isPromotional:e.isPromotional})));let e=t.find(e=>e.id===o.selectedPackageId);(0,m.f9)("BookingForm: Pacchetto trovato:",e),e?(D(e),ea("packageId",e.id||""),(0,m.f9)("BookingForm: SUCCESSO - Form precompilato con:",e.title)):console.error("BookingForm: ERRORE - Pacchetto non trovato con ID:",o.selectedPackageId)}}catch(e){console.error("BookingForm: Errore caricamento pacchetti:",e)}})();let e=e=>{if((0,m.f9)("BookingForm: Cambio stato diretto:",e.detail),q(e.detail),e.detail.selectedPackageId&&Z.current.length>0){(0,m.f9)("BookingForm: Evento directStateChange - Cercando pacchetto con ID:",e.detail.selectedPackageId),console.log("BookingForm: Pacchetti disponibili per evento:",Z.current.map(e=>({id:e.id,title:e.title,isPromotional:e.isPromotional})));let t=Z.current.find(t=>t.id===e.detail.selectedPackageId);console.log("BookingForm: Pacchetto trovato per evento:",t),t?(D(t),ea("packageId",t.id||""),console.log("BookingForm: Form aggiornato via evento:",t.title)):console.error("BookingForm: ERRORE - Pacchetto non trovato per evento con ID:",e.detail.selectedPackageId)}};return window.addEventListener("directStateChange",e),()=>{window.removeEventListener("directStateChange",e)}},[ea]),(0,r.useEffect)(()=>{Y.current=E},[E]),(0,r.useEffect)(()=>{(async()=>{let e=K||(null==B?void 0:B.isPromotional)===!0?60:14;console.log("\uD83D\uDCC5 Generando ".concat(e," date per ").concat(K?"consulenza gratuita":"consulenza normale"));let t=Array.from({length:e},(e,t)=>{let o=(0,v.f)((0,y.o)(new Date),t);return(0,f.GP)(o,"yyyy-MM-dd")}).map(async e=>{try{let r=await (0,d.ho)(e);if(r){let n=K||(null==B?void 0:B.isPromotional)===!0;if(console.log("\uD83D\uDCC5 Date ".concat(e," - shouldUsePromotionalSlots:"),n,"isFreeConsultation:",K,"isPromotional:",null==B?void 0:B.isPromotional),n)if(r.freeConsultationSlots&&r.freeConsultationSlots.length>0)return console.log("✅ Date ".concat(e," - Found promotional slots:"),r.freeConsultationSlots),e;else console.log("❌ Date ".concat(e," - No promotional slots available"));else{var t,o,a;let n=null!=(t=r.onlineSlots)?t:[],i=r.studioSlots&&L?null!=(o=r.studioSlots[L])?o:[]:null!=(a=r.inStudioSlots)?a:[],l=null===R?[...n,...i]:"online"===R?n:i;if(l&&l.length>0)return e}}return null}catch(t){return console.error("Errore nel controllo disponibilit\xe0 per ".concat(e,":"),t),null}});T((await Promise.all(t)).filter(e=>null!==e))})()},[B,K,R,L]),(0,r.useEffect)(()=>{F&&(async()=>{try{let r=await (0,d.ho)(F);if(r){let n=K||(null==B?void 0:B.isPromotional)===!0;if(console.log("\uD83D\uDD0D DEBUG SLOT:",{isFreeConsultation:K,selectedPackage:null==B?void 0:B.title,isPromotional:null==B?void 0:B.isPromotional,shouldUsePromotionalSlots:n,directState:Q,selectionSource:K?"popup consulenze gratuite":"dropdown form"}),n)console.log("\uD83C\uDFAF CONSULENZA GRATUITA/PROMOZIONALE - Caricando slot promozionali:",r.freeConsultationSlots),I((r.freeConsultationSlots||[]).map(e=>"string"==typeof e?e:e.time));else{var e,t,o,a;console.log("\uD83D\uDCCB CONSULENZA NORMALE - Caricando slot normali");let n=null!=(e=r.onlineSlots)?e:[],i=r.studioSlots&&L?null!=(t=r.studioSlots[L])?t:[]:null!=(o=r.inStudioSlots)?o:[],l=null!=(a=r.slots)?a:[],s=null===R?n.length||i.length?[...n,...i]:l:"online"===R?n:i;console.log("\uD83D\uDCCB Pool slot normali selezionato:",s),I(s)}}}catch(e){console.error("Errore nel caricamento disponibilit\xe0:",e),I([])}})()},[F,B,K,R,L]);let en=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,ei=()=>/Android/.test(navigator.userAgent),el=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,es=()=>{try{let e="incognito-test-".concat(Date.now());localStorage.setItem(e,"test"),localStorage.removeItem(e)}catch(e){return console.log("\uD83D\uDD75️ INCOGNITO: Rilevato tramite localStorage test"),!0}try{let e="session-test-".concat(Date.now());sessionStorage.setItem(e,"test"),sessionStorage.removeItem(e)}catch(e){return console.log("\uD83D\uDD75️ INCOGNITO: Rilevato tramite sessionStorage test"),!0}return window.indexedDB?(console.log("\uD83D\uDD75️ INCOGNITO: Non rilevato - modalit\xe0 normale"),!1):(console.log("\uD83D\uDD75️ INCOGNITO: Rilevato tramite IndexedDB test"),!0)},ec=async e=>{if(g)return;let t=es();if(console.log("\uD83D\uDD75️ Controllo incognito nel submit:",t),t){console.log("\uD83D\uDEAB BLOCCO: Form submission bloccato per modalit\xe0 incognito"),j.toast.error("⚠️ La prenotazione non \xe8 disponibile in modalit\xe0 incognito. Per continuare, apri il sito in modalit\xe0 normale.",{duration:6e3,position:"top-center",style:{background:"#dc2626",color:"white",fontWeight:"600",borderRadius:"12px",padding:"16px 24px",fontSize:"16px",boxShadow:"0 10px 25px rgba(220, 38, 38, 0.3)",maxWidth:"90vw"}});return}if(u&&!B&&!l)return void j.toast.error("Seleziona un pacchetto per continuare",{duration:3e3,position:"top-center",style:{background:eu.warning,color:"white",fontWeight:"600",borderRadius:"12px",padding:"16px 24px",fontSize:"16px",boxShadow:"0 10px 25px ".concat(eu.warning,"30")}});if(!l&&(null==_?void 0:_.recaptchaEnabled)&&!W&&!t){if(el()&&$.current)try{$.current.reset(),await new Promise(e=>setTimeout(e,500))}catch(e){console.error("Errore re-render reCAPTCHA:",e)}j.toast.error("Completa la verifica CAPTCHA per continuare",{duration:3e3,position:"top-center",style:{background:eu.warning,color:"white",fontWeight:"600",borderRadius:"12px",padding:"16px 24px",fontSize:"16px",boxShadow:"0 10px 25px ".concat(eu.warning,"30")}});return}x(!0),h("Preparando prenotazione...");try{let t={...e,isFreeConsultation:K,status:"pending"};h("Verificando disponibilit\xe0..."),console.log("\uD83D\uDE80 Tentativo prenotazione consulenza gratuita:",{isFreeConsultation:K,selectedPackage:B}),el()&&await new Promise(e=>setTimeout(e,300));try{let e;h("Inviando prenotazione...");let{createBooking:a,getDataMode:r}=await Promise.resolve().then(o.bind(o,99018)),n=r();en()&&console.log("\uD83D\uDCF1 iOS - Modalit\xe0 dati corrente:",n);let i={name:t.name,email:t.email,phone:t.phone||void 0,packageId:null==B?void 0:B.id,date:t.date,slot:t.slot,location:K||(null==B?void 0:B.isPromotional)===!0?"online":R,studioLocation:"studio"===R&&L||void 0,status:l?"confirmed":"pending",notes:t.notes,isFreeConsultation:K};if(el()){let t=en()?"iOS":ei()?"Android":"Mobile";h("Invio prenotazione...");try{let o=await fetch("/api/bookings/create",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache",Pragma:"no-cache"},credentials:"include",body:JSON.stringify({...i,captchaToken:W||void 0})});if(!o.ok){let e=await o.text();throw Error("".concat(t," server create failed: ").concat(o.status," - ").concat(e))}let a=await o.json();e=a.id||a.bookingId}catch(r){h("Ritento invio..."),await new Promise(e=>setTimeout(e,400));let o=await fetch("/api/bookings/create",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache",Pragma:"no-cache"},credentials:"include",body:JSON.stringify({...i,captchaToken:W||void 0})});if(!o.ok){let e=await o.text();throw Error("".concat(t," server retry failed: ").concat(o.status," - ").concat(e))}let a=await o.json();e=a.id||a.bookingId}}else h("Inviando prenotazione..."),e=await a(i,W||void 0);if(h("Finalizzando..."),!e)throw Error("Prenotazione fallita - nessun ID ricevuto")}catch(o){console.error("❌ Errore createBooking:",o);let e=(0,d.getDataMode)();if("local"===e){h("Tentativo server..."),h("Invio tramite server...");let e=l?"confirmed":"pending",o={name:t.name,email:t.email,phone:t.phone||void 0,packageId:null==B?void 0:B.id,date:t.date,slot:t.slot,location:K||(null==B?void 0:B.isPromotional)===!0?"online":R,studioLocation:"studio"===R&&L||void 0,status:e,notes:t.notes,isFreeConsultation:K},a=await fetch("/api/bookings/create",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache",Pragma:"no-cache"},credentials:"include",body:JSON.stringify({...o,captchaToken:W||void 0})});if(h("Verifica risposta..."),!a.ok){let e=await a.text();throw Error("Backup server fallito: ".concat(a.status," - ").concat(e))}}else{let t=en()?"iOS":ei()?"Android":"Mobile",a=el()?"Prenotazione fallita in modalit\xe0 ".concat(e," su ").concat(t,": ").concat(o.message):"Prenotazione fallita in modalit\xe0 ".concat(e,": ").concat(o.message);throw Error(a)}}j.toast.success(K?"Consulenza gratuita prenotata con successo!":"Prenotazione inviata con successo!",{duration:4e3,position:"top-center",style:{background:"linear-gradient(135deg, ".concat(eu.success," 0%, ").concat(eu.primary," 100%)"),color:"white",fontWeight:"600",borderRadius:"16px",padding:"20px 28px",fontSize:"16px",boxShadow:"0 20px 40px rgba(".concat(eu.primaryRgb,", 0.4)"),border:"1px solid rgba(255, 255, 255, 0.2)"},icon:"✓",iconTheme:{primary:"#ffffff",secondary:eu.primary}}),ea("name",""),ea("email",""),ea("phone",""),ea("date",""),ea("slot",""),ea("notes",""),ea("gdprConsent",!1),S(""),I([]),D(null),ea("packageId",""),J(null),$.current&&$.current.reset()}catch(e){console.error("Errore:",e),j.toast.error("Errore nell'invio della prenotazione. Riprova.",{duration:en()?6e3:4e3,position:"top-center",style:{background:eu.error,color:"white",fontWeight:"600",borderRadius:"12px",padding:"16px 24px",fontSize:"16px",boxShadow:"0 10px 25px ".concat(eu.error,"30")}})}finally{x(!1),h(""),$.current&&$.current.reset()}},ed=null==B?void 0:B.isPromotional;console.log("\uD83C\uDFAF SHOW PROMOTIONAL BANNER:",{selectedPackage:null==B?void 0:B.title,isPromotional:null==B?void 0:B.isPromotional,showPromotionalBanner:ed,isFreeConsultation:K});let em=e=>{let t=e.replace("#",""),o=parseInt(3===t.length?t.split("").map(e=>e+e).join(""):t,16);return"".concat(o>>16&255,", ").concat(o>>8&255,", ").concat(255&o)},eu=(()=>{let e=(null==_?void 0:_.colorPalette)||"gz-default",t=(0,P.AT)(e);return{primary:t.primary,accent:t.accent,success:t.primary,error:"#EF4444",warning:"#F59E0B",primaryRgb:em(t.primary),accentRgb:em(t.accent)}})();return console.log("\uD83C\uDFA8 PALETTE DINAMICA:",{paletteId:(null==_?void 0:_.colorPalette)||"gz-default",colors:eu}),console.log("BookingForm: RENDER - selectedPackage:",B),console.log("BookingForm: RENDER - packages:",A),console.log("BookingForm: RENDER - packages.length:",A.length),(0,a.jsxs)("div",{className:"section-surface p-6 sm:p-8 space-y-6",children:[es()&&(0,a.jsx)("div",{className:"rounded-xl p-4 bg-red-50 border border-red-200 shadow-md",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-9 h-9 rounded-full bg-red-100 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDD75️"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-bold text-red-800",children:"⚠️ Modalit\xe0 Incognito Rilevata"}),(0,a.jsxs)("p",{className:"text-sm text-red-700 mt-1",children:["La prenotazione non \xe8 disponibile in modalit\xe0 incognito. Per continuare, ",(0,a.jsx)("strong",{children:"apri il sito in modalit\xe0 normale"}),"."]})]})]})}),B&&(0,a.jsx)("div",{className:"rounded-xl p-4 shadow-md ".concat(ed?"bg-green-50 border border-green-200":"border border-foreground/20 bg-background/70 backdrop-blur-sm"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center ".concat(ed?"bg-green-100":"bg-primary/10"),children:(0,a.jsx)("span",{className:"text-lg",children:ed?"\uD83C\uDFAF":"\uD83D\uDCE6"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold ".concat(ed?"text-green-800":"text-foreground"),children:B.title}),(0,a.jsx)("p",{className:"text-sm ".concat(ed?"text-green-700":"text-foreground"),children:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;if(e.length<=t)return e;let o=e.substring(0,t),a=o.lastIndexOf(" ");return a>.8*t?o.substring(0,a)+"...":o+"..."}(B.description)}),!ed&&(0,a.jsxs)("div",{className:"mt-2",children:[B.hasDiscount&&B.basePrice&&B.discountedPrice?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-lg font-bold text-primary",children:["€ ",B.discountedPrice]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 line-through",children:["€ ",B.basePrice]}),B.discountPercentage&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full",children:["-",B.discountPercentage,"%"]})]}):(0,a.jsxs)("p",{className:"text-sm font-medium text-primary",children:["€ ",B.price]}),B.paymentText&&(0,a.jsx)("p",{className:"text-xs text-foreground mt-1",children:B.paymentText})]})]})]})}),(0,a.jsxs)("form",{onSubmit:et(ec),className:"space-y-6",children:[(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Pacchetto"}),(0,a.jsxs)("select",{value:(null==B?void 0:B.id)||"",onChange:e=>{var t;let o=e.target.value;t=A.find(e=>e.id===o)||null,console.log("\uD83D\uDD04 CAMBIO PACCHETTO:",{old:null==B?void 0:B.title,new:null==t?void 0:t.title,isPromotional:null==t?void 0:t.isPromotional,shouldUsePromotionalSlots:(null==t?void 0:t.isPromotional)===!0}),D(t),ea("packageId",(null==t?void 0:t.id)||""),ea("date",""),ea("slot",""),S(""),I([]),T([])},className:"w-full rounded-lg border border-foreground/10 bg-background/70 backdrop-blur-sm px-3.5 py-2.5 text-sm text-foreground focus:outline-none focus:ring-4 focus:ring-[rgba(var(--primary-rgb),0.15)]",children:[(0,a.jsx)("option",{value:"",children:"Seleziona un pacchetto"}),A.map(e=>{let t="";return t=e.isPromotional?"(Gratuito)":e.hasDiscount&&e.basePrice&&e.discountedPrice?"- €".concat(e.discountedPrice," (scontato da €").concat(e.basePrice,")"):"- €".concat(e.price),(0,a.jsxs)("option",{value:e.id||"",children:[e.title," ",t]},e.id)})]}),(0,a.jsx)("p",{className:"text-xs text-black mt-1",children:"Puoi cambiare pacchetto in qualsiasi momento"})]}),(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)(c.p,{label:"Nome completo *",...ee("name"),placeholder:"Il tuo nome",...ei()&&{autoComplete:"name",inputMode:"text"}}),eo.name&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:eo.name.message})]}),(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)(c.p,{label:"Email *",type:"email",...ee("email"),placeholder:"la-tua-email@esempio.com",...ei()&&{autoComplete:"email",inputMode:"email"}}),eo.email&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:eo.email.message})]}),(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)(c.p,{label:"Telefono *",...ee("phone"),placeholder:"+39 123 456 7890",...ei()&&{autoComplete:"tel",inputMode:"tel"}}),eo.phone&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:eo.phone.message})]}),!(ed||K)&&(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2 text-black",children:"Sede appuntamento"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",role:"group","aria-label":"Sede appuntamento",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>M("online"),"aria-pressed":"online"===R,className:"relative flex items-center gap-3 p-3 rounded-xl border-2 transition-all focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-[rgba(var(--primary-rgb),0.15)] ".concat("online"===R?"border-primary bg-primary/5 shadow-[0_0_0_3px_rgba(11,94,11,0.10)]":"border-border hover:border-primary/40"),children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83C\uDF10"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"text-sm font-semibold ".concat("online"===R?"text-primary":"text-black"),children:"Online"}),(0,a.jsx)("div",{className:"text-[12px] text-foreground/60",children:"Videochiamata"})]})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>M("studio"),"aria-pressed":"studio"===R,className:"relative flex items-center gap-3 p-3 rounded-xl border-2 transition-all focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-[rgba(var(--primary-rgb),0.15)] ".concat("studio"===R?"border-primary bg-primary/5 shadow-[0_0_0_3px_rgba(11,94,11,0.10)]":"border-border hover:border-primary/40"),children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83C\uDFE2"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"text-sm font-semibold ".concat("studio"===R?"text-primary":"text-black"),children:"In studio"}),(0,a.jsx)("div",{className:"text-[12px] text-foreground/60",children:"Presso studio"})]})]})]}),(0,a.jsx)("p",{className:"text-xs text-black mt-2",children:"Per consultazioni gratuite la sede \xe8 sempre Online."})]}),"studio"===R&&(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2 text-black",children:"Seleziona sede"}),(0,a.jsxs)("select",{value:L,onChange:e=>{G(e.target.value),ea("slot","")},className:"w-full p-3 border border-border rounded-lg bg-background text-black",children:[(0,a.jsx)("option",{value:"",children:"-- Seleziona sede --"}),U.map((e,t)=>(0,a.jsx)("option",{value:e.name,children:e.name},t))]}),""===L&&(0,a.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Seleziona una sede per visualizzare gli slot disponibili."})]}),l&&u&&!p&&(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Seleziona pacchetto"}),(0,a.jsxs)("select",{value:er("packageId"),onChange:e=>{let t=e.target.value;ea("packageId",t),D(A.find(e=>e.id===t)||null)},className:"w-full rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground",children:[(0,a.jsx)("option",{value:"",children:"Nessun pacchetto"}),A.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2 text-black",children:["Data * ",ed&&(0,a.jsx)("span",{className:"text-green-600",children:"(Solo date con disponibilit\xe0)"})]}),(0,a.jsx)(w,{availableDates:z,selectedDate:F,onDateSelect:e=>{S(e),ea("date",e),ea("slot","")},showPromotionalBanner:ed||!1}),eo.date&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:eo.date.message}),0===z.length&&(0,a.jsx)("p",{className:"text-black text-sm mt-1",children:ed?"Nessuna data disponibile per consultazioni gratuite":"Nessuna data disponibile per consulenze"})]}),F&&E.length>0&&(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2 text-black",children:["Orario disponibile * ",ed&&(0,a.jsx)("span",{className:"text-green-600",children:"(Slot promozionali)"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:E.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>ea("slot",e),className:"p-3 border rounded-lg text-sm transition-colors ".concat(er("slot")===e?"border-primary bg-[color:var(--secondary-bg)] text-[color:var(--secondary-fg)]":"border-border hover:border-primary/50"),children:(()=>{if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/.test(e))try{let t=new Date(e),o=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(o,":").concat(a)}catch(e){}return e})()},e))}),eo.slot&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:eo.slot.message})]}),(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2 text-black",children:"Parlami di te"}),(0,a.jsx)("textarea",{...ee("notes"),placeholder:"Raccontaci i tuoi obiettivi, esperienze precedenti, preferenze alimentari, eventuali limitazioni o qualsiasi altra informazione che ritieni importante per la tua consulenza...",className:"w-full rounded-lg border border-foreground/10 bg-background/70 backdrop-blur-sm px-3.5 py-2.5 text-sm text-black min-h-[120px] resize-y focus:outline-none focus:ring-4 focus:ring-[rgba(var(--primary-rgb),0.15)]",rows:5})]}),!l&&(0,a.jsx)("div",{className:"form-surface p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("input",{type:"checkbox",id:"gdprConsent",...ee("gdprConsent"),className:"mt-1 w-4 h-4 text-primary bg-background border-foreground/20 rounded focus:ring-primary focus:ring-2"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("label",{htmlFor:"gdprConsent",className:"text-sm text-black cursor-pointer",children:[(0,a.jsx)("span",{className:"font-medium",children:"Accetto il trattamento dei dati personali *"}),(0,a.jsx)("p",{className:"text-xs text-foreground/70 mt-1",children:(null==_||null==(t=_.legalInfo)?void 0:t.gdprConsentText)||"Acconsento al trattamento dei miei dati personali per la gestione della prenotazione e per ricevere comunicazioni relative al servizio, ai sensi del GDPR (Regolamento UE 2016/679). I dati saranno utilizzati esclusivamente per le finalit\xe0 indicate e non saranno comunicati a terzi."}),(0,a.jsx)("a",{href:"/privacy",className:"text-primary hover:underline text-xs mt-1 inline-block",children:"Leggi la Privacy Policy"})]}),eo.gdprConsent&&(0,a.jsx)("p",{className:"text-destructive text-sm mt-1",children:eo.gdprConsent.message})]})]})}),!l&&(null==_?void 0:_.recaptchaEnabled)&&(null==_?void 0:_.recaptchaSiteKey)&&(0,a.jsxs)("div",{className:"form-surface p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2 text-black",children:"Verifica di sicurezza *"}),(0,a.jsx)(k.A,{ref:$,sitekey:_.recaptchaSiteKey,onChange:e=>{J(e)},onExpired:()=>{J(null)},onError:e=>{console.error("❌ CAPTCHA error:",e),J(null)},onLoad:()=>{console.log("✅ CAPTCHA loaded")}})]}),(0,a.jsxs)(s.$,{type:"submit",disabled:g||!l&&(null==_?void 0:_.recaptchaEnabled)&&!W||es(),className:"w-full relative transition-all duration-300",...ei()&&{style:{WebkitAppearance:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation"}},style:{background:g?"linear-gradient(to right, rgba(".concat(eu.primaryRgb,", 0.8), rgba(").concat(eu.primaryRgb,", 0.9))"):"linear-gradient(to right, ".concat(eu.primary,", rgba(").concat(eu.primaryRgb,", 0.9))"),transform:g?"scale(0.98)":"scale(1)",boxShadow:g?"0 10px 20px rgba(".concat(eu.primaryRgb,", 0.3)"):"0 4px 12px rgba(".concat(eu.primaryRgb,", 0.2)")},onMouseEnter:e=>{g||(e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.boxShadow="0 15px 30px rgba(".concat(eu.primaryRgb,", 0.4)"))},onMouseLeave:e=>{g||(e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 12px rgba(".concat(eu.primaryRgb,", 0.2)"))},onMouseDown:e=>{g||(e.currentTarget.style.transform="scale(0.95)")},onMouseUp:e=>{g||(e.currentTarget.style.transform="scale(1.05)")},children:[g&&(0,a.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2",children:(0,a.jsx)("div",{className:"w-5 h-5 border-2 rounded-full animate-spin",style:{borderColor:"rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRightColor:"rgba(255, 255, 255, 0.6)"}})}),(0,a.jsx)("span",{className:"font-semibold transition-all duration-300 ".concat(g?"ml-8":""),children:es()?"\uD83D\uDD75️ Non disponibile in modalit\xe0 incognito":g?"Invio in corso...":B?ed?"Prenota Consultazione Gratuita":"Prenota Consulenza":"Invia richiesta"})]}),B&&ed&&(0,a.jsx)("div",{className:"text-center text-sm text-black"})]}),g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-black/40 to-black/60 backdrop-blur-md z-50 flex items-center justify-center animate-in fade-in duration-300",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl border border-gray-100 animate-in slide-in-from-bottom-4 duration-500",children:[(0,a.jsx)("div",{className:"relative mb-6 flex justify-center",children:(0,a.jsxs)("div",{className:"relative w-16 h-16",children:[(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-gray-200 rounded-full animate-spin",style:{borderTopColor:eu.primary,borderRightColor:eu.accent,borderBottomColor:"transparent",borderLeftColor:"transparent",animationDuration:"1s"}}),(0,a.jsx)("div",{className:"absolute inset-2 border-2 border-gray-100 rounded-full animate-spin",style:{borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:eu.primary,borderLeftColor:eu.accent,animationDirection:"reverse",animationDuration:"1.5s"}}),(0,a.jsx)("div",{className:"absolute top-1/2 left-1/2 w-2 h-2 rounded-full",style:{backgroundColor:eu.primary,transform:"translate(-50%, -50%)"}})]})}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:K?"Consulenza Gratuita":"Nuova Prenotazione"})}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-4 animate-pulse",children:b||"Elaborazione in corso..."}),(0,a.jsx)("div",{className:"w-full bg-gray-100 rounded-full h-3 overflow-hidden shadow-inner",children:(0,a.jsx)("div",{className:"h-full rounded-full transition-all duration-700 ease-out shadow-sm relative overflow-hidden",style:{background:"linear-gradient(to right, ".concat(eu.primary,", rgba(").concat(eu.primaryRgb,", 0.8))"),width:b.includes("Preparando")?"20%":b.includes("Verificando")?"40%":b.includes("Inviando")?"60%":b.includes("Tentativo")?"80%":b.includes("Finalizzando")?"90%":b.includes("Completato")||b.includes("Backup")?"100%":"10%"},children:(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"})})}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500 font-medium",children:[b.includes("Preparando")?"20%":b.includes("Verificando")?"40%":b.includes("Inviando")?"60%":b.includes("Tentativo")?"80%":b.includes("Finalizzando")?"90%":b.includes("Completato")||b.includes("Backup")?"100%":"10%"," completato"]}),(0,a.jsx)("div",{className:"mt-1 text-xs text-gray-400",children:b.includes("Preparando")?"⏱️ Tempo stimato: 2-3 secondi":b.includes("Verificando")||b.includes("Inviando")?"⏱️ Tempo stimato: 1-2 secondi":b.includes("Tentativo")?"⏱️ Quasi completato...":b.includes("Finalizzando")?"⏱️ Finalizzazione...":b.includes("Completato")||b.includes("Backup")?"✅ Completato!":"⏱️ Inizializzazione..."})]})})]})}}}]);