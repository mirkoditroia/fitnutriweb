"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9018],{1272:(e,t,o)=>{o.d(t,{j2:()=>u,db:()=>g});var i=o(2078),a=o(2553),n=o(9708),l=o(2377),r=o(5704);let s=l.Ik({NEXT_PUBLIC_FIREBASE_API_KEY:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_PROJECT_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_APP_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID:l.Yj().optional().default("")}).parse({NEXT_PUBLIC_FIREBASE_API_KEY:"AIzaSyAp1IXe0d2yE-BSrZLGKHfDkdkm1NuSwfs",NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:"gznutrition-d5d13.firebaseapp.com",NEXT_PUBLIC_FIREBASE_PROJECT_ID:"gznutrition-d5d13",NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:"gznutrition-d5d13.firebasestorage.app",NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:"658719519730",NEXT_PUBLIC_FIREBASE_APP_ID:"1:658719519730:web:37dafec47d6f4e6c0db16b",NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID:r.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID});o(4663);let c={apiKey:s.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:s.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:s.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:s.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:s.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:s.NEXT_PUBLIC_FIREBASE_APP_ID},d=s.NEXT_PUBLIC_FIREBASE_API_KEY&&s.NEXT_PUBLIC_FIREBASE_PROJECT_ID&&s.NEXT_PUBLIC_FIREBASE_APP_ID?(0,i.Dk)().length?(0,i.Sx)():(0,i.Wp)(c):null,u=d?(0,a.xI)(d):void 0,g=d?(0,n.aU)(d):void 0},4368:(e,t,o)=>{o.d(t,{EZ:()=>k,Ej:()=>z,G9:()=>c,HG:()=>B,KB:()=>L,Kh:()=>d,TP:()=>b,VA:()=>m,Wi:()=>D,ZY:()=>g,_L:()=>h,by:()=>E,dd:()=>S,deletePackage:()=>u,fH:()=>v,ho:()=>y,sH:()=>f,u2:()=>A,vq:()=>p,wb:()=>C,zZ:()=>T});var i=o(9708),a=o(5197),n=o(1272),l=o(5704);async function r(e,t,o,i,a){try{console.log("\uD83D\uDCE4 sendBookingNotification chiamata con:",{bookingId:e.id,isFreeConsultation:e.isFreeConsultation,packageTitle:t,notificationEmail:o});let n=await fetch("https://sendbookingnotification-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"new-booking",booking:e,packageTitle:t,notificationEmail:o,businessName:i,colorPalette:a})});console.log("\uD83D\uDCEC Risposta Firebase Functions:",n.status);let l=await n.json();console.log("\uD83D\uDCCB Risultato email:",l),l.success?console.log("✅ Booking notification sent successfully:",l.sentTo):console.error("❌ Failed to send booking notification:",l.message)}catch(e){console.error("❌ Error sending booking notification:",e)}}let s={packages:e=>(0,i.rJ)(e,"packages"),bookings:e=>(0,i.rJ)(e,"bookings"),clients:e=>(0,i.rJ)(e,"clients"),content:e=>(0,i.H9)(e,"content/landing"),availability:(e,t)=>(0,i.H9)(e,"availability/".concat(t))};async function c(){if(!n.db)return console.log("getPackages: Database non configurato"),[];try{console.log("getPackages: Caricamento pacchetti da Firebase...");let e=n.db,t=await (0,i.GG)((0,i.P)(s.packages(e),(0,i.My)("createdAt","desc")));console.log("getPackages: Snap ricevuto:",t),console.log("getPackages: Numero documenti:",t.docs.length);let o=t.docs.map(e=>{let t=e.data();console.log("getPackages: Documento ".concat(e.id,":"),t);let o={id:e.id,title:t.title||"",description:t.description||"",price:t.price||0,imageUrl:t.imageUrl||"",isActive:void 0!==t.active?t.active:t.isActive||!1,featured:t.featured||!1,badge:t.badge||"",isPromotional:t.isPromotional||!1,hasDiscount:t.hasDiscount||!1,basePrice:t.basePrice||void 0,discountedPrice:t.discountedPrice||void 0,discountPercentage:t.discountPercentage||void 0,paymentText:t.paymentText||void 0,details:t.details||void 0,createdAt:t.createdAt?t.createdAt.toDate?t.createdAt.toDate().toISOString():t.createdAt:void 0};return console.log("getPackages: Pacchetto mappato ".concat(e.id,":"),o),o});return console.log("getPackages: Pacchetti processati:",o),o}catch(e){return console.error("getPackages: Errore nel caricamento da Firebase:",e),[]}}async function d(e){var t,o,a,l,r,c,d,u,g,f,p,m,b,S,v,h,y,C;if(!n.db)throw Error("Firestore not configured");return e.id?(await (0,i.mZ)((0,i.H9)(n.db,"packages",e.id),{title:e.title,description:e.description,price:e.price,imageUrl:null!=(t=e.imageUrl)?t:null,active:e.isActive,featured:null!=(o=e.featured)&&o,badge:null!=(a=e.badge)?a:null,isPromotional:null!=(l=e.isPromotional)&&l,hasDiscount:null!=(r=e.hasDiscount)&&r,basePrice:null!=(c=e.basePrice)?c:null,discountedPrice:null!=(d=e.discountedPrice)?d:null,discountPercentage:null!=(u=e.discountPercentage)?u:null,paymentText:e.paymentText||null,details:null!=(g=e.details)?g:null,createdAt:(0,i.O5)()}),e.id):(await (0,i.gS)(s.packages(n.db),{title:e.title,description:e.description,price:e.price,imageUrl:null!=(f=e.imageUrl)?f:null,active:e.isActive,featured:null!=(p=e.featured)&&p,badge:null!=(m=e.badge)?m:null,isPromotional:null!=(b=e.isPromotional)&&b,hasDiscount:null!=(S=e.hasDiscount)&&S,basePrice:null!=(v=e.basePrice)?v:null,discountedPrice:null!=(h=e.discountedPrice)?h:null,discountPercentage:null!=(y=e.discountPercentage)?y:null,paymentText:e.paymentText||null,details:null!=(C=e.details)?C:null,createdAt:(0,i.O5)()})).id}async function u(e){if(!n.db)throw Error("Firestore not configured");if(!e)throw Error("Package ID is required for deletion");await (0,i.kd)((0,i.H9)(n.db,"packages",e))}async function g(){if(!n.db)return[];let e=n.db;return(await (0,i.GG)((0,i.P)(s.bookings(e),(0,i.My)("createdAt","desc")))).docs.map(e=>P(e.id,e.data()))}async function f(e,t){var o,l,c,d,u,g,f,p,m,h,I,P,w,E,k,T,A,B,z,L,D,N,_,F,O,x,U,R,G,j,M;let H;if(console.log("\uD83D\uDD25 createBooking Firebase iniziato:",{isFreeConsultation:e.isFreeConsultation,slot:e.slot,date:e.date,dateFormatted:new Date(e.date).toISOString().split("T")[0],packageId:e.packageId}),!n.db)throw Error("Firestore not configured");let J=await v();if((null==J?void 0:J.recaptchaEnabled)&&t)try{console.log("\uD83D\uDD11 Inizio verifica CAPTCHA con token:",t?t.substring(0,20)+"...":"null");let e=await fetch("https://verifycaptcha-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})});console.log("\uD83D\uDCE1 Risposta Firebase Function status:",e.status);let o=await e.json();if(console.log("\uD83D\uDD0D Risultato verifica CAPTCHA:",o),!o.success)throw console.error("❌ CAPTCHA verifica fallita:",o.message,o.errors),Error("Verifica CAPTCHA fallita: ".concat(o.message||"Errore sconosciuto"));console.log("✅ CAPTCHA verificato con successo!")}catch(e){throw console.error("\uD83D\uDCA5 Errore verifica CAPTCHA:",e),Error("Errore nella verifica CAPTCHA. Riprova.")}else if((null==J?void 0:J.recaptchaEnabled)&&!t)throw Error("Token CAPTCHA mancante. Completa la verifica CAPTCHA.");if(!e.slot)throw Error("Lo slot orario \xe8 obbligatorio per la prenotazione");let X=e.date.includes("T")?e.date.split("T")[0]:e.date;console.log("\uD83D\uDD0D FORMATO DATA DEBUG:"),console.log("\uD83D\uDCC5 Data originale dal form:",e.date),console.log("\uD83D\uDCC5 Data standardizzata per query:",X);let V=await y(X),Z=e.isFreeConsultation?"online":e.location||"online",K=[];if(e.isFreeConsultation){if(console.log("\uD83D\uDD0D Consulenza gratuita - Slot promozionali disponibili:",(K=null!=(o=null==V?void 0:V.freeConsultationSlots)?o:[]).length,"slot"),console.log("\uD83D\uDCC5 Slot richiesto:",e.slot),0===K.length)throw Error("❌ Nessun slot per consulenze gratuite disponibile per questa data")}else K="online"===Z?null!=(d=null!=(c=null==V?void 0:V.onlineSlots)?c:null==V?void 0:V.slots)?d:[]:e.studioLocation?null!=(u=null==V||null==(l=V.studioSlots)?void 0:l[e.studioLocation])?u:[]:null!=(g=null==V?void 0:V.inStudioSlots)?g:[];if(!V||!K.includes(e.slot))throw console.error("❌ VALIDAZIONE SLOT FALLITA!"),console.error("  - availability presente:",!!V),console.error("  - pool.length:",K.length),console.error("  - slot richiesto:",e.slot),console.error("  - isFreeConsultation:",e.isFreeConsultation),Error("L'orario selezionato non \xe8 pi\xf9 disponibile");if(console.log("✅ Slot validato correttamente:",e.slot),e.isFreeConsultation)H="Consultazione Gratuita (10 minuti)";else if(e.packageId)try{let t=await (0,i.x7)((0,i.H9)(n.db,"packages",e.packageId));t.exists()&&(H=t.data().title)}catch(e){console.error("Error getting package title for calendar event:",e)}console.log("\uD83D\uDCBE Salvando prenotazione nel database...");let q=await (0,i.gS)(s.bookings(n.db),{clientId:null!=(f=e.clientId)?f:null,name:e.name,email:e.email,phone:null!=(p=e.phone)?p:null,packageId:null!=(m=e.packageId)?m:null,date:e.date,slot:null!=(h=e.slot)?h:null,location:Z,studioLocation:null!=(I=e.studioLocation)?I:null,status:e.status||"confirmed",priority:!!e.priority,channelPreference:null!=(P=e.channelPreference)?P:null,isFreeConsultation:!!e.isFreeConsultation,notes:null!=(w=e.notes)?w:null,createdAt:(0,i.O5)()});if(console.log("✅ Prenotazione salvata con ID:",q.id),e.isFreeConsultation){let t=(null!=(E=null==V?void 0:V.freeConsultationSlots)?E:[]).filter(t=>t!==e.slot);console.log("\uD83D\uDDD1️ Rimuovendo slot promozionale:",e.slot),console.log("\uD83D\uDCCB Slot promozionali rimanenti:",t),await C(X,null!=(T=null!=(k=V.onlineSlots)?k:V.slots)?T:[],t,null!=(A=V.inStudioSlots)?A:[],null!=(B=V.studioSlots)?B:{})}else if("online"===Z){let t=(null!=(L=null!=(z=V.onlineSlots)?z:V.slots)?L:[]).filter(t=>t!==e.slot);await C(X,t,V.freeConsultationSlots,null!=(D=V.inStudioSlots)?D:[],null!=(N=V.studioSlots)?N:{})}else if(e.studioLocation){let t={...null!=(_=V.studioSlots)?_:{}};t[e.studioLocation]=(null!=(F=t[e.studioLocation])?F:[]).filter(t=>t!==e.slot),await C(X,null!=(x=null!=(O=V.onlineSlots)?O:V.slots)?x:[],V.freeConsultationSlots,null!=(U=V.inStudioSlots)?U:[],t)}else{let t=(null!=(R=V.inStudioSlots)?R:[]).filter(t=>t!==e.slot);await C(X,null!=(j=null!=(G=V.onlineSlots)?G:V.slots)?j:[],V.freeConsultationSlots,t,null!=(M=V.studioSlots)?M:{})}if("confirmed"===e.status)try{let t=await S(e.email);if(t)await b({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"active",source:t.source||"website"});else{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione confermata del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"active",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await b(t)}}catch(e){console.error("Error creating/updating client from booking:",e)}try{if("confirmed"===e.status){let t=await (0,a.hX)(void 0,e,H);t&&(await (0,i.mZ)((0,i.H9)(n.db,"bookings",q.id),{googleCalendarEventId:t}),console.log("Google Calendar event created and linked to booking:",t))}}catch(e){console.error("Error creating Google Calendar event:",e)}try{console.log("\uD83D\uDCE7 Preparando invio email notifica...");let t={...e,id:q.id},o=await v(),i=(null==o?void 0:o.notificationEmail)||"mirkoditroia@gmail.com",a=(null==o?void 0:o.businessName)||"GZ Nutrition",n=(null==o?void 0:o.colorPalette)||"gz-default";console.log("\uD83D\uDCEC Inviando email a:",i,"per",H),await r(t,H,i,a,n),console.log("✅ Email al dottore inviata con successo!")}catch(e){console.error("❌ Errore invio email:",e)}return q.id}async function p(e){var t,o,l,r,c,d,u,g,f,p,m,v,h;if(!n.db)throw Error("Firestore not configured");if(!e.id)throw Error("Booking ID is required for update");let C=await (0,i.x7)((0,i.H9)(n.db,"bookings",e.id));if(!C.exists())throw Error("Prenotazione non trovata");let I=P(e.id,C.data());if(I.slot!==e.slot&&e.slot){let i=await y(e.date),a="online"===(e.isFreeConsultation?"online":e.location||"online")?null!=(o=null!=(t=null==i?void 0:i.onlineSlots)?t:null==i?void 0:i.slots)?o:[]:null!=(l=null==i?void 0:i.inStudioSlots)?l:[];if(!i||!a.includes(e.slot))throw Error("Il nuovo orario selezionato non \xe8 pi\xf9 disponibile")}if(I.date!==e.date&&e.slot){let t=await y(e.date),o="online"===(e.isFreeConsultation?"online":e.location||"online")?null!=(c=null!=(r=null==t?void 0:t.onlineSlots)?r:null==t?void 0:t.slots)?c:[]:null!=(d=null==t?void 0:t.inStudioSlots)?d:[];if(!t||!o.includes(e.slot))throw Error("L'orario selezionato non \xe8 disponibile per la nuova data")}let w=e.id,E={clientId:null!=(u=e.clientId)?u:null,name:e.name,email:e.email,phone:null!=(g=e.phone)?g:null,packageId:null!=(f=e.packageId)?f:null,date:e.date,slot:null!=(p=e.slot)?p:null,location:e.isFreeConsultation?"online":null!=(m=e.location)?m:null,studioLocation:null!=(v=e.studioLocation)?v:null,status:e.status,priority:!!e.priority,channelPreference:null!=(h=e.channelPreference)?h:null};if(await (0,i.BN)((0,i.H9)(n.db,"bookings",w),E,{merge:!0}),I.googleCalendarEventId)try{let t;if(e.packageId)try{let o=await (0,i.x7)((0,i.H9)(n.db,"packages",e.packageId));o.exists()&&(t=o.data().title)}catch(e){console.error("Error getting package title for calendar event update:",e)}("confirmed"===e.status?!!await (0,a.hX)(I.googleCalendarEventId,e,t):await (0,a.At)(I.googleCalendarEventId))?console.log("confirmed"===e.status?"Google Calendar event updated:":"Google Calendar event deleted (booking not confirmed):",I.googleCalendarEventId):console.error("Failed to update Google Calendar event:",I.googleCalendarEventId)}catch(e){console.error("Error updating Google Calendar event:",e)}else try{let t;if(e.packageId)try{let o=await (0,i.x7)((0,i.H9)(n.db,"packages",e.packageId));o.exists()&&(t=o.data().title)}catch(e){console.error("Error getting package title for calendar event create:",e)}if("confirmed"===e.status){let o=await (0,a.hX)(void 0,e,t);o&&(await (0,i.BN)((0,i.H9)(n.db,"bookings",e.id),{googleCalendarEventId:o},{merge:!0}),console.log("Google Calendar event created for existing booking:",o))}}catch(e){console.error("Error creating Google Calendar event on update:",e)}if("confirmed"===e.status)try{let t=await S(e.email);if(t)await b({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"active",source:t.source||"website"});else{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione confermata del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"active",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await b(t)}}catch(e){console.error("Error creating/updating client from booking:",e)}if("confirmed"===e.status&&e.slot&&e.date)try{let t=e.date.split("T")[0],o=s.availability(n.db,t),a=await (0,i.x7)(o);if(a.exists()){let n=a.data(),l=e.isFreeConsultation?"online":e.location||"online";if("online"===l){let a=n.onlineSlots||n.slots||[];if(a.includes(e.slot)){let n=a.filter(t=>t!==e.slot);await (0,i.BN)(o,{date:t,onlineSlots:n},{merge:!0})}else console.warn("Slot ".concat(e.slot," non pi\xf9 disponibile (online) per la data ").concat(t))}else{let a=n.inStudioSlots||[];if(a.includes(e.slot)){let n=a.filter(t=>t!==e.slot);await (0,i.BN)(o,{date:t,inStudioSlots:n},{merge:!0})}else console.warn("Slot ".concat(e.slot," non pi\xf9 disponibile (studio) per la data ").concat(t))}}if(I.slot&&I.slot!==e.slot){let e=I.date.split("T")[0],t=s.availability(n.db,e),o=await (0,i.x7)(t);if(o.exists()){let a=o.data(),n=I.isFreeConsultation?"online":I.location||"online";if("online"===n){let o=a.onlineSlots||a.slots||[];if(!o.includes(I.slot)){let a=[...o,I.slot];await (0,i.BN)(t,{date:e,onlineSlots:a},{merge:!0})}}else{let o=a.inStudioSlots||[];if(!o.includes(I.slot)){let a=[...o,I.slot];await (0,i.BN)(t,{date:e,inStudioSlots:a},{merge:!0})}}}}if(I.date!==e.date&&I.slot){let e=I.date.split("T")[0],t=s.availability(n.db,e),o=await (0,i.x7)(t);if(o.exists()){let a=o.data(),n=I.isFreeConsultation?"online":I.location||"online";if("online"===n){let o=a.onlineSlots||a.slots||[];if(!o.includes(I.slot)){let a=[...o,I.slot];await (0,i.BN)(t,{date:e,onlineSlots:a},{merge:!0})}}else{let o=a.inStudioSlots||[];if(!o.includes(I.slot)){let a=[...o,I.slot];await (0,i.BN)(t,{date:e,inStudioSlots:a},{merge:!0})}}}}}catch(e){console.error("Error updating availability in Firebase:",e)}}async function m(e){if(!n.db)throw Error("Firestore not configured");let t=null;try{let o=await (0,i.x7)((0,i.H9)(n.db,"bookings",e));if(o.exists()){if((t=P(e,o.data())).googleCalendarEventId)try{await (0,a.At)(t.googleCalendarEventId)?console.log("Google Calendar event deleted:",t.googleCalendarEventId):console.error("Failed to delete Google Calendar event:",t.googleCalendarEventId)}catch(e){console.error("Error deleting Google Calendar event:",e)}let i=await S(t.email);if(i)await b({...i,status:"inactive",notes:i.notes?"".concat(i.notes,"\n\nPrenotazione rifiutata il ").concat(new Date().toLocaleDateString("it-IT")):"Prenotazione rifiutata il ".concat(new Date().toLocaleDateString("it-IT"))});else{let e={name:t.name,email:t.email,phone:t.phone,notes:"Cliente creato automaticamente dalla prenotazione rifiutata del ".concat(new Date(t.date).toLocaleDateString("it-IT")),status:"inactive",source:"website",assignedPackage:t.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await b(e)}}}catch(e){console.error("Error creating client from rejected booking:",e)}if(await (0,i.kd)((0,i.H9)(n.db,"bookings",e)),t&&"confirmed"===t.status&&t.slot&&t.date)try{let e=t.date.split("T")[0],o=s.availability(n.db,e),a=await (0,i.x7)(o);if(a.exists()){let n=a.data(),l=t.isFreeConsultation?"online":t.location||"online";if("online"===l){let a=n.onlineSlots||n.slots||[];if(!a.includes(t.slot)){let n=[...a,t.slot].sort();await (0,i.BN)(o,{date:e,onlineSlots:n},{merge:!0})}}else if(t.studioLocation){let a=n.studioSlots||{},l=a[t.studioLocation]||[];l.includes(t.slot)||(a[t.studioLocation]=[...l,t.slot].sort(),await (0,i.BN)(o,{date:e,studioSlots:a},{merge:!0}))}else{let a=n.inStudioSlots||[];if(!a.includes(t.slot)){let n=[...a,t.slot].sort();await (0,i.BN)(o,{date:e,inStudioSlots:n},{merge:!0})}}}}catch(e){console.error("Error restoring availability after booking deletion in Firebase:",e)}}async function b(e){var t,o,a,l,r,c,d,u,g,f,p,m,b,S,v,h,y,C,I;if(!n.db)throw Error("Firestore not configured");if(e.id){let{id:t,...o}=e,a={};return Object.entries(o).forEach(e=>{let[t,o]=e;void 0!==o&&(a[t]=o)}),await (0,i.BN)((0,i.H9)(n.db,"clients",t),a,{merge:!0}),t}return(await (0,i.gS)(s.clients(n.db),{name:e.name,email:e.email,phone:null!=(t=e.phone)?t:null,notes:null!=(o=e.notes)?o:null,birthDate:null!=(a=e.birthDate)?a:null,gender:null!=(l=e.gender)?l:null,address:null!=(r=e.address)?r:null,city:null!=(c=e.city)?c:null,postalCode:null!=(d=e.postalCode)?d:null,emergencyContact:null!=(u=e.emergencyContact)?u:null,height:null!=(g=e.height)?g:null,weight:null!=(f=e.weight)?f:null,fitnessLevel:null!=(p=e.fitnessLevel)?p:null,goals:null!=(m=e.goals)?m:[],medicalConditions:null!=(b=e.medicalConditions)?b:[],allergies:null!=(S=e.allergies)?S:[],medications:null!=(v=e.medications)?v:[],source:null!=(h=e.source)?h:null,status:null!=(y=e.status)?y:"prospect",assignedPackage:null!=(C=e.assignedPackage)?C:null,documents:null!=(I=e.documents)?I:[],createdAt:(0,i.O5)()})).id}async function S(e){var t,o;if(!n.db)return null;let a=(0,i.P)((0,i.rJ)(n.db,"clients"),(0,i._M)("email","==",e)),l=await (0,i.GG)(a);if(l.empty)return null;let r=l.docs[0],s=r.data();return{id:r.id,name:s.name,email:s.email,phone:null!=(t=s.phone)?t:void 0,notes:null!=(o=s.notes)?o:void 0,createdAt:I(s.createdAt)}}async function v(){if(console.log("getSiteContent: Inizio funzione"),console.log("getSiteContent: Database configurato:",!!n.db),console.log("getSiteContent: Tipo database:",typeof n.db),!n.db)return console.log("getSiteContent: Database non configurato, return null"),null;try{var e,t,o,a,r,c,d,u,g,f,p,m,b,S,v,y,C,I,P,w,E,k,T,A,B,z,L,D,N,_,F,O,x,U,R,G,j,M;let H;console.log("getSiteContent: Caricamento contenuto da Firebase...");let J=await (0,i.x7)(s.content(n.db));if(console.log("getSiteContent: Snap ricevuto:",J),console.log("getSiteContent: Snap exists:",J.exists()),!J.exists()){console.log("getSiteContent: Nessun contenuto trovato in Firebase, creo contenuto di default");let e={heroTitle:"Trasforma il tuo fisico. Potenzia la tua performance.",heroSubtitle:"Coaching nutrizionale e training su misura per giovani adulti 20–35.",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",sectionVisibility:{hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},aboutTitle:"Chi Sono",aboutBody:"Sono Gabriele Zambonin, nutrizionista e personal trainer. Ti guido con un metodo scientifico e pratico per raggiungere forma fisica, energia e benessere reale.",aboutImageUrl:"",images:[],contactTitle:"\uD83D\uDCDE Contattami",contactSubtitle:"Siamo qui per aiutarti nel tuo percorso verso una vita pi\xf9 sana. Contattaci per qualsiasi domanda o per prenotare una consulenza.",contactPhone:"+39 123 456 7890",contactEmail:"info@gznutrition.it",contactAddresses:[{name:"Studio Principale",address:"Via Roma 123",city:"Milano",postalCode:"20100",coordinates:{lat:45.4642,lng:9.19}}],socialChannels:[{platform:"Instagram",url:"https://instagram.com/gznutrition",icon:"\uD83D\uDCF8"},{platform:"LinkedIn",url:"https://linkedin.com/in/gznutrition",icon:"\uD83D\uDCBC"}],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"Siamo qui per aiutarti",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"Trova lo studio pi\xf9 vicino a te",freeConsultationPopup:{isEnabled:!0,title:"\uD83C\uDFAF 10 Minuti Consultivi Gratuiti",subtitle:"Valuta i tuoi obiettivi gratuitamente",description:"Prenota il tuo primo incontro conoscitivo gratuito per valutare i tuoi obiettivi di benessere e performance.",ctaText:"Prenota Ora - \xc8 Gratis!",packageUrl:"free-consultation"},colorPalette:"gz-default",notificationEmail:"mirkoditroia@gmail.com",businessName:"GZ Nutrition",recaptchaEnabled:!1,recaptchaSiteKey:l.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY||"6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI",resultsSection:{isEnabled:!1,title:"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:[]}};try{return await h(e),console.log("getSiteContent: Contenuto di default salvato in Firebase"),e}catch(t){return console.error("getSiteContent: Errore nel salvare contenuto di default:",t),e}}let X=J.data();console.log("getSiteContent: Contenuto caricato da Firebase:",X),console.log("getSiteContent: Contatti - phone:",X.contactPhone),console.log("getSiteContent: Contatti - email:",X.contactEmail),console.log("getSiteContent: Contatti - addresses:",X.contactAddresses),console.log("getSiteContent: Contatti - social:",X.socialChannels),console.log("getSiteContent: Popup - freeConsultationPopup:",X.freeConsultationPopup),console.log("getSiteContent: Popup - isEnabled:",null==(e=X.freeConsultationPopup)?void 0:e.isEnabled),console.log("getSiteContent: Popup - title:",null==(t=X.freeConsultationPopup)?void 0:t.title);let V={heroTitle:X.heroTitle||"Trasforma il tuo fisico. Potenzia la tua performance.",heroSubtitle:X.heroSubtitle||"Coaching nutrizionale e training su misura per giovani adulti 20–35.",heroCta:X.heroCta||"Prenota ora",heroBackgroundImage:X.heroBackgroundImage||"",heroBadgeText:X.heroBadgeText||"Performance • Estetica • Energia",heroBadgeColor:X.heroBadgeColor||"bg-primary text-primary-foreground",sectionVisibility:X.sectionVisibility?{hero:!1!==X.sectionVisibility.hero,about:!1!==X.sectionVisibility.about,images:!1!==X.sectionVisibility.images,packages:!1!==X.sectionVisibility.packages,bookingForm:!1!==X.sectionVisibility.bookingForm,contact:!1!==X.sectionVisibility.contact}:{hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},navbarLogoMode:(H=X.navbarLogoMode,"image"===H||"text"===H?H:void 0),navbarLogoImageUrl:X.navbarLogoImageUrl||void 0,navbarLogoHeight:"number"==typeof X.navbarLogoHeight?X.navbarLogoHeight:void 0,navbarLogoAutoRemoveBg:!!X.navbarLogoAutoRemoveBg,navbarLogoText:X.navbarLogoText||void 0,navbarLogoTextColor:X.navbarLogoTextColor||void 0,navbarLogoTextWeight:"number"==typeof X.navbarLogoTextWeight?X.navbarLogoTextWeight:void 0,navbarLogoTextSize:"number"==typeof X.navbarLogoTextSize?X.navbarLogoTextSize:void 0,aboutTitle:X.aboutTitle||"Chi Sono",aboutBody:X.aboutBody||"Sono Gabriele Zambonin, nutrizionista e personal trainer. Ti guido con un metodo scientifico e pratico per raggiungere forma fisica, energia e benessere reale.",aboutImageUrl:X.aboutImageUrl||"",images:Array.isArray(X.images)?X.images:[],contactTitle:X.contactTitle||"\uD83D\uDCDE Contattami",contactSubtitle:X.contactSubtitle||"Siamo qui per aiutarti nel tuo percorso verso una vita pi\xf9 sana. Contattaci per qualsiasi domanda o per prenotare una consulenza.",contactPhone:X.contactPhone||"+39 123 456 7890",contactEmail:X.contactEmail||"info@gznutrition.it",contactAddresses:Array.isArray(X.contactAddresses)&&X.contactAddresses.length>0?X.contactAddresses:[{name:"Studio Principale",address:"Via Roma 123",city:"Milano",postalCode:"20100",coordinates:{lat:45.4642,lng:9.19}}],socialChannels:Array.isArray(X.socialChannels)&&X.socialChannels.length>0?X.socialChannels:[{platform:"Instagram",url:"https://instagram.com/gznutrition",icon:"\uD83D\uDCF8"},{platform:"LinkedIn",url:"https://linkedin.com/in/gznutrition",icon:"\uD83D\uDCBC"}],contactSectionTitle:X.contactSectionTitle||"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:X.contactSectionSubtitle||"Siamo qui per aiutarti",studiosSectionTitle:X.studiosSectionTitle||"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:X.studiosSectionSubtitle||"Trova lo studio pi\xf9 vicino a te",freeConsultationPopup:{isEnabled:(null==(o=X.freeConsultationPopup)?void 0:o.isEnabled)===!0||(null==(a=X.freeConsultationPopup)?void 0:a.isEnabled)==="true"||"true"===String(null==(r=X.freeConsultationPopup)?void 0:r.isEnabled),title:(null==(c=X.freeConsultationPopup)?void 0:c.title)||"\uD83C\uDFAF 10 Minuti Consultivi Gratuiti",subtitle:(null==(d=X.freeConsultationPopup)?void 0:d.subtitle)||"Valuta i tuoi obiettivi gratuitamente",description:(null==(u=X.freeConsultationPopup)?void 0:u.description)||"Prenota il tuo primo incontro conoscitivo gratuito per valutare i tuoi obiettivi di benessere e performance.",ctaText:(null==(g=X.freeConsultationPopup)?void 0:g.ctaText)||"Prenota Ora - \xc8 Gratis!",packageUrl:(null==(f=X.freeConsultationPopup)?void 0:f.packageUrl)||"free-consultation"},googleCalendar:{isEnabled:(null==(p=X.googleCalendar)?void 0:p.isEnabled)||!1,calendarId:(null==(m=X.googleCalendar)?void 0:m.calendarId)||"9765caa0fca592efb3eac96010b3f8f770050fad09fe7b379f16aacdc89fa689@group.calendar.google.com",timezone:(null==(b=X.googleCalendar)?void 0:b.timezone)||"Europe/Rome",serviceAccountEmail:(null==(S=X.googleCalendar)?void 0:S.serviceAccountEmail)||"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"},colorPalette:X.colorPalette||"gz-default",notificationEmail:X.notificationEmail||"mirkoditroia@gmail.com",businessName:X.businessName||"GZ Nutrition",recaptchaEnabled:!0===X.recaptchaEnabled,recaptchaSiteKey:X.recaptchaSiteKey||l.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY||"6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI",resultsSection:X.resultsSection?{isEnabled:!0===X.resultsSection.isEnabled,title:X.resultsSection.title||"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:X.resultsSection.subtitle||"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:Array.isArray(X.resultsSection.photos)?X.resultsSection.photos:[]}:{isEnabled:!1,title:"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:[]},bmiCalculator:X.bmiCalculator&&"object"==typeof X.bmiCalculator?{enabled:!0===X.bmiCalculator.enabled,title:X.bmiCalculator.title||"\uD83D\uDCCA Calcola il tuo BMI",subtitle:X.bmiCalculator.subtitle||"Scopri il tuo Indice di Massa Corporea"}:void 0,googleReviews:X.googleReviews&&"object"==typeof X.googleReviews?{enabled:!1!==X.googleReviews.enabled,title:X.googleReviews.title||"⭐ Recensioni Google",subtitle:X.googleReviews.subtitle||"Cosa dicono i nostri clienti",businessName:X.googleReviews.businessName||"GZ Nutrition",placeId:X.googleReviews.placeId||void 0,fallbackReviews:Array.isArray(X.googleReviews.fallbackReviews)?X.googleReviews.fallbackReviews.map(e=>({...e,source:e.source||"fallback"})):[]}:void 0,legalInfo:X.legalInfo?{companyName:X.legalInfo.companyName||"",vatNumber:X.legalInfo.vatNumber||"",taxCode:X.legalInfo.taxCode||"",email:X.legalInfo.email||"",registeredAddress:X.legalInfo.registeredAddress||"",footerText:X.legalInfo.footerText||"",showLegalLinks:!1!==X.legalInfo.showLegalLinks,gdprConsentText:X.legalInfo.gdprConsentText||"",cookieBanner:{enabled:(null==(v=X.legalInfo.cookieBanner)?void 0:v.enabled)!==!1,title:(null==(y=X.legalInfo.cookieBanner)?void 0:y.title)||"\uD83C\uDF6A Utilizzo dei Cookie",message:(null==(C=X.legalInfo.cookieBanner)?void 0:C.message)||"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:(null==(I=X.legalInfo.cookieBanner)?void 0:I.acceptText)||"Accetta",declineText:(null==(P=X.legalInfo.cookieBanner)?void 0:P.declineText)||"Rifiuta",learnMoreText:(null==(w=X.legalInfo.cookieBanner)?void 0:w.learnMoreText)||"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:(null==(k=X.legalInfo.legalPages)||null==(E=k.privacyPolicy)?void 0:E.title)||"Privacy Policy",lastUpdated:(null==(A=X.legalInfo.legalPages)||null==(T=A.privacyPolicy)?void 0:T.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(z=X.legalInfo.legalPages)||null==(B=z.privacyPolicy)?void 0:B.content)||""},cookiePolicy:{title:(null==(D=X.legalInfo.legalPages)||null==(L=D.cookiePolicy)?void 0:L.title)||"Cookie Policy",lastUpdated:(null==(_=X.legalInfo.legalPages)||null==(N=_.cookiePolicy)?void 0:N.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(O=X.legalInfo.legalPages)||null==(F=O.cookiePolicy)?void 0:F.content)||""},termsOfService:{title:(null==(U=X.legalInfo.legalPages)||null==(x=U.termsOfService)?void 0:x.title)||"Termini di Servizio",lastUpdated:(null==(G=X.legalInfo.legalPages)||null==(R=G.termsOfService)?void 0:R.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(M=X.legalInfo.legalPages)||null==(j=M.termsOfService)?void 0:j.content)||""}}}:{companyName:"",vatNumber:"",taxCode:"",email:"",registeredAddress:"",footerText:"",showLegalLinks:!0,gdprConsentText:"",cookieBanner:{enabled:!0,title:"\uD83C\uDF6A Utilizzo dei Cookie",message:"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:"Accetta",declineText:"Rifiuta",learnMoreText:"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:"Privacy Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},cookiePolicy:{title:"Cookie Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},termsOfService:{title:"Termini di Servizio",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""}}}};return console.log("getSiteContent: Contenuto finale mappato:",V),console.log("\uD83D\uDD0D getSiteContent: BMI raw da DB:",X.bmiCalculator),console.log("\uD83D\uDD0D getSiteContent: BMI mappato finale:",V.bmiCalculator),console.log("\uD83D\uDD0D getSiteContent: Reviews raw da DB:",X.googleReviews),console.log("\uD83D\uDD0D getSiteContent: Reviews mappate finale:",V.googleReviews),console.log("\uD83D\uDD0D getSiteContent: LegalInfo raw da DB:",X.legalInfo),console.log("\uD83D\uDD0D getSiteContent: LegalInfo mappato finale:",V.legalInfo),V}catch(e){return console.error("getSiteContent: Errore nel caricamento da Firebase:",e),null}}async function h(e){if(!n.db)throw Error("Firestore not configured");console.log("\uD83D\uDD25 [Firebase] upsertSiteContent chiamato"),console.log("\uD83D\uDD25 [Firebase] Content originale:",e),console.log("\uD83D\uDD25 [Firebase] BMI config:",e.bmiCalculator),console.log("\uD83D\uDD25 [Firebase] Reviews config:",e.googleReviews),console.log("\uD83D\uDD25 [Firebase] LegalInfo config:",e.legalInfo);let t=JSON.parse(JSON.stringify(e));if(t.sectionVisibility?t.sectionVisibility={hero:!1!==t.sectionVisibility.hero,about:!1!==t.sectionVisibility.about,images:!1!==t.sectionVisibility.images,packages:!1!==t.sectionVisibility.packages,bookingForm:!1!==t.sectionVisibility.bookingForm,contact:!1!==t.sectionVisibility.contact}:t.sectionVisibility={hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},t.legalInfo){var o,a,l,r,c,d,u,g,f,p,m,b,S,v,h,y,C,I,P,w,E,k,T,A;t.legalInfo={companyName:t.legalInfo.companyName||"",vatNumber:t.legalInfo.vatNumber||"",taxCode:t.legalInfo.taxCode||"",email:t.legalInfo.email||"",registeredAddress:t.legalInfo.registeredAddress||"",footerText:t.legalInfo.footerText||"",showLegalLinks:!1!==t.legalInfo.showLegalLinks,gdprConsentText:t.legalInfo.gdprConsentText||"",cookieBanner:{enabled:(null==(o=t.legalInfo.cookieBanner)?void 0:o.enabled)!==!1,title:(null==(a=t.legalInfo.cookieBanner)?void 0:a.title)||"\uD83C\uDF6A Utilizzo dei Cookie",message:(null==(l=t.legalInfo.cookieBanner)?void 0:l.message)||"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:(null==(r=t.legalInfo.cookieBanner)?void 0:r.acceptText)||"Accetta",declineText:(null==(c=t.legalInfo.cookieBanner)?void 0:c.declineText)||"Rifiuta",learnMoreText:(null==(d=t.legalInfo.cookieBanner)?void 0:d.learnMoreText)||"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:(null==(g=t.legalInfo.legalPages)||null==(u=g.privacyPolicy)?void 0:u.title)||"Privacy Policy",lastUpdated:(null==(p=t.legalInfo.legalPages)||null==(f=p.privacyPolicy)?void 0:f.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(b=t.legalInfo.legalPages)||null==(m=b.privacyPolicy)?void 0:m.content)||""},cookiePolicy:{title:(null==(v=t.legalInfo.legalPages)||null==(S=v.cookiePolicy)?void 0:S.title)||"Cookie Policy",lastUpdated:(null==(y=t.legalInfo.legalPages)||null==(h=y.cookiePolicy)?void 0:h.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(I=t.legalInfo.legalPages)||null==(C=I.cookiePolicy)?void 0:C.content)||""},termsOfService:{title:(null==(w=t.legalInfo.legalPages)||null==(P=w.termsOfService)?void 0:P.title)||"Termini di Servizio",lastUpdated:(null==(k=t.legalInfo.legalPages)||null==(E=k.termsOfService)?void 0:E.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(A=t.legalInfo.legalPages)||null==(T=A.termsOfService)?void 0:T.content)||""}}}}else t.legalInfo={companyName:"",vatNumber:"",taxCode:"",email:"",registeredAddress:"",footerText:"",showLegalLinks:!0,gdprConsentText:"",cookieBanner:{enabled:!0,title:"\uD83C\uDF6A Utilizzo dei Cookie",message:"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:"Accetta",declineText:"Rifiuta",learnMoreText:"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:"Privacy Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},cookiePolicy:{title:"Cookie Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},termsOfService:{title:"Termini di Servizio",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""}}};console.log("\uD83D\uDD25 [Firebase] Content sanitizzato:",t),console.log("\uD83D\uDD25 [Firebase] BMI sanitizzato:",t.bmiCalculator),console.log("\uD83D\uDD25 [Firebase] Reviews sanitizzato:",t.googleReviews),console.log("\uD83D\uDD25 [Firebase] LegalInfo sanitizzato:",t.legalInfo),console.log("\uD83D\uDD25 [Firebase] Chiamando setDoc..."),await (0,i.BN)(s.content(n.db),t,{merge:!0}),console.log("\uD83D\uDD25 [Firebase] ✅ setDoc completato con successo")}async function y(e){if(!n.db)return null;console.log("\uD83D\uDD0D getAvailabilityByDate Firebase per data:",e);let t=await (0,i.x7)(s.availability(n.db,e));if(!t.exists())return console.log("❌ Nessun documento availability trovato per data:",e),null;let o=t.data();console.log("\uD83D\uDCCA Dati raw da Firebase per",e,":",o);let a={date:e,onlineSlots:Array.isArray(o.onlineSlots)?o.onlineSlots:Array.isArray(o.slots)?o.slots:[],inStudioSlots:Array.isArray(o.inStudioSlots)?o.inStudioSlots:[],studioSlots:o.studioSlots&&"object"==typeof o.studioSlots?o.studioSlots:{},slots:Array.isArray(o.slots)?o.slots:void 0,freeConsultationSlots:Array.isArray(o.freeConsultationSlots)?o.freeConsultationSlots:[]};return console.log("✅ Availability processata:",a),console.log("\uD83C\uDFAF freeConsultationSlots trovati:",a.freeConsultationSlots),a}async function C(e,t,o,a,l){if(!n.db)throw Error("Firestore not configured");let r={date:e,onlineSlots:t};Array.isArray(o)&&(r.freeConsultationSlots=o),Array.isArray(a)&&(r.inStudioSlots=a),l&&"object"==typeof l&&(r.studioSlots=l),await (0,i.BN)(s.availability(n.db,e),r,{merge:!0})}function I(e){if(e)try{return e.toDate().toISOString()}catch(e){return}}function P(e,t){var o,i,a,n,l,r,s,c,d;return{id:e,clientId:null!=(o=t.clientId)?o:void 0,name:t.name,email:t.email,phone:null!=(i=t.phone)?i:void 0,packageId:null!=(a=t.packageId)?a:void 0,date:t.date,slot:null!=(n=t.slot)?n:void 0,location:null!=(l=t.location)?l:void 0,studioLocation:null!=(r=t.studioLocation)?r:void 0,status:t.status,priority:!!t.priority,channelPreference:null!=(s=t.channelPreference)?s:void 0,isFreeConsultation:!!t.isFreeConsultation,notes:null!=(c=t.notes)?c:void 0,createdAt:I(t.createdAt),googleCalendarEventId:null!=(d=t.googleCalendarEventId)?d:void 0}}function w(e,t){var o,i,a,n,l,r,s,c,d,u,g,f,p,m;return{id:e,name:t.name,email:t.email,phone:null!=(o=t.phone)?o:void 0,notes:null!=(i=t.notes)?i:void 0,birthDate:null!=(a=t.birthDate)?a:void 0,gender:null!=(n=t.gender)?n:void 0,address:null!=(l=t.address)?l:void 0,city:null!=(r=t.city)?r:void 0,postalCode:null!=(s=t.postalCode)?s:void 0,emergencyContact:null!=(c=t.emergencyContact)?c:void 0,height:null!=(d=t.height)?d:void 0,weight:null!=(u=t.weight)?u:void 0,fitnessLevel:null!=(g=t.fitnessLevel)?g:void 0,goals:Array.isArray(t.goals)?t.goals:[],medicalConditions:Array.isArray(t.medicalConditions)?t.medicalConditions:[],allergies:Array.isArray(t.allergies)?t.allergies:[],medications:Array.isArray(t.medications)?t.medications:[],source:null!=(f=t.source)?f:void 0,status:null!=(p=t.status)?p:"prospect",assignedPackage:null!=(m=t.assignedPackage)?m:void 0,documents:Array.isArray(t.documents)?t.documents:[],createdAt:I(t.createdAt)}}async function E(){return n.db?(await (0,i.GG)((0,i.P)(s.clients(n.db),(0,i.My)("createdAt","desc")))).docs.map(e=>w(e.id,e.data())):[]}async function k(e){if(!n.db)return null;let t=n.db,o=await (0,i.x7)((0,i.H9)(t,"clients",e));return o.exists()?w(o.id,o.data()):null}async function T(e){if(!n.db)throw Error("Firestore not configured");await (0,i.kd)((0,i.H9)(n.db,"clients",e))}async function A(e){if(!n.db)throw Error("Firestore not configured");let t={...e,createdAt:(0,i.O5)()};return(await (0,i.gS)((0,i.rJ)(n.db,"clientProgress"),t)).id}async function B(e){if(!n.db)return[];try{let t=(0,i.P)((0,i.rJ)(n.db,"clientProgress"),(0,i._M)("clientId","==",e),(0,i.My)("date","desc"));return(await (0,i.GG)(t)).docs.map(e=>{var t,o,i;let a=e.data();return{id:e.id,clientId:a.clientId,date:a.date,weight:a.weight,bodyFat:a.bodyFat,muscleMass:a.muscleMass,measurements:a.measurements,notes:a.notes,photos:a.photos,createdAt:(null==(i=a.createdAt)||null==(o=i.toDate)||null==(t=o.call(i))?void 0:t.toISOString())||new Date().toISOString()}})}catch(o){console.log("Indice non ancora pronto, uso query senza ordinamento");let t=(0,i.P)((0,i.rJ)(n.db,"clientProgress"),(0,i._M)("clientId","==",e));return(await (0,i.GG)(t)).docs.map(e=>{var t,o,i;let a=e.data();return{id:e.id,clientId:a.clientId,date:a.date,weight:a.weight,bodyFat:a.bodyFat,muscleMass:a.muscleMass,measurements:a.measurements,notes:a.notes,photos:a.photos,createdAt:(null==(i=a.createdAt)||null==(o=i.toDate)||null==(t=o.call(i))?void 0:t.toISOString())||new Date().toISOString()}}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())}}async function z(e,t){if(!n.db)throw Error("Firestore not configured");let{id:o,createdAt:a,...l}=t;await (0,i.mZ)((0,i.H9)(n.db,"clientProgress",e),l)}async function L(e){if(!n.db)throw Error("Firestore not configured");await (0,i.kd)((0,i.H9)(n.db,"clientProgress",e))}async function D(e){if(!n.db)throw Error("Firestore not configured");let t=await S(e.email);if(t)return await b({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"prospect",source:t.source||"website"}),t.id;{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione in attesa del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"prospect",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};return await b(t)}}},5197:(e,t,o)=>{async function i(e,t){try{let o=await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",booking:e,packageTitle:t})});if(!o.ok)throw Error("HTTP error! status: ".concat(o.status));let i=await o.json();if(i.success)return console.log("Google Calendar event created:",i.eventId),i.eventId;return console.error("Failed to create calendar event:",i.message),null}catch(e){return console.error("Error creating Google Calendar event:",e),null}}async function a(e,t,o){try{let i=await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update",eventId:e,booking:t,packageTitle:o})});if(!i.ok)return!1;let a=await i.json();if(a.success)return console.log("Google Calendar event updated:",e),!0;return console.error("Failed to update calendar event:",a.message),!1}catch(e){return console.error("Error updating Google Calendar event:",e),!1}}async function n(e,t,o){return e?await a(e,t,o)?e:await i(t,o):await i(t,o)}async function l(e){try{let t=await fetch("/api/calendar",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:e})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let o=await t.json();if(o.success)return console.log("Google Calendar event deleted:",e),!0;return console.error("Failed to delete calendar event:",o.message),!1}catch(e){return console.error("Error deleting Google Calendar event:",e),!1}}async function r(){try{let e=await fetch("/api/calendar",{method:"GET"});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){return console.error("Google Calendar connection test failed:",e),{success:!1,message:e instanceof Error?e.message:"Connection test failed"}}}o.d(t,{At:()=>l,Zl:()=>r,hX:()=>n}),o(5704)},9018:(e,t,o)=>{o.r(t),o.d(t,{createBooking:()=>g,createClientFromPendingBooking:()=>y,deleteBooking:()=>p,deleteClient:()=>h,deleteClientProgress:()=>B,deletePackage:()=>d,getAvailabilityByDate:()=>P,getClientByEmail:()=>b,getClientById:()=>v,getClientProgress:()=>T,getDataMode:()=>n,getPackages:()=>s,getSiteContent:()=>C,listBookings:()=>u,listClients:()=>S,saveClientProgress:()=>k,updateBooking:()=>f,updateClientProgress:()=>A,upsertAvailabilityForDate:()=>w,upsertClient:()=>m,upsertPackage:()=>c,upsertSiteContent:()=>I});var i=o(4368),a=o(5704);function n(){let e=a.env.NEXT_PUBLIC_DATA_MODE;if("local"===e||"demo"===e||"firebase"===e)return console.log("[DataMode] Override detected:",e),e;let t="AIzaSyAp1IXe0d2yE-BSrZLGKHfDkdkm1NuSwfs";return(console.log("[DataMode] Production mode, Firebase configured:",t),t)?(console.log("[DataMode] Using firebase mode"),"firebase"):(console.log("[DataMode] Using demo mode"),"demo")}async function l(e){try{let t,o=await C(),i=(null==o?void 0:o.notificationEmail)||"mirkoditroia@gmail.com",a=(null==o?void 0:o.businessName)||"GZ Nutrition",n=(null==o?void 0:o.colorPalette)||"gz-default";if(e.packageId)try{let o=(await s()).find(t=>t.id===e.packageId);o&&(t=o.title)}catch(e){console.error("Error getting package title for calendar event:",e)}e.isFreeConsultation&&(t="Consultazione Gratuita (10 minuti)");let l=await fetch("https://sendbookingnotification-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"new-booking",booking:e,packageTitle:t,notificationEmail:i,businessName:a,colorPalette:n})}),r=await l.json();r.success?(console.log("✅ Booking notification (dottore) sent successfully:",r.sentTo),e.isFreeConsultation&&console.log("\uD83D\uDCE7 Email sent for free consultation booking")):console.error("❌ Failed to send booking notification:",r.message)}catch(e){console.error("❌ Error sending booking notification:",e)}}async function r(e,t){try{let o=await fetch(e,{cache:"no-store"});if(!o.ok)return t;return await o.json()}catch(e){return t}}async function s(){let e=n();if("firebase"===e)return(0,i.G9)();if("demo"===e)return r("/demo/packages.json",[]);try{let e=await fetch("/api/localdb/packages",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function c(e){var t;let o=n();if("firebase"===o)return(0,i.Kh)(e);if("demo"===o)throw Error("Preprod demo read-only");let a=null!=(t=e.id)?t:E(),l=await s(),r=[{...e,id:a},...l.filter(e=>e.id!==a)];return await fetch("/api/localdb/packages",{method:"POST",body:JSON.stringify(r)}),a}async function d(e){let t=n();if("firebase"===t){let{deletePackage:t}=await Promise.resolve().then(o.bind(o,4368));return t(e)}if("demo"===t)throw Error("Preprod demo read-only");let i=(await s()).filter(t=>t.id!==e);await fetch("/api/localdb/packages",{method:"POST",body:JSON.stringify(i)})}async function u(){let e=n();if("firebase"===e)return(0,i.ZY)();if("demo"===e)return r("/demo/bookings.json",[]);try{let e=await fetch("/api/localdb/bookings",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function g(e,t){var o,a,r,s,c,d,u,g,f,p,m,b,S,v,h,y,C,I;let k=n();if("firebase"===k)return(0,i.sH)(e,t);if("demo"===k)throw Error("Preprod demo read-only");if(!e.slot)throw Error("Lo slot orario \xe8 obbligatorio per la prenotazione");let T=await P(e.date),A=e.isFreeConsultation?"online":e.location||"online",B="online"===A?null!=(r=null!=(a=null==T?void 0:T.onlineSlots)?a:null==T?void 0:T.slots)?r:[]:e.studioLocation?null!=(s=null==T||null==(o=T.studioSlots)?void 0:o[e.studioLocation])?s:[]:null!=(c=null==T?void 0:T.inStudioSlots)?c:[];if(!T||!B.includes(e.slot))throw Error("L'orario selezionato non \xe8 pi\xf9 disponibile");let z=E(),L=new Date().toISOString();try{let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),o=t.ok?await t.json():[],i=[{...e,id:z,createdAt:L},...o];if(await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(i)}),"online"===A){let t=(null!=(u=null!=(d=T.onlineSlots)?d:T.slots)?u:[]).filter(t=>t!==e.slot);await w(e.date,t,T.freeConsultationSlots,null!=(g=T.inStudioSlots)?g:[],null!=(f=T.studioSlots)?f:{})}else if(e.studioLocation){let t={...null!=(p=T.studioSlots)?p:{}};t[e.studioLocation]=(null!=(m=t[e.studioLocation])?m:[]).filter(t=>t!==e.slot),await w(e.date,null!=(S=null!=(b=T.onlineSlots)?b:T.slots)?S:[],T.freeConsultationSlots,null!=(v=T.inStudioSlots)?v:[],t)}else{let t=(null!=(h=T.inStudioSlots)?h:[]).filter(t=>t!==e.slot);await w(e.date,null!=(C=null!=(y=T.onlineSlots)?y:T.slots)?C:[],T.freeConsultationSlots,t,null!=(I=T.studioSlots)?I:{})}let a={...e,id:z,createdAt:L};return await l(a),z}catch(o){await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify([{...e,id:z,createdAt:L}])});let t={...e,id:z,createdAt:L};return await l(t),z}}async function f(e){let t=n();if("firebase"===t)return(0,i.vq)(e);if("demo"===t)throw Error("Preprod demo read-only");try{var o,a,l,r,s,c;let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),i=t.ok?await t.json():[],n=i.find(t=>t.id===e.id);if(n&&n.slot!==e.slot&&e.slot){let t=await P(e.date),i=e.isFreeConsultation?"online":e.location||"online",n="online"===i?null!=(a=null!=(o=null==t?void 0:t.onlineSlots)?o:null==t?void 0:t.slots)?a:[]:null!=(l=null==t?void 0:t.inStudioSlots)?l:[];if(!t||!n.includes(e.slot))throw Error("Il nuovo orario selezionato non \xe8 pi\xf9 disponibile")}if(n&&n.date!==e.date&&e.slot){let t=await P(e.date),o=e.isFreeConsultation?"online":e.location||"online",i="online"===o?null!=(s=null!=(r=null==t?void 0:t.onlineSlots)?r:null==t?void 0:t.slots)?s:[]:null!=(c=null==t?void 0:t.inStudioSlots)?c:[];if(!t||!i.includes(e.slot))throw Error("L'orario selezionato non \xe8 disponibile per la nuova data")}let d=i.map(t=>t.id===e.id?e:t);await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(d)}),console.log("\uD83D\uDCCB Prenotazione aggiornata:",e.id,"- gestione disponibilit\xe0 delegata al sistema principale")}catch(e){throw console.error("Error updating booking:",e),e}}async function p(e){let t=n();if("firebase"===t)return(0,i.VA)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),o=t.ok?await t.json():[],i=o.find(t=>t.id===e),a=o.filter(t=>t.id!==e);await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(a)}),console.log("\uD83D\uDCCB Prenotazione cancellata:",null==i?void 0:i.id,"- availability gestita dal sistema principale")}catch(e){throw console.error("Error deleting booking:",e),e}}async function m(e){var t,o,a;let l=n();if("firebase"===l)return(0,i.TP)(e);if("demo"===l)throw Error("Preprod demo read-only");let r=function(e,t){try{let o=localStorage.getItem(e);return o?JSON.parse(o):t}catch(e){return t}}("gzn:clients",[]),s=null!=(t=e.id)?t:E();return o="gzn:clients",a=[{...e,id:s},...r.filter(e=>e.id!==s)],localStorage.setItem(o,JSON.stringify(a)),s}async function b(e){var t,o;let a=n();if("firebase"===a)return(0,i.dd)(e);if("demo"===a)return null!=(t=(await r("/demo/clients.json",[])).find(t=>t.email===e))?t:null;try{let t=await fetch("/api/localdb/clients",{cache:"no-store"});return null!=(o=(t.ok?await t.json():[]).find(t=>t.email===e))?o:null}catch(e){return null}}async function S(){let e=n();if("firebase"===e)return(0,i.by)();if("demo"===e)return r("/demo/clients.json",[]);try{let e=await fetch("/api/localdb/clients",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function v(e){var t,o;let a=n();if("firebase"===a)return(0,i.EZ)(e);if("demo"===a)return null!=(t=(await r("/demo/clients.json",[])).find(t=>t.id===e))?t:null;try{let t=await fetch("/api/localdb/clients",{cache:"no-store"});return null!=(o=(t.ok?await t.json():[]).find(t=>t.id===e))?o:null}catch(e){return null}}async function h(e){let t=n();if("firebase"===t)return(0,i.zZ)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/clients",{cache:"no-store"}),o=(t.ok?await t.json():[]).filter(t=>t.id!==e);await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(o)})}catch(e){throw console.error("Error deleting client:",e),e}}async function y(e){let t=n();if("firebase"===t)return(0,i.Wi)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/clients",{cache:"no-store"}),o=t.ok?await t.json():[],i=o.find(t=>t.email===e.email);if(i){let t={...i,name:e.name,phone:e.phone||i.phone,assignedPackage:e.packageId||i.assignedPackage,status:"prospect",source:i.source||"website"},a=o.map(e=>e.id===i.id?t:e);return await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(a)}),i.id}{let t={id:crypto.randomUUID(),name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione in attesa del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"prospect",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()},i=[t,...o];return await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(i)}),t.id}}catch(e){throw console.error("Error creating client from pending booking:",e),e}}async function C(){let e=n();if("firebase"===e)return(0,i.fH)();if("demo"===e)return r("/demo/siteContent.json",{heroTitle:"",heroSubtitle:"",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",images:[],contactTitle:"",contactSubtitle:"",contactPhone:"",contactEmail:"",contactAddresses:[],socialChannels:[],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"",colorPalette:"gz-default",googleCalendar:{isEnabled:!1,calendarId:"9765caa0fca592efb3eac96010b3f8f770050fad09fe7b379f16aacdc89fa689@group.calendar.google.com",timezone:"Europe/Rome",serviceAccountEmail:"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"}});try{let e=await fetch("/api/localdb/siteContent",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return{heroTitle:"",heroSubtitle:"",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",aboutTitle:"",aboutBody:"",aboutImageUrl:"",images:[],contactTitle:"",contactSubtitle:"",contactPhone:"",contactEmail:"",contactAddresses:[],socialChannels:[],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"",colorPalette:"gz-default",googleCalendar:{isEnabled:!1,calendarId:"9765caa0fca592efb3eac96010b3f8f770050fad09fe7b379f16aacdc89fa689@group.calendar.google.com",timezone:"Europe/Rome",serviceAccountEmail:"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"}}}async function I(e){let t=n();if(console.log("[upsertSiteContent] Current mode:",t),console.log("[upsertSiteContent] \uD83D\uDCCA BMI config being saved:",e.bmiCalculator),console.log("[upsertSiteContent] ⭐ Reviews config being saved:",e.googleReviews),console.log("[upsertSiteContent] ⚖️ LegalInfo config being saved:",e.legalInfo),"firebase"===t){console.log("[upsertSiteContent] Using Firebase"),console.log("[upsertSiteContent] \uD83D\uDD25 Calling Firebase upsert..."),await (0,i._L)(e),console.log("[upsertSiteContent] ✅ Firebase upsert completed");return}if("demo"===t)throw console.log("[upsertSiteContent] Demo mode - throwing read-only error"),Error("Preprod demo read-only");console.log("[upsertSiteContent] Using local API"),console.log("[upsertSiteContent] \uD83D\uDCE4 Sending to local API...");let o=await fetch("/api/localdb/siteContent",{method:"POST",body:JSON.stringify(e)});if(console.log("[upsertSiteContent] \uD83D\uDCE5 Local API response:",o.status,o.statusText),!o.ok)throw Error("Local API failed: ".concat(o.status," ").concat(o.statusText))}async function P(e){let t=n();if(console.log("\uD83C\uDF10 [SITO PUBBLICO] getAvailabilityByDate chiamata per:",e,"modalit\xe0:",t),"firebase"===t){let t=await (0,i.ho)(e);return console.log("\uD83D\uDD25 [SITO PUBBLICO] Risultato da Firebase:",t),t}if("demo"===t)return r("/demo/availability/".concat(e,".json"),{date:e,slots:[]});try{let t=await fetch("/api/localdb/availability",{cache:"no-store"}),i=(t.ok?await t.json():{})[e];if(console.log("\uD83D\uDCBE [SITO PUBBLICO] Dati locali per",e,":",i),i){var o,a,l,s,c;let t={date:e,onlineSlots:null!=(a=null!=(o=i.onlineSlots)?o:i.slots)?a:[],inStudioSlots:null!=(l=i.inStudioSlots)?l:[],studioSlots:null!=(s=i.studioSlots)?s:{},slots:i.slots,freeConsultationSlots:null!=(c=i.freeConsultationSlots)?c:[]};return console.log("✅ [SITO PUBBLICO] Risultato locale processato:",t),t}return console.log("❌ [SITO PUBBLICO] Nessun dato trovato per:",e),{date:e,onlineSlots:[],inStudioSlots:[],freeConsultationSlots:[]}}catch(t){return console.error("❌ [SITO PUBBLICO] Errore caricamento dati:",t),{date:e,onlineSlots:[],inStudioSlots:[],freeConsultationSlots:[]}}}async function w(e,t,o,a,l){let r=n();if("firebase"===r)return(0,i.wb)(e,t,o,a,l);if("demo"===r)throw Error("Preprod demo read-only");try{var s,c;let i=await fetch("/api/localdb/availability",{cache:"no-store"}),n=i.ok?await i.json():{};n[e]={onlineSlots:t,inStudioSlots:a||[],freeConsultationSlots:o||[],studioSlots:null!=(c=null!=l?l:null==(s=n[e])?void 0:s.studioSlots)?c:{}},await fetch("/api/localdb/availability",{method:"POST",body:JSON.stringify(n)})}catch(e){}}function E(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)}async function k(e){if("local"===n()){let t=E(),o={...e,id:t,createdAt:new Date().toISOString()},i=JSON.parse(localStorage.getItem("clientProgress")||"[]");return i.push(o),localStorage.setItem("clientProgress",JSON.stringify(i)),t}return(0,i.u2)(e)}async function T(e){return"local"===n()?JSON.parse(localStorage.getItem("clientProgress")||"[]").filter(t=>t.clientId===e).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()):(0,i.HG)(e)}async function A(e,t){if("local"===n()){let o=JSON.parse(localStorage.getItem("clientProgress")||"[]"),i=o.findIndex(t=>t.id===e);-1!==i&&(o[i]={...o[i],...t},localStorage.setItem("clientProgress",JSON.stringify(o)));return}return(0,i.Ej)(e,t)}async function B(e){if("local"===n()){let t=JSON.parse(localStorage.getItem("clientProgress")||"[]").filter(t=>t.id!==e);localStorage.setItem("clientProgress",JSON.stringify(t));return}return(0,i.KB)(e)}}}]);