"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[576],{576:(e,t,o)=>{o.d(t,{X2:()=>c,cY:()=>r,f9:()=>s});var i=o(9018);let a=null,n=0;async function l(){let e=Date.now();if(null!==a&&e<n)return a;try{let t=await (0,i.getSiteContent)();return a=(null==t?void 0:t.debugLogsEnabled)!==!1,n=e+3e4,a}catch(t){return a=!0,n=e+3e4,!0}}async function r(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];await l()&&console.log(...t)}function s(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];!1!==a&&console.log(...t)}function c(){a=null,n=0}},1272:(e,t,o)=>{o.d(t,{j2:()=>u,db:()=>g});var i=o(2078),a=o(2553),n=o(9708),l=o(2377),r=o(5704);let s=l.Ik({NEXT_PUBLIC_FIREBASE_API_KEY:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_PROJECT_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_APP_ID:l.Yj().optional().default(""),NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID:l.Yj().optional().default("")}).parse({NEXT_PUBLIC_FIREBASE_API_KEY:"AIzaSyAp1IXe0d2yE-BSrZLGKHfDkdkm1NuSwfs",NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:"gznutrition-d5d13.firebaseapp.com",NEXT_PUBLIC_FIREBASE_PROJECT_ID:"gznutrition-d5d13",NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:"gznutrition-d5d13.firebasestorage.app",NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:"658719519730",NEXT_PUBLIC_FIREBASE_APP_ID:"1:658719519730:web:37dafec47d6f4e6c0db16b",NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID:r.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID});o(4663);let c={apiKey:s.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:s.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:s.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:s.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:s.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:s.NEXT_PUBLIC_FIREBASE_APP_ID},d=s.NEXT_PUBLIC_FIREBASE_API_KEY&&s.NEXT_PUBLIC_FIREBASE_PROJECT_ID&&s.NEXT_PUBLIC_FIREBASE_APP_ID?(0,i.Dk)().length?(0,i.Sx)():(0,i.Wp)(c):null,u=d?(0,a.xI)(d):void 0,g=d?(0,n.aU)(d):void 0},4368:(e,t,o)=>{o.d(t,{EZ:()=>k,Ej:()=>D,G9:()=>d,HG:()=>B,KB:()=>L,Kh:()=>u,TP:()=>S,VA:()=>b,Wi:()=>z,ZY:()=>f,_L:()=>y,by:()=>T,dd:()=>v,deletePackage:()=>g,fH:()=>C,ho:()=>h,sH:()=>m,u2:()=>N,vq:()=>p,wb:()=>I,zZ:()=>A});var i=o(9708),a=o(5197),n=o(576),l=o(1272),r=o(5704);async function s(e,t,o,i,a){try{(0,n.f9)("\uD83D\uDCE4 sendBookingNotification chiamata con:",{bookingId:e.id,isFreeConsultation:e.isFreeConsultation,packageTitle:t,notificationEmail:o});let l=await fetch("https://sendbookingnotification-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"new-booking",booking:e,packageTitle:t,notificationEmail:o,businessName:i,colorPalette:a})});(0,n.f9)("\uD83D\uDCEC Risposta Firebase Functions:",l.status);let r=await l.json();(0,n.f9)("\uD83D\uDCCB Risultato email:",r),r.success?(0,n.f9)("✅ Booking notification sent successfully:",r.sentTo):console.error("❌ Failed to send booking notification:",r.message)}catch(e){console.error("❌ Error sending booking notification:",e)}}let c={packages:e=>(0,i.rJ)(e,"packages"),bookings:e=>(0,i.rJ)(e,"bookings"),clients:e=>(0,i.rJ)(e,"clients"),content:e=>(0,i.H9)(e,"content/landing"),availability:(e,t)=>(0,i.H9)(e,"availability/".concat(t))};async function d(){if(!l.db)return(0,n.f9)("getPackages: Database non configurato"),[];try{(0,n.f9)("getPackages: Caricamento pacchetti da Firebase...");let e=l.db,t=await (0,i.GG)((0,i.P)(c.packages(e),(0,i.My)("createdAt","desc")));(0,n.f9)("getPackages: Snap ricevuto:",t),(0,n.f9)("getPackages: Numero documenti:",t.docs.length);let o=t.docs.map(e=>{let t=e.data();(0,n.f9)("getPackages: Documento ".concat(e.id,":"),t);let o={id:e.id,title:t.title||"",description:t.description||"",price:t.price||0,imageUrl:t.imageUrl||"",isActive:void 0!==t.active?t.active:t.isActive||!1,featured:t.featured||!1,badge:t.badge||"",isPromotional:t.isPromotional||!1,hasDiscount:t.hasDiscount||!1,basePrice:t.basePrice||void 0,discountedPrice:t.discountedPrice||void 0,discountPercentage:t.discountPercentage||void 0,paymentText:t.paymentText||void 0,details:t.details||void 0,createdAt:t.createdAt?t.createdAt.toDate?t.createdAt.toDate().toISOString():t.createdAt:void 0};return(0,n.f9)("getPackages: Pacchetto mappato ".concat(e.id,":"),o),o});return(0,n.f9)("getPackages: Pacchetti processati:",o),o}catch(e){return console.error("getPackages: Errore nel caricamento da Firebase:",e),[]}}async function u(e){var t,o,a,n,r,s,d,u,g,f,m,p,b,S,v,C,y,h;if(!l.db)throw Error("Firestore not configured");return e.id?(await (0,i.mZ)((0,i.H9)(l.db,"packages",e.id),{title:e.title,description:e.description,price:e.price,imageUrl:null!=(t=e.imageUrl)?t:null,active:e.isActive,featured:null!=(o=e.featured)&&o,badge:null!=(a=e.badge)?a:null,isPromotional:null!=(n=e.isPromotional)&&n,hasDiscount:null!=(r=e.hasDiscount)&&r,basePrice:null!=(s=e.basePrice)?s:null,discountedPrice:null!=(d=e.discountedPrice)?d:null,discountPercentage:null!=(u=e.discountPercentage)?u:null,paymentText:e.paymentText||null,details:null!=(g=e.details)?g:null,createdAt:(0,i.O5)()}),e.id):(await (0,i.gS)(c.packages(l.db),{title:e.title,description:e.description,price:e.price,imageUrl:null!=(f=e.imageUrl)?f:null,active:e.isActive,featured:null!=(m=e.featured)&&m,badge:null!=(p=e.badge)?p:null,isPromotional:null!=(b=e.isPromotional)&&b,hasDiscount:null!=(S=e.hasDiscount)&&S,basePrice:null!=(v=e.basePrice)?v:null,discountedPrice:null!=(C=e.discountedPrice)?C:null,discountPercentage:null!=(y=e.discountPercentage)?y:null,paymentText:e.paymentText||null,details:null!=(h=e.details)?h:null,createdAt:(0,i.O5)()})).id}async function g(e){if(!l.db)throw Error("Firestore not configured");if(!e)throw Error("Package ID is required for deletion");await (0,i.kd)((0,i.H9)(l.db,"packages",e))}async function f(){if(!l.db)return[];let e=l.db;return(await (0,i.GG)((0,i.P)(c.bookings(e),(0,i.My)("createdAt","desc")))).docs.map(e=>E(e.id,e.data()))}async function m(e,t){var o,r,d,u,g,f,m,p,b,y,w,E,P,T,k,A,N,B,D,L,z,_,F,O,U,x,R,G,M,j,H;let J,X;if((0,n.f9)("\uD83D\uDD25 createBooking Firebase iniziato:",{isFreeConsultation:e.isFreeConsultation,slot:e.slot,date:e.date,dateFormatted:new Date(e.date).toISOString().split("T")[0],packageId:e.packageId}),!l.db)throw Error("Firestore not configured");let V=await C();if((null==V?void 0:V.recaptchaEnabled)&&t)try{(0,n.f9)("\uD83D\uDD11 Inizio verifica CAPTCHA con token:",t?t.substring(0,20)+"...":"null");let e=await fetch("https://verifycaptcha-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})});(0,n.f9)("\uD83D\uDCE1 Risposta Firebase Function status:",e.status);let o=await e.json();if((0,n.f9)("\uD83D\uDD0D Risultato verifica CAPTCHA:",o),!o.success)throw console.error("❌ CAPTCHA verifica fallita:",o.message,o.errors),Error("Verifica CAPTCHA fallita: ".concat(o.message||"Errore sconosciuto"));(0,n.f9)("✅ CAPTCHA verificato con successo!")}catch(e){throw console.error("\uD83D\uDCA5 Errore verifica CAPTCHA:",e),Error("Errore nella verifica CAPTCHA. Riprova.")}else if((null==V?void 0:V.recaptchaEnabled)&&!t)throw Error("Token CAPTCHA mancante. Completa la verifica CAPTCHA.");if(!e.slot)throw Error("Lo slot orario \xe8 obbligatorio per la prenotazione");let Z=e.date.includes("T")?e.date.split("T")[0]:e.date;(0,n.f9)("\uD83D\uDD0D FORMATO DATA DEBUG:"),(0,n.f9)("\uD83D\uDCC5 Data originale dal form:",e.date),(0,n.f9)("\uD83D\uDCC5 Data standardizzata per query:",Z);let K=await h(Z),Y=e.isFreeConsultation?"online":e.location||"online",q=[];if(e.isFreeConsultation){let t=null!=(o=null==K?void 0:K.freeConsultationSlots)?o:[];if(t.length>0&&"object"==typeof t[0]){q=t.map(e=>e.time);let o=t.find(t=>t.time===e.slot);J=null==o?void 0:o.duration}else q=t.map(e=>"string"==typeof e?e:e.time);if((0,n.f9)("\uD83D\uDD0D Consulenza gratuita - Slot promozionali disponibili:",q.length,"slot"),(0,n.f9)("\uD83D\uDCC5 Slot richiesto:",e.slot),(0,n.f9)("⏱️ Durata consultazione:",J,"minuti"),0===q.length)throw Error("❌ Nessun slot per consulenze gratuite disponibile per questa data")}else q="online"===Y?null!=(u=null!=(d=null==K?void 0:K.onlineSlots)?d:null==K?void 0:K.slots)?u:[]:e.studioLocation?null!=(g=null==K||null==(r=K.studioSlots)?void 0:r[e.studioLocation])?g:[]:null!=(f=null==K?void 0:K.inStudioSlots)?f:[];if(!K||!q.includes(e.slot))throw console.error("❌ VALIDAZIONE SLOT FALLITA!"),console.error("  - availability presente:",!!K),console.error("  - pool.length:",q.length),console.error("  - slot richiesto:",e.slot),console.error("  - isFreeConsultation:",e.isFreeConsultation),Error("L'orario selezionato non \xe8 pi\xf9 disponibile");if((0,n.f9)("✅ Slot validato correttamente:",e.slot),e.isFreeConsultation){let e=J||10;X="Consultazione Gratuita (".concat(e," minuti)")}else if(e.packageId)try{let t=await (0,i.x7)((0,i.H9)(l.db,"packages",e.packageId));t.exists()&&(X=t.data().title)}catch(e){console.error("Error getting package title for calendar event:",e)}(0,n.f9)("\uD83D\uDCBE Salvando prenotazione nel database...");let W=await (0,i.gS)(c.bookings(l.db),{clientId:null!=(m=e.clientId)?m:null,name:e.name,email:e.email,phone:null!=(p=e.phone)?p:null,packageId:null!=(b=e.packageId)?b:null,date:e.date,slot:null!=(y=e.slot)?y:null,location:Y,studioLocation:null!=(w=e.studioLocation)?w:null,status:e.status||"confirmed",priority:!!e.priority,channelPreference:null!=(E=e.channelPreference)?E:null,isFreeConsultation:!!e.isFreeConsultation,consultationDuration:null!=J?J:null,notes:null!=(P=e.notes)?P:null,createdAt:(0,i.O5)()});if((0,n.f9)("✅ Prenotazione salvata con ID:",W.id),e.isFreeConsultation){let t,o=null!=(T=null==K?void 0:K.freeConsultationSlots)?T:[];t=o.length>0&&"object"==typeof o[0]?o.filter(t=>t.time!==e.slot):o.filter(t=>"string"==typeof t?t!==e.slot:t.time!==e.slot).map(e=>"string"==typeof e?e:e.time),(0,n.f9)("\uD83D\uDDD1️ Rimuovendo slot promozionale:",e.slot),(0,n.f9)("\uD83D\uDCCB Slot promozionali rimanenti:",t),await I(Z,null!=(A=null!=(k=K.onlineSlots)?k:K.slots)?A:[],t,null!=(N=K.inStudioSlots)?N:[],null!=(B=K.studioSlots)?B:{})}else if("online"===Y){let t=(null!=(L=null!=(D=K.onlineSlots)?D:K.slots)?L:[]).filter(t=>t!==e.slot);await I(Z,t,K.freeConsultationSlots,null!=(z=K.inStudioSlots)?z:[],null!=(_=K.studioSlots)?_:{})}else if(e.studioLocation){let t={...null!=(F=K.studioSlots)?F:{}};t[e.studioLocation]=(null!=(O=t[e.studioLocation])?O:[]).filter(t=>t!==e.slot),await I(Z,null!=(x=null!=(U=K.onlineSlots)?U:K.slots)?x:[],K.freeConsultationSlots,null!=(R=K.inStudioSlots)?R:[],t)}else{let t=(null!=(G=K.inStudioSlots)?G:[]).filter(t=>t!==e.slot);await I(Z,null!=(j=null!=(M=K.onlineSlots)?M:K.slots)?j:[],K.freeConsultationSlots,t,null!=(H=K.studioSlots)?H:{})}if("confirmed"===e.status)try{let t=await v(e.email);if(t)await S({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"active",source:t.source||"website"});else{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione confermata del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"active",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await S(t)}}catch(e){console.error("Error creating/updating client from booking:",e)}try{if("confirmed"===e.status){let t=await (0,a.hX)(void 0,e,X);t&&(await (0,i.mZ)((0,i.H9)(l.db,"bookings",W.id),{googleCalendarEventId:t}),(0,n.f9)("Google Calendar event created and linked to booking:",t))}}catch(e){console.error("Error creating Google Calendar event:",e)}try{(0,n.f9)("\uD83D\uDCE7 Preparando invio email notifica...");let t={...e,id:W.id},o=await C(),i=(null==o?void 0:o.notificationEmail)||"mirkoditroia@gmail.com",a=(null==o?void 0:o.businessName)||"GZ Nutrition",l=(null==o?void 0:o.colorPalette)||"gz-default";(0,n.f9)("\uD83D\uDCEC Inviando email a:",i,"per",X),await s(t,X,i,a,l),(0,n.f9)("✅ Email al dottore inviata con successo!")}catch(e){console.error("❌ Errore invio email:",e)}return W.id}async function p(e){var t,o,r,s,d,u,g,f,m,p,b,C,y;if(!l.db)throw Error("Firestore not configured");if(!e.id)throw Error("Booking ID is required for update");let I=await (0,i.x7)((0,i.H9)(l.db,"bookings",e.id));if(!I.exists())throw Error("Prenotazione non trovata");let w=E(e.id,I.data());if(w.slot!==e.slot&&e.slot){let i=await h(e.date),a="online"===(e.isFreeConsultation?"online":e.location||"online")?null!=(o=null!=(t=null==i?void 0:i.onlineSlots)?t:null==i?void 0:i.slots)?o:[]:null!=(r=null==i?void 0:i.inStudioSlots)?r:[];if(!i||!a.includes(e.slot))throw Error("Il nuovo orario selezionato non \xe8 pi\xf9 disponibile")}if(w.date!==e.date&&e.slot){let t=await h(e.date),o="online"===(e.isFreeConsultation?"online":e.location||"online")?null!=(d=null!=(s=null==t?void 0:t.onlineSlots)?s:null==t?void 0:t.slots)?d:[]:null!=(u=null==t?void 0:t.inStudioSlots)?u:[];if(!t||!o.includes(e.slot))throw Error("L'orario selezionato non \xe8 disponibile per la nuova data")}let P=e.id,T={clientId:null!=(g=e.clientId)?g:null,name:e.name,email:e.email,phone:null!=(f=e.phone)?f:null,packageId:null!=(m=e.packageId)?m:null,date:e.date,slot:null!=(p=e.slot)?p:null,location:e.isFreeConsultation?"online":null!=(b=e.location)?b:null,studioLocation:null!=(C=e.studioLocation)?C:null,status:e.status,priority:!!e.priority,channelPreference:null!=(y=e.channelPreference)?y:null};if(await (0,i.BN)((0,i.H9)(l.db,"bookings",P),T,{merge:!0}),console.log("\uD83D\uDD27 GOOGLE CALENDAR SYNC - Existing Event ID:",w.googleCalendarEventId),console.log("\uD83D\uDD27 GOOGLE CALENDAR SYNC - Booking Status:",e.status),console.log("\uD83D\uDD27 GOOGLE CALENDAR SYNC - Previous Status:",w.status),w.googleCalendarEventId)try{let t;if(console.log("\uD83D\uDCC5 Updating existing Google Calendar event..."),e.packageId)try{let o=await (0,i.x7)((0,i.H9)(l.db,"packages",e.packageId));o.exists()&&(t=o.data().title)}catch(e){console.error("Error getting package title for calendar event update:",e)}let o="confirmed"===e.status?!!await (0,a.hX)(w.googleCalendarEventId,e,t):await (0,a.At)(w.googleCalendarEventId);console.log("\uD83D\uDCC5 Google Calendar sync result:",o),o?(0,n.f9)("confirmed"===e.status?"Google Calendar event updated:":"Google Calendar event deleted (booking not confirmed):",w.googleCalendarEventId):console.error("Failed to update Google Calendar event:",w.googleCalendarEventId)}catch(e){console.error("Error updating Google Calendar event:",e)}else{console.log("\uD83D\uDCC5 No existing Google Calendar event, checking if we should create one...");try{let t;if(e.packageId)try{let o=await (0,i.x7)((0,i.H9)(l.db,"packages",e.packageId));o.exists()&&(t=o.data().title)}catch(e){console.error("Error getting package title for calendar event create:",e)}if("confirmed"===e.status){console.log("\uD83D\uDCC5 Creating new Google Calendar event for confirmed booking...");let o=await (0,a.hX)(void 0,e,t);console.log("\uD83D\uDCC5 New event creation result:",o?"SUCCESS":"FAILED"),o&&(await (0,i.BN)((0,i.H9)(l.db,"bookings",e.id),{googleCalendarEventId:o},{merge:!0}),(0,n.f9)("Google Calendar event created for existing booking:",o))}else console.log("\uD83D\uDCC5 Booking not confirmed, skipping calendar event creation")}catch(e){console.error("Error creating Google Calendar event on update:",e)}}if("confirmed"===e.status)try{let t=await v(e.email);if(t)await S({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"active",source:t.source||"website"});else{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione confermata del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"active",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await S(t)}}catch(e){console.error("Error creating/updating client from booking:",e)}if("confirmed"===e.status&&e.slot&&e.date)try{let t=e.date.split("T")[0],o=c.availability(l.db,t),a=await (0,i.x7)(o);if(a.exists()){let n=a.data(),l=e.isFreeConsultation?"online":e.location||"online";if("online"===l){let a=n.onlineSlots||n.slots||[];if(a.includes(e.slot)){let n=a.filter(t=>t!==e.slot);await (0,i.BN)(o,{date:t,onlineSlots:n},{merge:!0})}else console.warn("Slot ".concat(e.slot," non pi\xf9 disponibile (online) per la data ").concat(t))}else{let a=n.inStudioSlots||[];if(a.includes(e.slot)){let n=a.filter(t=>t!==e.slot);await (0,i.BN)(o,{date:t,inStudioSlots:n},{merge:!0})}else console.warn("Slot ".concat(e.slot," non pi\xf9 disponibile (studio) per la data ").concat(t))}}if(w.slot&&w.slot!==e.slot){let e=w.date.split("T")[0],t=c.availability(l.db,e),o=await (0,i.x7)(t);if(o.exists()){let a=o.data(),n=w.isFreeConsultation?"online":w.location||"online";if("online"===n){let o=a.onlineSlots||a.slots||[];if(!o.includes(w.slot)){let a=[...o,w.slot];await (0,i.BN)(t,{date:e,onlineSlots:a},{merge:!0})}}else{let o=a.inStudioSlots||[];if(!o.includes(w.slot)){let a=[...o,w.slot];await (0,i.BN)(t,{date:e,inStudioSlots:a},{merge:!0})}}}}if(w.date!==e.date&&w.slot){let e=w.date.split("T")[0],t=c.availability(l.db,e),o=await (0,i.x7)(t);if(o.exists()){let a=o.data(),n=w.isFreeConsultation?"online":w.location||"online";if("online"===n){let o=a.onlineSlots||a.slots||[];if(!o.includes(w.slot)){let a=[...o,w.slot];await (0,i.BN)(t,{date:e,onlineSlots:a},{merge:!0})}}else{let o=a.inStudioSlots||[];if(!o.includes(w.slot)){let a=[...o,w.slot];await (0,i.BN)(t,{date:e,inStudioSlots:a},{merge:!0})}}}}}catch(e){console.error("Error updating availability in Firebase:",e)}}async function b(e){if(!l.db)throw Error("Firestore not configured");let t=null;try{let o=await (0,i.x7)((0,i.H9)(l.db,"bookings",e));if(o.exists()){if((t=E(e,o.data())).googleCalendarEventId)try{await (0,a.At)(t.googleCalendarEventId)?(0,n.f9)("Google Calendar event deleted:",t.googleCalendarEventId):console.error("Failed to delete Google Calendar event:",t.googleCalendarEventId)}catch(e){console.error("Error deleting Google Calendar event:",e)}let i=await v(t.email);if(i)await S({...i,status:"inactive",notes:i.notes?"".concat(i.notes,"\n\nPrenotazione rifiutata il ").concat(new Date().toLocaleDateString("it-IT")):"Prenotazione rifiutata il ".concat(new Date().toLocaleDateString("it-IT"))});else{let e={name:t.name,email:t.email,phone:t.phone,notes:"Cliente creato automaticamente dalla prenotazione rifiutata del ".concat(new Date(t.date).toLocaleDateString("it-IT")),status:"inactive",source:"website",assignedPackage:t.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};await S(e)}}}catch(e){console.error("Error creating client from rejected booking:",e)}if(await (0,i.kd)((0,i.H9)(l.db,"bookings",e)),t&&"confirmed"===t.status&&t.slot&&t.date)try{let e=t.date.split("T")[0],o=c.availability(l.db,e),a=await (0,i.x7)(o);if(a.exists()){let n=a.data(),l=t.isFreeConsultation?"online":t.location||"online";if("online"===l){let a=n.onlineSlots||n.slots||[];if(!a.includes(t.slot)){let n=[...a,t.slot].sort();await (0,i.BN)(o,{date:e,onlineSlots:n},{merge:!0})}}else if(t.studioLocation){let a=n.studioSlots||{},l=a[t.studioLocation]||[];l.includes(t.slot)||(a[t.studioLocation]=[...l,t.slot].sort(),await (0,i.BN)(o,{date:e,studioSlots:a},{merge:!0}))}else{let a=n.inStudioSlots||[];if(!a.includes(t.slot)){let n=[...a,t.slot].sort();await (0,i.BN)(o,{date:e,inStudioSlots:n},{merge:!0})}}}}catch(e){console.error("Error restoring availability after booking deletion in Firebase:",e)}}async function S(e){var t,o,a,n,r,s,d,u,g,f,m,p,b,S,v,C,y,h,I;if(!l.db)throw Error("Firestore not configured");if(e.id){let{id:t,...o}=e,a={};return Object.entries(o).forEach(e=>{let[t,o]=e;void 0!==o&&(a[t]=o)}),await (0,i.BN)((0,i.H9)(l.db,"clients",t),a,{merge:!0}),t}return(await (0,i.gS)(c.clients(l.db),{name:e.name,email:e.email,phone:null!=(t=e.phone)?t:null,notes:null!=(o=e.notes)?o:null,birthDate:null!=(a=e.birthDate)?a:null,gender:null!=(n=e.gender)?n:null,address:null!=(r=e.address)?r:null,city:null!=(s=e.city)?s:null,postalCode:null!=(d=e.postalCode)?d:null,emergencyContact:null!=(u=e.emergencyContact)?u:null,height:null!=(g=e.height)?g:null,weight:null!=(f=e.weight)?f:null,fitnessLevel:null!=(m=e.fitnessLevel)?m:null,goals:null!=(p=e.goals)?p:[],medicalConditions:null!=(b=e.medicalConditions)?b:[],allergies:null!=(S=e.allergies)?S:[],medications:null!=(v=e.medications)?v:[],source:null!=(C=e.source)?C:null,status:null!=(y=e.status)?y:"prospect",assignedPackage:null!=(h=e.assignedPackage)?h:null,documents:null!=(I=e.documents)?I:[],createdAt:(0,i.O5)()})).id}async function v(e){var t,o;if(!l.db)return null;let a=(0,i.P)((0,i.rJ)(l.db,"clients"),(0,i._M)("email","==",e)),n=await (0,i.GG)(a);if(n.empty)return null;let r=n.docs[0],s=r.data();return{id:r.id,name:s.name,email:s.email,phone:null!=(t=s.phone)?t:void 0,notes:null!=(o=s.notes)?o:void 0,createdAt:w(s.createdAt)}}async function C(){if((0,n.f9)("getSiteContent: Inizio funzione"),(0,n.f9)("getSiteContent: Database configurato:",!!l.db),(0,n.f9)("getSiteContent: Tipo database:",typeof l.db),!l.db)return(0,n.f9)("getSiteContent: Database non configurato, return null"),null;try{var e,t,o,a,s,d,u,g,f,m,p,b,S,v,C,h,I,w,E,P,T,k,A,N,B,D,L,z,_,F,O,U,x,R;let G;(0,n.f9)("getSiteContent: Caricamento contenuto da Firebase...");let M=await (0,i.x7)(c.content(l.db));if((0,n.f9)("getSiteContent: Snap ricevuto:",M),(0,n.f9)("getSiteContent: Snap exists:",M.exists()),!M.exists()){(0,n.f9)("getSiteContent: Nessun contenuto trovato in Firebase, creo contenuto di default");let e={heroTitle:"Trasforma il tuo fisico. Potenzia la tua performance.",heroSubtitle:"Coaching nutrizionale e training su misura per giovani adulti 20–35.",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",sectionVisibility:{hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},aboutTitle:"Chi Sono",aboutBody:"Sono Gabriele Zambonin, nutrizionista e personal trainer. Ti guido con un metodo scientifico e pratico per raggiungere forma fisica, energia e benessere reale.",aboutImageUrl:"",images:[],contactTitle:"\uD83D\uDCDE Contattami",contactSubtitle:"Siamo qui per aiutarti nel tuo percorso verso una vita pi\xf9 sana. Contattaci per qualsiasi domanda o per prenotare una consulenza.",contactPhone:"+39 123 456 7890",contactEmail:"info@gznutrition.it",contactAddresses:[{name:"Studio Principale",address:"Via Roma 123",city:"Milano",postalCode:"20100",coordinates:{lat:45.4642,lng:9.19}}],socialChannels:[{platform:"Instagram",url:"https://instagram.com/gznutrition",icon:"\uD83D\uDCF8"},{platform:"LinkedIn",url:"https://linkedin.com/in/gznutrition",icon:"\uD83D\uDCBC"}],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"Siamo qui per aiutarti",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"Trova lo studio pi\xf9 vicino a te",freeConsultationPopup:{isEnabled:!0,title:"\uD83C\uDFAF 10 Minuti Consultivi Gratuiti",subtitle:"Valuta i tuoi obiettivi gratuitamente",description:"Prenota il tuo primo incontro conoscitivo gratuito per valutare i tuoi obiettivi di benessere e performance.",ctaText:"Prenota Ora - \xc8 Gratis!",packageUrl:"free-consultation"},colorPalette:"gz-default",favicon:void 0,debugLogsEnabled:!0,notificationEmail:"mirkoditroia@gmail.com",businessName:"GZ Nutrition",recaptchaEnabled:!1,recaptchaSiteKey:r.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY||"6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI",resultsSection:{isEnabled:!1,title:"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:[]},metaTags:{title:"",description:"",siteUrl:"",image:"",siteName:"GZnutrition",twitterCard:"summary_large_image",ogType:"website",locale:"it_IT"}};try{return await y(e),(0,n.f9)("getSiteContent: Contenuto di default salvato in Firebase"),e}catch(t){return console.error("getSiteContent: Errore nel salvare contenuto di default:",t),e}}let j=M.data();(0,n.f9)("getSiteContent: Contenuto caricato da Firebase:",j),(0,n.f9)("getSiteContent: Contatti - phone:",j.contactPhone),(0,n.f9)("getSiteContent: Contatti - email:",j.contactEmail),(0,n.f9)("getSiteContent: Contatti - addresses:",j.contactAddresses),(0,n.f9)("getSiteContent: Contatti - social:",j.socialChannels),(0,n.f9)("getSiteContent: Popup - freeConsultationPopup:",j.freeConsultationPopup),(0,n.f9)("getSiteContent: Popup - isEnabled:",null==(e=j.freeConsultationPopup)?void 0:e.isEnabled),(0,n.f9)("getSiteContent: Popup - title:",null==(t=j.freeConsultationPopup)?void 0:t.title);let H={heroTitle:j.heroTitle||"Trasforma il tuo fisico. Potenzia la tua performance.",heroSubtitle:j.heroSubtitle||"Coaching nutrizionale e training su misura per giovani adulti 20–35.",heroCta:j.heroCta||"Prenota ora",heroBackgroundImage:j.heroBackgroundImage||"",heroBadgeText:j.heroBadgeText||"Performance • Estetica • Energia",heroBadgeColor:j.heroBadgeColor||"bg-primary text-primary-foreground",sectionVisibility:j.sectionVisibility?{hero:!1!==j.sectionVisibility.hero,about:!1!==j.sectionVisibility.about,images:!1!==j.sectionVisibility.images,packages:!1!==j.sectionVisibility.packages,bookingForm:!1!==j.sectionVisibility.bookingForm,contact:!1!==j.sectionVisibility.contact}:{hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},navbarLogoMode:(G=j.navbarLogoMode,"image"===G||"text"===G?G:void 0),navbarLogoImageUrl:j.navbarLogoImageUrl||void 0,navbarLogoHeight:"number"==typeof j.navbarLogoHeight?j.navbarLogoHeight:void 0,navbarLogoAutoRemoveBg:!!j.navbarLogoAutoRemoveBg,navbarLogoText:j.navbarLogoText||void 0,navbarLogoTextColor:j.navbarLogoTextColor||void 0,navbarLogoTextWeight:"number"==typeof j.navbarLogoTextWeight?j.navbarLogoTextWeight:void 0,navbarLogoTextSize:"number"==typeof j.navbarLogoTextSize?j.navbarLogoTextSize:void 0,aboutTitle:j.aboutTitle||"Chi Sono",aboutBody:j.aboutBody||"Sono Gabriele Zambonin, nutrizionista e personal trainer. Ti guido con un metodo scientifico e pratico per raggiungere forma fisica, energia e benessere reale.",aboutImageUrl:j.aboutImageUrl||"",images:Array.isArray(j.images)?j.images:[],contactTitle:j.contactTitle||"\uD83D\uDCDE Contattami",contactSubtitle:j.contactSubtitle||"Siamo qui per aiutarti nel tuo percorso verso una vita pi\xf9 sana. Contattaci per qualsiasi domanda o per prenotare una consulenza.",contactPhone:j.contactPhone||"+39 123 456 7890",contactEmail:j.contactEmail||"info@gznutrition.it",contactAddresses:Array.isArray(j.contactAddresses)&&j.contactAddresses.length>0?j.contactAddresses:[{name:"Studio Principale",address:"Via Roma 123",city:"Milano",postalCode:"20100",coordinates:{lat:45.4642,lng:9.19}}],socialChannels:Array.isArray(j.socialChannels)&&j.socialChannels.length>0?j.socialChannels:[{platform:"Instagram",url:"https://instagram.com/gznutrition",icon:"\uD83D\uDCF8"},{platform:"LinkedIn",url:"https://linkedin.com/in/gznutrition",icon:"\uD83D\uDCBC"}],contactSectionTitle:j.contactSectionTitle||"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:j.contactSectionSubtitle||"Siamo qui per aiutarti",studiosSectionTitle:j.studiosSectionTitle||"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:j.studiosSectionSubtitle||"Trova lo studio pi\xf9 vicino a te",freeConsultationPopup:{isEnabled:(null==(o=j.freeConsultationPopup)?void 0:o.isEnabled)===!0||(null==(a=j.freeConsultationPopup)?void 0:a.isEnabled)==="true"||"true"===String(null==(s=j.freeConsultationPopup)?void 0:s.isEnabled),title:(null==(d=j.freeConsultationPopup)?void 0:d.title)||"\uD83C\uDFAF 10 Minuti Consultivi Gratuiti",subtitle:(null==(u=j.freeConsultationPopup)?void 0:u.subtitle)||"Valuta i tuoi obiettivi gratuitamente",description:(null==(g=j.freeConsultationPopup)?void 0:g.description)||"Prenota il tuo primo incontro conoscitivo gratuito per valutare i tuoi obiettivi di benessere e performance.",ctaText:(null==(f=j.freeConsultationPopup)?void 0:f.ctaText)||"Prenota Ora - \xc8 Gratis!",packageUrl:(null==(m=j.freeConsultationPopup)?void 0:m.packageUrl)||"free-consultation"},googleCalendar:(()=>{var e,t,o,i;let a={isEnabled:(null==(e=j.googleCalendar)?void 0:e.isEnabled)||!1,calendarId:"9765caa0fca592efb3eac96010b3f8f770050fad09fe7b379f16aacdc89fa689@group.calendar.google.com",timezone:(null==(t=j.googleCalendar)?void 0:t.timezone)||"Europe/Rome",serviceAccountEmail:(null==(o=j.googleCalendar)?void 0:o.serviceAccountEmail)||"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"};return console.log("\uD83D\uDD0D [CALENDAR CONFIG] ID utilizzato:",a.calendarId),console.log("\uD83D\uDD0D [CALENDAR CONFIG] Da database:",null==(i=j.googleCalendar)?void 0:i.calendarId),a})(),colorPalette:j.colorPalette||"gz-default",favicon:j.favicon||void 0,metaTags:j.metaTags?{title:j.metaTags.title||"",description:j.metaTags.description||"",siteUrl:j.metaTags.siteUrl||"",image:j.metaTags.image||"",siteName:j.metaTags.siteName||"GZnutrition",twitterCard:j.metaTags.twitterCard||"summary_large_image",ogType:j.metaTags.ogType||"website",locale:j.metaTags.locale||"it_IT"}:{title:"",description:"",siteUrl:"",image:"",siteName:"GZnutrition",twitterCard:"summary_large_image",ogType:"website",locale:"it_IT"},debugLogsEnabled:!1!==j.debugLogsEnabled,notificationEmail:j.notificationEmail||"mirkoditroia@gmail.com",businessName:j.businessName||"GZ Nutrition",recaptchaEnabled:!0===j.recaptchaEnabled,recaptchaSiteKey:j.recaptchaSiteKey||r.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY||"6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI",resultsSection:j.resultsSection?{isEnabled:!0===j.resultsSection.isEnabled,title:j.resultsSection.title||"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:j.resultsSection.subtitle||"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:Array.isArray(j.resultsSection.photos)?j.resultsSection.photos:[]}:{isEnabled:!1,title:"\uD83C\uDFAF Risultati dei Nostri Clienti",subtitle:"Trasformazioni reali di persone reali. Questi sono alcuni dei successi raggiunti insieme.",photos:[]},bmiCalculator:j.bmiCalculator&&"object"==typeof j.bmiCalculator?{enabled:!0===j.bmiCalculator.enabled,title:j.bmiCalculator.title||"\uD83D\uDCCA Calcola il tuo BMI",subtitle:j.bmiCalculator.subtitle||"Scopri il tuo Indice di Massa Corporea"}:void 0,googleReviews:j.googleReviews&&"object"==typeof j.googleReviews?{enabled:!1!==j.googleReviews.enabled,title:j.googleReviews.title||"⭐ Recensioni Google",subtitle:j.googleReviews.subtitle||"Cosa dicono i nostri clienti",businessName:j.googleReviews.businessName||"GZ Nutrition",placeId:j.googleReviews.placeId||void 0,fallbackReviews:Array.isArray(j.googleReviews.fallbackReviews)?j.googleReviews.fallbackReviews.map(e=>({...e,source:e.source||"fallback"})):[]}:void 0,legalInfo:j.legalInfo?{companyName:j.legalInfo.companyName||"",vatNumber:j.legalInfo.vatNumber||"",taxCode:j.legalInfo.taxCode||"",email:j.legalInfo.email||"",registeredAddress:j.legalInfo.registeredAddress||"",footerText:j.legalInfo.footerText||"",showLegalLinks:!1!==j.legalInfo.showLegalLinks,gdprConsentText:j.legalInfo.gdprConsentText||"",cookieBanner:{enabled:(null==(p=j.legalInfo.cookieBanner)?void 0:p.enabled)!==!1,title:(null==(b=j.legalInfo.cookieBanner)?void 0:b.title)||"\uD83C\uDF6A Utilizzo dei Cookie",message:(null==(S=j.legalInfo.cookieBanner)?void 0:S.message)||"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:(null==(v=j.legalInfo.cookieBanner)?void 0:v.acceptText)||"Accetta",declineText:(null==(C=j.legalInfo.cookieBanner)?void 0:C.declineText)||"Rifiuta",learnMoreText:(null==(h=j.legalInfo.cookieBanner)?void 0:h.learnMoreText)||"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:(null==(w=j.legalInfo.legalPages)||null==(I=w.privacyPolicy)?void 0:I.title)||"Privacy Policy",lastUpdated:(null==(P=j.legalInfo.legalPages)||null==(E=P.privacyPolicy)?void 0:E.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(k=j.legalInfo.legalPages)||null==(T=k.privacyPolicy)?void 0:T.content)||""},cookiePolicy:{title:(null==(N=j.legalInfo.legalPages)||null==(A=N.cookiePolicy)?void 0:A.title)||"Cookie Policy",lastUpdated:(null==(D=j.legalInfo.legalPages)||null==(B=D.cookiePolicy)?void 0:B.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(z=j.legalInfo.legalPages)||null==(L=z.cookiePolicy)?void 0:L.content)||""},termsOfService:{title:(null==(F=j.legalInfo.legalPages)||null==(_=F.termsOfService)?void 0:_.title)||"Termini di Servizio",lastUpdated:(null==(U=j.legalInfo.legalPages)||null==(O=U.termsOfService)?void 0:O.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(R=j.legalInfo.legalPages)||null==(x=R.termsOfService)?void 0:x.content)||""}}}:{companyName:"",vatNumber:"",taxCode:"",email:"",registeredAddress:"",footerText:"",showLegalLinks:!0,gdprConsentText:"",cookieBanner:{enabled:!0,title:"\uD83C\uDF6A Utilizzo dei Cookie",message:"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:"Accetta",declineText:"Rifiuta",learnMoreText:"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:"Privacy Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},cookiePolicy:{title:"Cookie Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},termsOfService:{title:"Termini di Servizio",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""}}}};return(0,n.f9)("getSiteContent: Contenuto finale mappato:",H),(0,n.f9)("\uD83D\uDD0D getSiteContent: BMI raw da DB:",j.bmiCalculator),(0,n.f9)("\uD83D\uDD0D getSiteContent: BMI mappato finale:",H.bmiCalculator),(0,n.f9)("\uD83D\uDD0D getSiteContent: Reviews raw da DB:",j.googleReviews),(0,n.f9)("\uD83D\uDD0D getSiteContent: Reviews mappate finale:",H.googleReviews),(0,n.f9)("\uD83D\uDD0D getSiteContent: LegalInfo raw da DB:",j.legalInfo),(0,n.f9)("\uD83D\uDD0D getSiteContent: LegalInfo mappato finale:",H.legalInfo),(0,n.f9)("\uD83C\uDFAF getSiteContent: FAVICON raw da DB:",j.favicon),(0,n.f9)("\uD83C\uDFAF getSiteContent: FAVICON mappato finale:",H.favicon),(0,n.f9)("\uD83D\uDD17 getSiteContent: META TAGS raw da DB:",j.metaTags),(0,n.f9)("\uD83D\uDD17 getSiteContent: META TAGS mappati finale:",H.metaTags),H}catch(e){return console.error("getSiteContent: Errore nel caricamento da Firebase:",e),null}}async function y(e){if(!l.db)throw Error("Firestore not configured");(0,n.f9)("\uD83D\uDD25 [Firebase] upsertSiteContent chiamato"),(0,n.f9)("\uD83D\uDD25 [Firebase] Content originale:",e),(0,n.f9)("\uD83D\uDD25 [Firebase] BMI config:",e.bmiCalculator),(0,n.f9)("\uD83D\uDD25 [Firebase] Reviews config:",e.googleReviews),(0,n.f9)("\uD83D\uDD25 [Firebase] LegalInfo config:",e.legalInfo),(0,n.f9)("\uD83C\uDFAF [Firebase] FAVICON config:",e.favicon||"NESSUN FAVICON");let t=JSON.parse(JSON.stringify(e));if(t.sectionVisibility?t.sectionVisibility={hero:!1!==t.sectionVisibility.hero,about:!1!==t.sectionVisibility.about,images:!1!==t.sectionVisibility.images,packages:!1!==t.sectionVisibility.packages,bookingForm:!1!==t.sectionVisibility.bookingForm,contact:!1!==t.sectionVisibility.contact}:t.sectionVisibility={hero:!0,about:!0,images:!0,packages:!0,bookingForm:!0,contact:!0},t.legalInfo){var o,a,r,s,d,u,g,f,m,p,b,S,v,C,y,h,I,w,E,P,T,k,A,N;t.legalInfo={companyName:t.legalInfo.companyName||"",vatNumber:t.legalInfo.vatNumber||"",taxCode:t.legalInfo.taxCode||"",email:t.legalInfo.email||"",registeredAddress:t.legalInfo.registeredAddress||"",footerText:t.legalInfo.footerText||"",showLegalLinks:!1!==t.legalInfo.showLegalLinks,gdprConsentText:t.legalInfo.gdprConsentText||"",cookieBanner:{enabled:(null==(o=t.legalInfo.cookieBanner)?void 0:o.enabled)!==!1,title:(null==(a=t.legalInfo.cookieBanner)?void 0:a.title)||"\uD83C\uDF6A Utilizzo dei Cookie",message:(null==(r=t.legalInfo.cookieBanner)?void 0:r.message)||"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:(null==(s=t.legalInfo.cookieBanner)?void 0:s.acceptText)||"Accetta",declineText:(null==(d=t.legalInfo.cookieBanner)?void 0:d.declineText)||"Rifiuta",learnMoreText:(null==(u=t.legalInfo.cookieBanner)?void 0:u.learnMoreText)||"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:(null==(f=t.legalInfo.legalPages)||null==(g=f.privacyPolicy)?void 0:g.title)||"Privacy Policy",lastUpdated:(null==(p=t.legalInfo.legalPages)||null==(m=p.privacyPolicy)?void 0:m.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(S=t.legalInfo.legalPages)||null==(b=S.privacyPolicy)?void 0:b.content)||""},cookiePolicy:{title:(null==(C=t.legalInfo.legalPages)||null==(v=C.cookiePolicy)?void 0:v.title)||"Cookie Policy",lastUpdated:(null==(h=t.legalInfo.legalPages)||null==(y=h.cookiePolicy)?void 0:y.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(w=t.legalInfo.legalPages)||null==(I=w.cookiePolicy)?void 0:I.content)||""},termsOfService:{title:(null==(P=t.legalInfo.legalPages)||null==(E=P.termsOfService)?void 0:E.title)||"Termini di Servizio",lastUpdated:(null==(k=t.legalInfo.legalPages)||null==(T=k.termsOfService)?void 0:T.lastUpdated)||new Date().toLocaleDateString("it-IT"),content:(null==(N=t.legalInfo.legalPages)||null==(A=N.termsOfService)?void 0:A.content)||""}}}}else t.legalInfo={companyName:"",vatNumber:"",taxCode:"",email:"",registeredAddress:"",footerText:"",showLegalLinks:!0,gdprConsentText:"",cookieBanner:{enabled:!0,title:"\uD83C\uDF6A Utilizzo dei Cookie",message:"Utilizziamo i cookie per migliorare la tua esperienza di navigazione e per fornire funzionalit\xe0 personalizzate. Continuando a navigare accetti l'utilizzo dei cookie.",acceptText:"Accetta",declineText:"Rifiuta",learnMoreText:"Scopri di pi\xf9"},legalPages:{privacyPolicy:{title:"Privacy Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},cookiePolicy:{title:"Cookie Policy",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""},termsOfService:{title:"Termini di Servizio",lastUpdated:new Date().toLocaleDateString("it-IT"),content:""}}};t.metaTags?t.metaTags={title:t.metaTags.title||"",description:t.metaTags.description||"",siteUrl:t.metaTags.siteUrl||"",image:t.metaTags.image||"",siteName:t.metaTags.siteName||"GZnutrition",twitterCard:t.metaTags.twitterCard||"summary_large_image",ogType:t.metaTags.ogType||"website",locale:t.metaTags.locale||"it_IT"}:t.metaTags={title:"",description:"",siteUrl:"",image:"",siteName:"GZnutrition",twitterCard:"summary_large_image",ogType:"website",locale:"it_IT"},(0,n.f9)("\uD83D\uDD25 [Firebase] Content sanitizzato:",t),(0,n.f9)("\uD83D\uDD25 [Firebase] BMI sanitizzato:",t.bmiCalculator),(0,n.f9)("\uD83D\uDD25 [Firebase] Reviews sanitizzato:",t.googleReviews),(0,n.f9)("\uD83D\uDD25 [Firebase] LegalInfo sanitizzato:",t.legalInfo),(0,n.f9)("\uD83D\uDD25 [Firebase] \uD83D\uDD17 META TAGS sanitizzato:",t.metaTags),(0,n.f9)("\uD83D\uDD25 [Firebase] Chiamando setDoc..."),await (0,i.BN)(c.content(l.db),t,{merge:!0}),(0,n.f9)("\uD83D\uDD25 [Firebase] ✅ setDoc completato con successo")}async function h(e){if(!l.db)return null;(0,n.f9)("\uD83D\uDD0D getAvailabilityByDate Firebase per data:",e);let t=await (0,i.x7)(c.availability(l.db,e));if(!t.exists())return(0,n.f9)("❌ Nessun documento availability trovato per data:",e),null;let o=t.data();(0,n.f9)("\uD83D\uDCCA Dati raw da Firebase per",e,":",o);let a={date:e,onlineSlots:Array.isArray(o.onlineSlots)?o.onlineSlots:Array.isArray(o.slots)?o.slots:[],inStudioSlots:Array.isArray(o.inStudioSlots)?o.inStudioSlots:[],studioSlots:o.studioSlots&&"object"==typeof o.studioSlots?o.studioSlots:{},slots:Array.isArray(o.slots)?o.slots:void 0,freeConsultationSlots:Array.isArray(o.freeConsultationSlots)?o.freeConsultationSlots:[],legacyFreeConsultationSlots:Array.isArray(o.legacyFreeConsultationSlots)?o.legacyFreeConsultationSlots:void 0};return(0,n.f9)("✅ Availability processata:",a),(0,n.f9)("\uD83C\uDFAF freeConsultationSlots trovati:",a.freeConsultationSlots),a}async function I(e,t,o,a,n){if(!l.db)throw Error("Firestore not configured");let r={date:e,onlineSlots:t};Array.isArray(o)&&(r.freeConsultationSlots=o),Array.isArray(a)&&(r.inStudioSlots=a),n&&"object"==typeof n&&(r.studioSlots=n),await (0,i.BN)(c.availability(l.db,e),r,{merge:!0})}function w(e){if(e)try{return e.toDate().toISOString()}catch(e){return}}function E(e,t){var o,i,a,n,l,r,s,c,d,u;return{id:e,clientId:null!=(o=t.clientId)?o:void 0,name:t.name,email:t.email,phone:null!=(i=t.phone)?i:void 0,packageId:null!=(a=t.packageId)?a:void 0,date:t.date,slot:null!=(n=t.slot)?n:void 0,location:null!=(l=t.location)?l:void 0,studioLocation:null!=(r=t.studioLocation)?r:void 0,status:t.status,priority:!!t.priority,channelPreference:null!=(s=t.channelPreference)?s:void 0,isFreeConsultation:!!t.isFreeConsultation,consultationDuration:null!=(c=t.consultationDuration)?c:void 0,notes:null!=(d=t.notes)?d:void 0,createdAt:w(t.createdAt),googleCalendarEventId:null!=(u=t.googleCalendarEventId)?u:void 0}}function P(e,t){var o,i,a,n,l,r,s,c,d,u,g,f,m,p;return{id:e,name:t.name,email:t.email,phone:null!=(o=t.phone)?o:void 0,notes:null!=(i=t.notes)?i:void 0,birthDate:null!=(a=t.birthDate)?a:void 0,gender:null!=(n=t.gender)?n:void 0,address:null!=(l=t.address)?l:void 0,city:null!=(r=t.city)?r:void 0,postalCode:null!=(s=t.postalCode)?s:void 0,emergencyContact:null!=(c=t.emergencyContact)?c:void 0,height:null!=(d=t.height)?d:void 0,weight:null!=(u=t.weight)?u:void 0,fitnessLevel:null!=(g=t.fitnessLevel)?g:void 0,goals:Array.isArray(t.goals)?t.goals:[],medicalConditions:Array.isArray(t.medicalConditions)?t.medicalConditions:[],allergies:Array.isArray(t.allergies)?t.allergies:[],medications:Array.isArray(t.medications)?t.medications:[],source:null!=(f=t.source)?f:void 0,status:null!=(m=t.status)?m:"prospect",assignedPackage:null!=(p=t.assignedPackage)?p:void 0,documents:Array.isArray(t.documents)?t.documents:[],createdAt:w(t.createdAt)}}async function T(){return l.db?(await (0,i.GG)((0,i.P)(c.clients(l.db),(0,i.My)("createdAt","desc")))).docs.map(e=>P(e.id,e.data())):[]}async function k(e){if(!l.db)return null;let t=l.db,o=await (0,i.x7)((0,i.H9)(t,"clients",e));return o.exists()?P(o.id,o.data()):null}async function A(e){if(!l.db)throw Error("Firestore not configured");await (0,i.kd)((0,i.H9)(l.db,"clients",e))}async function N(e){if(!l.db)throw Error("Firestore not configured");let t={...e,createdAt:(0,i.O5)()};return(await (0,i.gS)((0,i.rJ)(l.db,"clientProgress"),t)).id}async function B(e){if(!l.db)return[];try{let t=(0,i.P)((0,i.rJ)(l.db,"clientProgress"),(0,i._M)("clientId","==",e),(0,i.My)("date","desc"));return(await (0,i.GG)(t)).docs.map(e=>{var t,o,i;let a=e.data();return{id:e.id,clientId:a.clientId,date:a.date,weight:a.weight,bodyFat:a.bodyFat,muscleMass:a.muscleMass,measurements:a.measurements,notes:a.notes,photos:a.photos,createdAt:(null==(i=a.createdAt)||null==(o=i.toDate)||null==(t=o.call(i))?void 0:t.toISOString())||new Date().toISOString()}})}catch(o){(0,n.f9)("Indice non ancora pronto, uso query senza ordinamento");let t=(0,i.P)((0,i.rJ)(l.db,"clientProgress"),(0,i._M)("clientId","==",e));return(await (0,i.GG)(t)).docs.map(e=>{var t,o,i;let a=e.data();return{id:e.id,clientId:a.clientId,date:a.date,weight:a.weight,bodyFat:a.bodyFat,muscleMass:a.muscleMass,measurements:a.measurements,notes:a.notes,photos:a.photos,createdAt:(null==(i=a.createdAt)||null==(o=i.toDate)||null==(t=o.call(i))?void 0:t.toISOString())||new Date().toISOString()}}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())}}async function D(e,t){if(!l.db)throw Error("Firestore not configured");let{id:o,createdAt:a,...n}=t;await (0,i.mZ)((0,i.H9)(l.db,"clientProgress",e),n)}async function L(e){if(!l.db)throw Error("Firestore not configured");await (0,i.kd)((0,i.H9)(l.db,"clientProgress",e))}async function z(e){if(!l.db)throw Error("Firestore not configured");let t=await v(e.email);if(t)return await S({...t,name:e.name,phone:e.phone||t.phone,assignedPackage:e.packageId||t.assignedPackage,status:"prospect",source:t.source||"website"}),t.id;{let t={name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione in attesa del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"prospect",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()};return await S(t)}}},5197:(e,t,o)=>{async function i(e,t){console.log("\uD83D\uDD27 createCalendarEvent called for booking:",e.name,"Status:",e.status);try{let o=await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",booking:e,packageTitle:t})});if(console.log("\uD83D\uDD27 createCalendarEvent API response status:",o.status),!o.ok){let e=await o.text();throw console.error("\uD83D\uDD27 createCalendarEvent API error:",e),Error("HTTP error! status: ".concat(o.status))}let i=await o.json();if(console.log("\uD83D\uDD27 createCalendarEvent API result:",i),i.success)return console.log("Google Calendar event created:",i.eventId),i.eventId;return console.error("Failed to create calendar event:",i.message),null}catch(e){return console.error("Error creating Google Calendar event:",e),null}}async function a(e,t,o){try{let i=await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update",eventId:e,booking:t,packageTitle:o})});if(!i.ok)return!1;let a=await i.json();if(a.success)return console.log("Google Calendar event updated:",e),!0;return console.error("Failed to update calendar event:",a.message),!1}catch(e){return console.error("Error updating Google Calendar event:",e),!1}}async function n(e,t,o){return(console.log("\uD83D\uDD27 ensureCalendarEvent called - existingEventId:",e,"booking:",t.name),e)?(console.log("\uD83D\uDD27 ensureCalendarEvent - updating existing event:",e),await a(e,t,o))?(console.log("\uD83D\uDD27 ensureCalendarEvent - update successful"),e):(console.log("\uD83D\uDD27 ensureCalendarEvent - update failed, creating new event"),await i(t,o)):(console.log("\uD83D\uDD27 ensureCalendarEvent - no existing event, creating new one"),await i(t,o))}async function l(e){try{let t=await fetch("/api/calendar",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:e})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let o=await t.json();if(o.success)return console.log("Google Calendar event deleted:",e),!0;return console.error("Failed to delete calendar event:",o.message),!1}catch(e){return console.error("Error deleting Google Calendar event:",e),!1}}async function r(){try{let e=await fetch("/api/calendar",{method:"GET"});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){return console.error("Google Calendar connection test failed:",e),{success:!1,message:e instanceof Error?e.message:"Connection test failed"}}}o.d(t,{At:()=>l,Zl:()=>r,hX:()=>n}),o(5704)},9018:(e,t,o)=>{o.r(t),o.d(t,{createBooking:()=>f,createClientFromPendingBooking:()=>h,deleteBooking:()=>p,deleteClient:()=>y,deleteClientProgress:()=>B,deletePackage:()=>u,getAvailabilityByDate:()=>E,getClientByEmail:()=>S,getClientById:()=>C,getClientProgress:()=>A,getDataMode:()=>n,getPackages:()=>c,getSiteContent:()=>I,listBookings:()=>g,listClients:()=>v,saveClientProgress:()=>k,updateBooking:()=>m,updateClientProgress:()=>N,upsertAvailabilityForDate:()=>P,upsertClient:()=>b,upsertPackage:()=>d,upsertSiteContent:()=>w});var i=o(4368),a=o(5704);function n(){let e=a.env.NEXT_PUBLIC_DATA_MODE;if("local"===e||"demo"===e||"firebase"===e)return console.log("[DataMode] Override detected:",e),e;let t="AIzaSyAp1IXe0d2yE-BSrZLGKHfDkdkm1NuSwfs";return(console.log("[DataMode] Production mode, Firebase configured:",t),t)?(console.log("[DataMode] Using firebase mode"),"firebase"):(console.log("[DataMode] Using demo mode"),"demo")}var l=o(576);async function r(e){try{let t,o=await I(),i=(null==o?void 0:o.notificationEmail)||"mirkoditroia@gmail.com",a=(null==o?void 0:o.businessName)||"GZ Nutrition",n=(null==o?void 0:o.colorPalette)||"gz-default";if(e.packageId)try{let o=(await c()).find(t=>t.id===e.packageId);o&&(t=o.title)}catch(e){console.error("Error getting package title for calendar event:",e)}e.isFreeConsultation&&(t="Consultazione Gratuita (10 minuti)");let r=await fetch("https://sendbookingnotification-4ks3j6nupa-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"new-booking",booking:e,packageTitle:t,notificationEmail:i,businessName:a,colorPalette:n})}),s=await r.json();s.success?((0,l.f9)("✅ Booking notification (dottore) sent successfully:",s.sentTo),e.isFreeConsultation&&(0,l.f9)("\uD83D\uDCE7 Email sent for free consultation booking")):console.error("❌ Failed to send booking notification:",s.message)}catch(e){console.error("❌ Error sending booking notification:",e)}}async function s(e,t){try{let o=await fetch(e,{cache:"no-store"});if(!o.ok)return t;return await o.json()}catch(e){return t}}async function c(){let e=n();if("firebase"===e)return(0,i.G9)();if("demo"===e)return s("/demo/packages.json",[]);try{let e=await fetch("/api/localdb/packages",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function d(e){var t;let o=n();if("firebase"===o)return(0,i.Kh)(e);if("demo"===o)throw Error("Preprod demo read-only");let a=null!=(t=e.id)?t:T(),l=await c(),r=[{...e,id:a},...l.filter(e=>e.id!==a)];return await fetch("/api/localdb/packages",{method:"POST",body:JSON.stringify(r)}),a}async function u(e){let t=n();if("firebase"===t){let{deletePackage:t}=await Promise.resolve().then(o.bind(o,4368));return t(e)}if("demo"===t)throw Error("Preprod demo read-only");let i=(await c()).filter(t=>t.id!==e);await fetch("/api/localdb/packages",{method:"POST",body:JSON.stringify(i)})}async function g(){let e=n();if("firebase"===e)return(0,i.ZY)();if("demo"===e)return s("/demo/bookings.json",[]);try{let e=await fetch("/api/localdb/bookings",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function f(e,t){var o,a,l,s,c,d,u,g,f,m,p,b,S,v,C,y,h,I;let w=n();if("firebase"===w)return(0,i.sH)(e,t);if("demo"===w)throw Error("Preprod demo read-only");if(!e.slot)throw Error("Lo slot orario \xe8 obbligatorio per la prenotazione");let k=await E(e.date),A=e.isFreeConsultation?"online":e.location||"online",N="online"===A?null!=(l=null!=(a=null==k?void 0:k.onlineSlots)?a:null==k?void 0:k.slots)?l:[]:e.studioLocation?null!=(s=null==k||null==(o=k.studioSlots)?void 0:o[e.studioLocation])?s:[]:null!=(c=null==k?void 0:k.inStudioSlots)?c:[];if(!k||!N.includes(e.slot))throw Error("L'orario selezionato non \xe8 pi\xf9 disponibile");let B=T(),D=new Date().toISOString();try{let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),o=t.ok?await t.json():[],i=[{...e,id:B,createdAt:D},...o];if(await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(i)}),"online"===A){let t=(null!=(u=null!=(d=k.onlineSlots)?d:k.slots)?u:[]).filter(t=>t!==e.slot);await P(e.date,t,k.freeConsultationSlots,null!=(g=k.inStudioSlots)?g:[],null!=(f=k.studioSlots)?f:{})}else if(e.studioLocation){let t={...null!=(m=k.studioSlots)?m:{}};t[e.studioLocation]=(null!=(p=t[e.studioLocation])?p:[]).filter(t=>t!==e.slot),await P(e.date,null!=(S=null!=(b=k.onlineSlots)?b:k.slots)?S:[],k.freeConsultationSlots,null!=(v=k.inStudioSlots)?v:[],t)}else{let t=(null!=(C=k.inStudioSlots)?C:[]).filter(t=>t!==e.slot);await P(e.date,null!=(h=null!=(y=k.onlineSlots)?y:k.slots)?h:[],k.freeConsultationSlots,t,null!=(I=k.studioSlots)?I:{})}let a={...e,id:B,createdAt:D};return await r(a),B}catch(o){await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify([{...e,id:B,createdAt:D}])});let t={...e,id:B,createdAt:D};return await r(t),B}}async function m(e){let t=n();if("firebase"===t)return(0,i.vq)(e);if("demo"===t)throw Error("Preprod demo read-only");try{var o,a,r,s,c,d;let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),i=t.ok?await t.json():[],n=i.find(t=>t.id===e.id);if(n&&n.slot!==e.slot&&e.slot){let t=await E(e.date),i=e.isFreeConsultation?"online":e.location||"online",n="online"===i?null!=(a=null!=(o=null==t?void 0:t.onlineSlots)?o:null==t?void 0:t.slots)?a:[]:null!=(r=null==t?void 0:t.inStudioSlots)?r:[];if(!t||!n.includes(e.slot))throw Error("Il nuovo orario selezionato non \xe8 pi\xf9 disponibile")}if(n&&n.date!==e.date&&e.slot){let t=await E(e.date),o=e.isFreeConsultation?"online":e.location||"online",i="online"===o?null!=(c=null!=(s=null==t?void 0:t.onlineSlots)?s:null==t?void 0:t.slots)?c:[]:null!=(d=null==t?void 0:t.inStudioSlots)?d:[];if(!t||!i.includes(e.slot))throw Error("L'orario selezionato non \xe8 disponibile per la nuova data")}let u=i.map(t=>t.id===e.id?e:t);await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(u)}),(0,l.f9)("\uD83D\uDCCB Prenotazione aggiornata:",e.id,"- gestione disponibilit\xe0 delegata al sistema principale")}catch(e){throw console.error("Error updating booking:",e),e}}async function p(e){let t=n();if("firebase"===t)return(0,i.VA)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/bookings",{cache:"no-store"}),o=t.ok?await t.json():[],i=o.find(t=>t.id===e),a=o.filter(t=>t.id!==e);await fetch("/api/localdb/bookings",{method:"POST",body:JSON.stringify(a)}),(0,l.f9)("\uD83D\uDCCB Prenotazione cancellata:",null==i?void 0:i.id,"- availability gestita dal sistema principale")}catch(e){throw console.error("Error deleting booking:",e),e}}async function b(e){var t,o,a;let l=n();if("firebase"===l)return(0,i.TP)(e);if("demo"===l)throw Error("Preprod demo read-only");let r=function(e,t){try{let o=localStorage.getItem(e);return o?JSON.parse(o):t}catch(e){return t}}("gzn:clients",[]),s=null!=(t=e.id)?t:T();return o="gzn:clients",a=[{...e,id:s},...r.filter(e=>e.id!==s)],localStorage.setItem(o,JSON.stringify(a)),s}async function S(e){var t,o;let a=n();if("firebase"===a)return(0,i.dd)(e);if("demo"===a)return null!=(t=(await s("/demo/clients.json",[])).find(t=>t.email===e))?t:null;try{let t=await fetch("/api/localdb/clients",{cache:"no-store"});return null!=(o=(t.ok?await t.json():[]).find(t=>t.email===e))?o:null}catch(e){return null}}async function v(){let e=n();if("firebase"===e)return(0,i.by)();if("demo"===e)return s("/demo/clients.json",[]);try{let e=await fetch("/api/localdb/clients",{cache:"no-store"});if(e.ok)return await e.json()}catch(e){}return[]}async function C(e){var t,o;let a=n();if("firebase"===a)return(0,i.EZ)(e);if("demo"===a)return null!=(t=(await s("/demo/clients.json",[])).find(t=>t.id===e))?t:null;try{let t=await fetch("/api/localdb/clients",{cache:"no-store"});return null!=(o=(t.ok?await t.json():[]).find(t=>t.id===e))?o:null}catch(e){return null}}async function y(e){let t=n();if("firebase"===t)return(0,i.zZ)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/clients",{cache:"no-store"}),o=(t.ok?await t.json():[]).filter(t=>t.id!==e);await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(o)})}catch(e){throw console.error("Error deleting client:",e),e}}async function h(e){let t=n();if("firebase"===t)return(0,i.Wi)(e);if("demo"===t)throw Error("Preprod demo read-only");try{let t=await fetch("/api/localdb/clients",{cache:"no-store"}),o=t.ok?await t.json():[],i=o.find(t=>t.email===e.email);if(i){let t={...i,name:e.name,phone:e.phone||i.phone,assignedPackage:e.packageId||i.assignedPackage,status:"prospect",source:i.source||"website"},a=o.map(e=>e.id===i.id?t:e);return await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(a)}),i.id}{let t={id:crypto.randomUUID(),name:e.name,email:e.email,phone:e.phone,notes:"Cliente creato automaticamente dalla prenotazione in attesa del ".concat(new Date(e.date).toLocaleDateString("it-IT")),status:"prospect",source:"website",assignedPackage:e.packageId,goals:[],medicalConditions:[],allergies:[],medications:[],documents:[],createdAt:new Date().toISOString()},i=[t,...o];return await fetch("/api/localdb/clients",{method:"POST",body:JSON.stringify(i)}),t.id}}catch(e){throw console.error("Error creating client from pending booking:",e),e}}async function I(){let e=n();if((0,l.f9)("[getSiteContent] Modalit\xe0:",e,"Server:",!1),"firebase"===e)return(0,i.fH)();if("demo"===e)return s("/demo/siteContent.json",{heroTitle:"",heroSubtitle:"",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",images:[],contactTitle:"",contactSubtitle:"",contactPhone:"",contactEmail:"",contactAddresses:[],socialChannels:[],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"",colorPalette:"gz-default",googleCalendar:{isEnabled:!1,calendarId:"9765caa0fca592efb3eac96010b3f8f770050fad09fe7b379f16aacdc89fa689@group.calendar.google.com",timezone:"Europe/Rome",serviceAccountEmail:"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"}});try{(0,l.f9)("[getSiteContent] Tentativo caricamento da:","".concat("","/api/localdb/siteContent"));let e=await fetch("".concat("","/api/localdb/siteContent"),{cache:"no-store"});if((0,l.f9)("[getSiteContent] Risposta API:",e.status,e.statusText),e.ok){let t=await e.json();return(0,l.f9)("[getSiteContent] Contenuto caricato, favicon:",(null==t?void 0:t.favicon)||"nessuno"),t}}catch(e){console.error("[getSiteContent] Errore nel caricamento locale:",e)}return{heroTitle:"",heroSubtitle:"",heroCta:"Prenota ora",heroBackgroundImage:"",heroBadgeText:"Performance • Estetica • Energia",heroBadgeColor:"bg-primary text-primary-foreground",aboutTitle:"",aboutBody:"",aboutImageUrl:"",images:[],contactTitle:"",contactSubtitle:"",contactPhone:"",contactEmail:"",contactAddresses:[],socialChannels:[],contactSectionTitle:"\uD83D\uDCAC Contatti Diretti",contactSectionSubtitle:"",studiosSectionTitle:"\uD83C\uDFE2 I Nostri Studi",studiosSectionSubtitle:"",colorPalette:"gz-default",favicon:void 0,googleCalendar:{isEnabled:!1,calendarId:"9765caa0fca592efb3eac96010b3f8f770050fad09fe7b379f16aacdc89fa689@group.calendar.google.com",timezone:"Europe/Rome",serviceAccountEmail:"zambo-489@gznutrition-d5d13.iam.gserviceaccount.com"}}}async function w(e){let t=n();if((0,l.f9)("[upsertSiteContent] Current mode:",t),(0,l.f9)("[upsertSiteContent] \uD83D\uDCCA BMI config being saved:",e.bmiCalculator),(0,l.f9)("[upsertSiteContent] ⭐ Reviews config being saved:",e.googleReviews),(0,l.f9)("[upsertSiteContent] ⚖️ LegalInfo config being saved:",e.legalInfo),(0,l.f9)("[upsertSiteContent] \uD83D\uDD17 META TAGS being saved:",e.metaTags),(0,l.f9)("[upsertSiteContent] \uD83C\uDFAF FAVICON being saved:",e.favicon||"NESSUN FAVICON"),"firebase"===t){(0,l.f9)("[upsertSiteContent] Using Firebase"),(0,l.f9)("[upsertSiteContent] \uD83D\uDD25 Calling Firebase upsert..."),await (0,i._L)(e),(0,l.f9)("[upsertSiteContent] ✅ Firebase upsert completed");return}if("demo"===t)throw(0,l.f9)("[upsertSiteContent] Demo mode - throwing read-only error"),Error("Preprod demo read-only");(0,l.f9)("[upsertSiteContent] Using local API"),(0,l.f9)("[upsertSiteContent] \uD83D\uDCE4 Sending to local API...");let o=await fetch("/api/localdb/siteContent",{method:"POST",body:JSON.stringify(e)});if((0,l.f9)("[upsertSiteContent] \uD83D\uDCE5 Local API response:",o.status,o.statusText),!o.ok)throw Error("Local API failed: ".concat(o.status," ").concat(o.statusText))}async function E(e){let t=n();if((0,l.f9)("\uD83C\uDF10 [SITO PUBBLICO] getAvailabilityByDate chiamata per:",e,"modalit\xe0:",t),"firebase"===t){let t=await (0,i.ho)(e);return(0,l.f9)("\uD83D\uDD25 [SITO PUBBLICO] Risultato da Firebase:",t),t}if("demo"===t)return s("/demo/availability/".concat(e,".json"),{date:e,slots:[]});try{let t=await fetch("/api/localdb/availability",{cache:"no-store"}),i=(t.ok?await t.json():{})[e];if((0,l.f9)("\uD83D\uDCBE [SITO PUBBLICO] Dati locali per",e,":",i),i){var o,a,r,c,d;let t={date:e,onlineSlots:null!=(a=null!=(o=i.onlineSlots)?o:i.slots)?a:[],inStudioSlots:null!=(r=i.inStudioSlots)?r:[],studioSlots:null!=(c=i.studioSlots)?c:{},slots:i.slots,freeConsultationSlots:(null!=(d=i.freeConsultationSlots)?d:[]).map(e=>"string"==typeof e?{time:e,duration:10}:e)};return(0,l.f9)("✅ [SITO PUBBLICO] Risultato locale processato:",t),t}return(0,l.f9)("❌ [SITO PUBBLICO] Nessun dato trovato per:",e),{date:e,onlineSlots:[],inStudioSlots:[],freeConsultationSlots:[]}}catch(t){return console.error("❌ [SITO PUBBLICO] Errore caricamento dati:",t),{date:e,onlineSlots:[],inStudioSlots:[],freeConsultationSlots:[]}}}async function P(e,t,o,a,l){let r=n();if("firebase"===r)return(0,i.wb)(e,t,o,a,l);if("demo"===r)throw Error("Preprod demo read-only");try{var s,c;let i=await fetch("/api/localdb/availability",{cache:"no-store"}),n=i.ok?await i.json():{};n[e]={onlineSlots:t,inStudioSlots:a||[],freeConsultationSlots:Array.isArray(o)?o.map(e=>"string"==typeof e?e:e.time):[],studioSlots:null!=(c=null!=l?l:null==(s=n[e])?void 0:s.studioSlots)?c:{}},await fetch("/api/localdb/availability",{method:"POST",body:JSON.stringify(n)})}catch(e){}}function T(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)}async function k(e){if("local"===n()){let t=T(),o={...e,id:t,createdAt:new Date().toISOString()},i=JSON.parse(localStorage.getItem("clientProgress")||"[]");return i.push(o),localStorage.setItem("clientProgress",JSON.stringify(i)),t}return(0,i.u2)(e)}async function A(e){return"local"===n()?JSON.parse(localStorage.getItem("clientProgress")||"[]").filter(t=>t.clientId===e).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()):(0,i.HG)(e)}async function N(e,t){if("local"===n()){let o=JSON.parse(localStorage.getItem("clientProgress")||"[]"),i=o.findIndex(t=>t.id===e);-1!==i&&(o[i]={...o[i],...t},localStorage.setItem("clientProgress",JSON.stringify(o)));return}return(0,i.Ej)(e,t)}async function B(e){if("local"===n()){let t=JSON.parse(localStorage.getItem("clientProgress")||"[]").filter(t=>t.id!==e);localStorage.setItem("clientProgress",JSON.stringify(t));return}return(0,i.KB)(e)}}}]);