"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3936],{3936:(e,o,t)=>{t.d(o,{BookingForm:()=>w});var r=t(5155),a=t(2115),n=t(2544),i=t(6942),l=t(2377),s=t(3998),c=t(5142),d=t(9018),m=t(576),u=t(8674),g=t(8901),p=t(7205),x=t(5513),b=t(9228),f=t(2473),h=t(63),v=t(2381),y=t(3366),F=t(569),N=t(4986),j=t(2663),k=t(1141),C=t(9060);let P=l.Ik({name:l.Yj().min(2,"Nome troppo corto"),email:l.Yj().email("Email non valida"),phone:l.Yj().min(7,"Telefono obbligatorio").regex(/^[+0-9\s-]+$/,"Formato non valido"),date:l.Yj().min(1,"Seleziona una data"),slot:l.Yj().min(1,"Seleziona un orario disponibile"),location:l.k5(["online","studio"]).optional(),packageId:l.Yj().optional(),notes:l.Yj().optional(),gdprConsent:l.zM().refine(e=>!0===e,{message:"Devi accettare il trattamento dei dati personali per continuare"})});function S(e){let{availableDates:o,selectedDate:t,onDateSelect:n,showPromotionalBanner:i}=e,[l,s]=(0,a.useState)(new Date),[c,d]=(0,a.useState)(!1),m=(0,u.w)(l),v=(0,g.p)(l),y=(0,p.k)({start:m,end:v}),N=e=>{let t=(0,f.GP)(e,"yyyy-MM-dd");return o.includes(t)};return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-full p-3 border border-border rounded-lg bg-background text-foreground cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>d(!c),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:t?"text-foreground":"text-foreground/60",children:t?(0,f.GP)(new Date(t),"EEEE d MMMM yyyy",{locale:F.it}):"Seleziona una data"}),(0,r.jsx)("span",{className:"text-gray-600",children:"\uD83D\uDCC5"})]})}),c&&(0,r.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-2 bg-background border border-border rounded-lg shadow-lg z-50 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("button",{onClick:()=>s((0,b.a)(l,1)),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:"←"}),(0,r.jsx)("h3",{className:"font-semibold text-foreground",children:(0,f.GP)(l,"MMMM yyyy",{locale:F.it})}),(0,r.jsx)("button",{onClick:()=>s((0,x.P)(l,1)),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:"→"})]}),(0,r.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Lun","Mar","Mer","Gio","Ven","Sab","Dom"].map(e=>(0,r.jsx)("div",{className:"w-10 h-10 flex items-center justify-center text-xs font-medium text-foreground",children:e},e))}),(0,r.jsx)("div",{className:"grid grid-cols-7 gap-1",children:y.map((e,o)=>(0,r.jsx)("div",{className:(e=>{let o="w-10 h-10 flex items-center justify-center text-sm rounded-full cursor-pointer transition-all duration-200";return((0,h.c)(e)&&(o+=" ring-2 ring-primary/50"),t===(0,f.GP)(e,"yyyy-MM-dd"))?o+=" bg-primary text-primary-foreground font-semibold":N(e)?o+=" bg-emerald-100 text-emerald-800 hover:bg-emerald-200 font-medium border border-emerald-200":o+=" bg-gray-100 text-gray-400 cursor-not-allowed",o})(e),onClick:()=>(e=>{let o=(0,f.GP)(e,"yyyy-MM-dd");N(e)&&(n(o),d(!1))})(e),children:(0,f.GP)(e,"d")},o))}),(0,r.jsx)("div",{className:"mt-4 pt-3 border-t border-border",children:(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full border border-green-700"}),(0,r.jsx)("span",{className:"text-muted-foreground",children:"Disponibile"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-gray-100 rounded-full"}),(0,r.jsx)("span",{className:"text-muted-foreground",children:"Non disponibile"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-primary rounded-full"}),(0,r.jsx)("span",{className:"text-muted-foreground",children:"Selezionato"})]})]})}),i&&(0,r.jsx)("div",{className:"mt-3 p-2 bg-green-50 border border-green-200 rounded text-center",children:(0,r.jsx)("p",{className:"text-xs text-green-700",children:"\uD83C\uDFAF Solo date con slot promozionali disponibili"})})]}),c&&(0,r.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)})]})}function w(e){var o;let{adminMode:l=!1,requirePackage:u=!1,hidePackageSelect:g=!1}=e,[p,x]=(0,a.useState)(!1),[b,h]=(0,a.useState)(""),[F,w]=(0,a.useState)(""),[E,T]=(0,a.useState)([]),[I,A]=(0,a.useState)([]),[z,O]=(0,a.useState)(null),[D,B]=(0,a.useState)([]),[R,M]=(0,a.useState)(null),[L,G]=(0,a.useState)(""),[H,U]=(0,a.useState)([]),[V,_]=(0,a.useState)(null),[J,W]=(0,a.useState)(null),Y=(0,a.useRef)([]),Z=(0,a.useRef)([]),$=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await (0,d.getSiteContent)();if(e){var o;_(t);let e=null!=(o=null==t?void 0:t.contactAddresses)?o:[];U(e),1===e.length&&G(e[0].name)}}catch(e){}})(),()=>{e=!1}},[]);let[q,K]=(0,a.useState)((0,N.J5)());(0,a.useEffect)(()=>{let e=e=>{(0,m.f9)("\uD83D\uDD04 DirectState cambiato:",e.detail),K(e.detail)};return window.addEventListener("directStateChange",e),()=>{window.removeEventListener("directStateChange",e)}},[]);let Q=q.isFreeConsultation||(null==z?void 0:z.isPromotional)===!0;(0,m.f9)("\uD83C\uDFAF BookingForm - isFreeConsultation:",Q),(0,m.f9)("\uD83C\uDFAF BookingForm - directState completo:",q),(0,m.f9)("\uD83C\uDFAF BookingForm - selectedPackage promozionale:",null==z?void 0:z.isPromotional),(0,m.f9)("\uD83C\uDFAF BookingForm - fonte consulenza gratuita:",q.isFreeConsultation?"popup":(null==z?void 0:z.isPromotional)?"dropdown pacchetto promozionale":"nessuna"),(0,m.f9)("\uD83D\uDCC5 BookingForm - selectedDate:",F);let X=P.refine(e=>!e.date||!e.slot||Y.current.includes(e.slot),{message:"L'orario selezionato non \xe8 pi\xf9 disponibile",path:["slot"]}),{register:ee,handleSubmit:eo,formState:{errors:et},setValue:er,watch:ea}=(0,n.mN)({resolver:(0,i.u)(X),defaultValues:{name:"",email:"",phone:"",date:"",slot:"",notes:"",packageId:q.selectedPackageId||"",gdprConsent:!1}});(0,a.useEffect)(()=>{(0,m.f9)("BookingForm: NUOVO SISTEMA - Inizializzazione"),(async()=>{try{(0,m.f9)("BookingForm: Caricamento pacchetti...");let e=await (0,d.getPackages)();(0,m.f9)("BookingForm: Pacchetti caricati:",e),(0,m.f9)("\uD83C\uDFAF PACCHETTI PROMOZIONALI TROVATI:",e.filter(e=>e.isPromotional)),(0,m.f9)("\uD83C\uDFAF TUTTI I PACCHETTI CON FLAG PROMOZIONALE:",e.map(e=>({title:e.title,isPromotional:e.isPromotional}))),(0,m.f9)("\uD83C\uDFAF TUTTI GLI ID DEI PACCHETTI:",e.map(e=>e.id)),(0,m.f9)("\uD83C\uDFAF PACCHETTO FREE-CONSULTATION ESISTE?",e.some(e=>"free-consultation"===e.id));let o=e||[];B(o),Z.current=o;let t=(0,N.J5)();if((0,m.f9)("BookingForm: Stato diretto attuale:",t),t.selectedPackageId&&o.length>0){(0,m.f9)("BookingForm: Cercando pacchetto con ID:",t.selectedPackageId),(0,m.f9)("BookingForm: Pacchetti disponibili:",o.map(e=>({id:e.id,title:e.title,isPromotional:e.isPromotional})));let e=o.find(e=>e.id===t.selectedPackageId);(0,m.f9)("BookingForm: Pacchetto trovato:",e),e?(O(e),er("packageId",e.id||""),(0,m.f9)("BookingForm: SUCCESSO - Form precompilato con:",e.title)):console.error("BookingForm: ERRORE - Pacchetto non trovato con ID:",t.selectedPackageId)}}catch(e){console.error("BookingForm: Errore caricamento pacchetti:",e)}})();let e=e=>{if((0,m.f9)("BookingForm: Cambio stato diretto:",e.detail),K(e.detail),e.detail.selectedPackageId&&Z.current.length>0){(0,m.f9)("BookingForm: Evento directStateChange - Cercando pacchetto con ID:",e.detail.selectedPackageId),console.log("BookingForm: Pacchetti disponibili per evento:",Z.current.map(e=>({id:e.id,title:e.title,isPromotional:e.isPromotional})));let o=Z.current.find(o=>o.id===e.detail.selectedPackageId);console.log("BookingForm: Pacchetto trovato per evento:",o),o?(O(o),er("packageId",o.id||""),console.log("BookingForm: Form aggiornato via evento:",o.title)):console.error("BookingForm: ERRORE - Pacchetto non trovato per evento con ID:",e.detail.selectedPackageId)}};return window.addEventListener("directStateChange",e),()=>{window.removeEventListener("directStateChange",e)}},[er]),(0,a.useEffect)(()=>{Y.current=E},[E]),(0,a.useEffect)(()=>{(async()=>{let e=Q||(null==z?void 0:z.isPromotional)===!0?60:14;console.log("\uD83D\uDCC5 Generando ".concat(e," date per ").concat(Q?"consulenza gratuita":"consulenza normale"));let o=Array.from({length:e},(e,o)=>{let t=(0,v.f)((0,y.o)(new Date),o);return(0,f.GP)(t,"yyyy-MM-dd")}).map(async e=>{try{let a=await (0,d.getAvailabilityByDate)(e);if(a){let n=Q||(null==z?void 0:z.isPromotional)===!0;if(console.log("\uD83D\uDCC5 Date ".concat(e," - shouldUsePromotionalSlots:"),n,"isFreeConsultation:",Q,"isPromotional:",null==z?void 0:z.isPromotional),n)if(a.freeConsultationSlots&&a.freeConsultationSlots.length>0)return console.log("✅ Date ".concat(e," - Found promotional slots:"),a.freeConsultationSlots),e;else console.log("❌ Date ".concat(e," - No promotional slots available"));else{var o,t,r;let n=null!=(o=a.onlineSlots)?o:[],i=a.studioSlots&&L?null!=(t=a.studioSlots[L])?t:[]:null!=(r=a.inStudioSlots)?r:[],l=null===R?[...n,...i]:"online"===R?n:i;if(l&&l.length>0)return e}}return null}catch(o){return console.error("Errore nel controllo disponibilit\xe0 per ".concat(e,":"),o),null}});A((await Promise.all(o)).filter(e=>null!==e))})()},[z,Q,R,L]),(0,a.useEffect)(()=>{F&&(async()=>{try{let a=await (0,d.getAvailabilityByDate)(F);if(a){let n=Q||(null==z?void 0:z.isPromotional)===!0;if(console.log("\uD83D\uDD0D DEBUG SLOT:",{isFreeConsultation:Q,selectedPackage:null==z?void 0:z.title,isPromotional:null==z?void 0:z.isPromotional,shouldUsePromotionalSlots:n,directState:q,selectionSource:Q?"popup consulenze gratuite":"dropdown form"}),n)console.log("\uD83C\uDFAF CONSULENZA GRATUITA/PROMOZIONALE - Caricando slot promozionali:",a.freeConsultationSlots),T((a.freeConsultationSlots||[]).map(e=>"string"==typeof e?e:e.time));else{var e,o,t,r;console.log("\uD83D\uDCCB CONSULENZA NORMALE - Caricando slot normali");let n=null!=(e=a.onlineSlots)?e:[],i=a.studioSlots&&L?null!=(o=a.studioSlots[L])?o:[]:null!=(t=a.inStudioSlots)?t:[],l=null!=(r=a.slots)?r:[],s=null===R?n.length||i.length?[...n,...i]:l:"online"===R?n:i;console.log("\uD83D\uDCCB Pool slot normali selezionato:",s),T(s)}}}catch(e){console.error("Errore nel caricamento disponibilit\xe0:",e),T([])}})()},[F,z,Q,R,L]);let en=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,ei=()=>{try{let e="incognito-test-".concat(Date.now());localStorage.setItem(e,"test"),localStorage.removeItem(e)}catch(e){return console.log("\uD83D\uDD75️ INCOGNITO: Rilevato tramite localStorage test"),!0}try{let e="session-test-".concat(Date.now());sessionStorage.setItem(e,"test"),sessionStorage.removeItem(e)}catch(e){return console.log("\uD83D\uDD75️ INCOGNITO: Rilevato tramite sessionStorage test"),!0}return window.indexedDB?(console.log("\uD83D\uDD75️ INCOGNITO: Non rilevato - modalit\xe0 normale"),!1):(console.log("\uD83D\uDD75️ INCOGNITO: Rilevato tramite IndexedDB test"),!0)},el=async e=>{if(p)return;let o=ei();if(console.log("\uD83D\uDD75️ Controllo incognito nel submit:",o),o){console.log("\uD83D\uDEAB BLOCCO: Form submission bloccato per modalit\xe0 incognito"),j.oR.error("⚠️ La prenotazione non \xe8 disponibile in modalit\xe0 incognito. Per continuare, apri il sito in modalit\xe0 normale.",{duration:6e3,position:"top-center",style:{background:"#dc2626",color:"white",fontWeight:"600",borderRadius:"12px",padding:"16px 24px",fontSize:"16px",boxShadow:"0 10px 25px rgba(220, 38, 38, 0.3)",maxWidth:"90vw"}});return}if(en()&&(console.log("\uD83D\uDCF1 iOS DETECTED - Form submission attempt"),console.log("\uD83D\uDCF1 Form data:",e),console.log("\uD83D\uDCF1 CAPTCHA token:",J?"presente":"assente"),console.log("\uD83D\uDCF1 User agent:",navigator.userAgent)),u&&!z&&!l)return void j.oR.error("Seleziona un pacchetto per continuare",{duration:3e3,position:"top-center",style:{background:ed.warning,color:"white",fontWeight:"600",borderRadius:"12px",padding:"16px 24px",fontSize:"16px",boxShadow:"0 10px 25px ".concat(ed.warning,"30")}});if(!l&&(null==V?void 0:V.recaptchaEnabled)&&!J&&!o){if(en()&&$.current){console.log("\uD83D\uDCF1 iOS - Tentativo re-render reCAPTCHA");try{$.current.reset(),await new Promise(e=>setTimeout(e,500))}catch(e){console.error("\uD83D\uDCF1 iOS - Errore re-render reCAPTCHA:",e)}}j.oR.error("Completa la verifica CAPTCHA per continuare",{duration:3e3,position:"top-center",style:{background:ed.warning,color:"white",fontWeight:"600",borderRadius:"12px",padding:"16px 24px",fontSize:"16px",boxShadow:"0 10px 25px ".concat(ed.warning,"30")}});return}x(!0),h("Preparando prenotazione...");try{let o={...e,isFreeConsultation:Q,status:"pending"};h("Verificando disponibilit\xe0..."),console.log("\uD83D\uDE80 Tentativo prenotazione consulenza gratuita:",{isFreeConsultation:Q,selectedPackage:z}),en()&&(console.log("\uD83D\uDCF1 iOS - Aggiunto delay specifico per stabilit\xe0"),await new Promise(e=>setTimeout(e,300)));try{let e;h("Inviando prenotazione...");let{createBooking:r,getDataMode:a}=await Promise.resolve().then(t.bind(t,9018)),n=a();console.log("\uD83D\uDD0D MODALIT\xc0 DATA ATTIVA:",n),console.log("\uD83C\uDF10 NODE_ENV:","production"),console.log("\uD83D\uDD25 Firebase Config Present:",!0),en()&&console.log("\uD83D\uDCF1 iOS - Payload pre-invio:",{name:o.name,email:o.email,captchaPresent:!!J,dataMode:n});let i={name:o.name,email:o.email,phone:o.phone||void 0,packageId:null==z?void 0:z.id,date:o.date,slot:o.slot,location:Q||(null==z?void 0:z.isPromotional)===!0?"online":R,studioLocation:"studio"===R&&L||void 0,status:l?"confirmed":"pending",notes:o.notes,isFreeConsultation:Q};if(console.log("\uD83D\uDCE4 Payload prenotazione:",i),console.log("\uD83D\uDD11 CAPTCHA token:",J?"presente":"assente"),console.log("\uD83C\uDFAF VERIFICA FLAG: isFreeConsultation nel payload =",i.isFreeConsultation),console.log("\uD83C\uDFAF VERIFICA FLAG: variabile locale isFreeConsultation =",Q),en()){console.log("\uD83D\uDCF1 iOS - Tentativo createBooking con gestione speciale");try{e=await r(i,J||void 0)}catch(r){console.error("\uD83D\uDCF1 iOS - Primo tentativo fallito:",r),console.log("\uD83D\uDCF1 iOS - Secondo tentativo con API diretta"),console.log("\uD83D\uDCF1 iOS - Payload da inviare:",JSON.stringify(i,null,2));let o=await fetch("/api/localdb/bookings",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},body:JSON.stringify(i),credentials:"same-origin"});if(console.log("\uD83D\uDCF1 iOS - Response status:",o.status),console.log("\uD83D\uDCF1 iOS - Response headers:",Object.fromEntries(o.headers.entries())),!o.ok){let e=await o.text();throw console.error("\uD83D\uDCF1 iOS - Response error text:",e),Error("iOS API fallback failed: ".concat(o.status," - ").concat(e))}let t=await o.json();console.log("\uD83D\uDCF1 iOS - Response result:",t),e=t.id||t.bookingId||"ios-fallback-success",console.log("\uD83D\uDCF1 iOS - Fallback API riuscito:",e)}}else e=await r(i,J||void 0);if(h("Completato!"),console.log("✅ Prenotazione creata con successo! ID:",e),console.log("\uD83D\uDD0D Modalit\xe0 data utilizzata per questa prenotazione:","Firebase"),!e)throw Error("Prenotazione fallita - nessun ID ricevuto")}catch(r){console.error("❌ Errore createBooking principale:",r),console.error("❌ Dettaglio errore:",r.message),en()&&(console.error("\uD83D\uDCF1 iOS - Errore specifico:",r),console.error("\uD83D\uDCF1 iOS - User agent:",navigator.userAgent),console.error("\uD83D\uDCF1 iOS - Network status:",navigator.onLine));let e=(await Promise.resolve().then(t.bind(t,9018))).getDataMode();if("local"===e){if(h("Tentativo sistema di backup locale..."),console.log("\uD83D\uDD04 Usando fallback locale in modalit\xe0 dev..."),!(await fetch("/api/localdb/bookings",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...en()&&{"Cache-Control":"no-cache"}},body:JSON.stringify(o),...en()&&{credentials:"same-origin"}})).ok)throw console.error("❌ Fallback locale fallito anche!"),Error("Prenotazione fallita completamente");h("Backup locale completato!"),console.log("✅ Fallback locale riuscito")}else{let o=en()?"Prenotazione fallita in modalit\xe0 ".concat(e," su iOS: ").concat(r.message):"Prenotazione fallita in modalit\xe0 ".concat(e,": ").concat(r.message);throw Error(o)}}j.oR.success(Q?"Consulenza gratuita prenotata con successo!":"Prenotazione inviata con successo!",{duration:4e3,position:"top-center",style:{background:"linear-gradient(135deg, ".concat(ed.success," 0%, ").concat(ed.primary," 100%)"),color:"white",fontWeight:"600",borderRadius:"16px",padding:"20px 28px",fontSize:"16px",boxShadow:"0 20px 40px rgba(".concat(ed.primaryRgb,", 0.4)"),border:"1px solid rgba(255, 255, 255, 0.2)"},icon:"✓",iconTheme:{primary:"#ffffff",secondary:ed.primary}}),er("name",""),er("email",""),er("phone",""),er("date",""),er("slot",""),er("notes",""),er("gdprConsent",!1),w(""),T([]),O(null),er("packageId",""),W(null),$.current&&$.current.reset()}catch(o){console.error("Errore:",o),en()&&console.error("\uD83D\uDCF1 iOS - Errore finale:",{error:o,message:o.message,userAgent:navigator.userAgent,network:navigator.onLine,captchaToken:J?"presente":"assente"});let e=en()?"Errore su iOS. Prova a ricaricare la pagina e ripetere l'operazione.":"Errore nell'invio della prenotazione. Riprova.";j.oR.error(e,{duration:en()?6e3:4e3,position:"top-center",style:{background:ed.error,color:"white",fontWeight:"600",borderRadius:"12px",padding:"16px 24px",fontSize:"16px",boxShadow:"0 10px 25px ".concat(ed.error,"30")}})}finally{x(!1),h(""),$.current&&(en()?setTimeout(()=>{var e;null==(e=$.current)||e.reset()},300):$.current.reset())}},es=null==z?void 0:z.isPromotional;console.log("\uD83C\uDFAF SHOW PROMOTIONAL BANNER:",{selectedPackage:null==z?void 0:z.title,isPromotional:null==z?void 0:z.isPromotional,showPromotionalBanner:es,isFreeConsultation:Q});let ec=e=>{let o=e.replace("#",""),t=parseInt(3===o.length?o.split("").map(e=>e+e).join(""):o,16);return"".concat(t>>16&255,", ").concat(t>>8&255,", ").concat(255&t)},ed=(()=>{let e=(null==V?void 0:V.colorPalette)||"gz-default",o=(0,C.AT)(e);return{primary:o.primary,accent:o.accent,success:o.primary,error:"#EF4444",warning:"#F59E0B",primaryRgb:ec(o.primary),accentRgb:ec(o.accent)}})();return console.log("\uD83C\uDFA8 PALETTE DINAMICA:",{paletteId:(null==V?void 0:V.colorPalette)||"gz-default",colors:ed}),console.log("BookingForm: RENDER - selectedPackage:",z),console.log("BookingForm: RENDER - packages:",D),console.log("BookingForm: RENDER - packages.length:",D.length),(0,r.jsxs)("div",{className:"section-surface p-6 sm:p-8 space-y-6",children:[ei()&&(0,r.jsx)("div",{className:"rounded-xl p-4 bg-red-50 border border-red-200 shadow-md",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-9 h-9 rounded-full bg-red-100 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-lg",children:"\uD83D\uDD75️"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-bold text-red-800",children:"⚠️ Modalit\xe0 Incognito Rilevata"}),(0,r.jsxs)("p",{className:"text-sm text-red-700 mt-1",children:["La prenotazione non \xe8 disponibile in modalit\xe0 incognito. Per continuare, ",(0,r.jsx)("strong",{children:"apri il sito in modalit\xe0 normale"}),"."]})]})]})}),z&&(0,r.jsx)("div",{className:"rounded-xl p-4 shadow-md ".concat(es?"bg-green-50 border border-green-200":"border border-foreground/20 bg-background/70 backdrop-blur-sm"),children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center ".concat(es?"bg-green-100":"bg-primary/10"),children:(0,r.jsx)("span",{className:"text-lg",children:es?"\uD83C\uDFAF":"\uD83D\uDCE6"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-semibold ".concat(es?"text-green-800":"text-foreground"),children:z.title}),(0,r.jsx)("p",{className:"text-sm ".concat(es?"text-green-700":"text-foreground"),children:function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;if(e.length<=o)return e;let t=e.substring(0,o),r=t.lastIndexOf(" ");return r>.8*o?t.substring(0,r)+"...":t+"..."}(z.description)}),!es&&(0,r.jsxs)("div",{className:"mt-2",children:[z.hasDiscount&&z.basePrice&&z.discountedPrice?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-lg font-bold text-primary",children:["€ ",z.discountedPrice]}),(0,r.jsxs)("span",{className:"text-sm text-gray-600 line-through",children:["€ ",z.basePrice]}),z.discountPercentage&&(0,r.jsxs)("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full",children:["-",z.discountPercentage,"%"]})]}):(0,r.jsxs)("p",{className:"text-sm font-medium text-primary",children:["€ ",z.price]}),z.paymentText&&(0,r.jsx)("p",{className:"text-xs text-foreground mt-1",children:z.paymentText})]})]})]})}),(0,r.jsxs)("form",{onSubmit:eo(el),className:"space-y-6",children:[(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Pacchetto"}),(0,r.jsxs)("select",{value:(null==z?void 0:z.id)||"",onChange:e=>{var o;let t=e.target.value;o=D.find(e=>e.id===t)||null,console.log("\uD83D\uDD04 CAMBIO PACCHETTO:",{old:null==z?void 0:z.title,new:null==o?void 0:o.title,isPromotional:null==o?void 0:o.isPromotional,shouldUsePromotionalSlots:(null==o?void 0:o.isPromotional)===!0}),O(o),er("packageId",(null==o?void 0:o.id)||""),er("date",""),er("slot",""),w(""),T([]),A([])},className:"w-full rounded-lg border border-foreground/10 bg-background/70 backdrop-blur-sm px-3.5 py-2.5 text-sm text-foreground focus:outline-none focus:ring-4 focus:ring-[rgba(var(--primary-rgb),0.15)]",children:[(0,r.jsx)("option",{value:"",children:"Seleziona un pacchetto"}),D.map(e=>{let o="";return o=e.isPromotional?"(Gratuito)":e.hasDiscount&&e.basePrice&&e.discountedPrice?"- €".concat(e.discountedPrice," (scontato da €").concat(e.basePrice,")"):"- €".concat(e.price),(0,r.jsxs)("option",{value:e.id||"",children:[e.title," ",o]},e.id)})]}),(0,r.jsx)("p",{className:"text-xs text-black mt-1",children:"Puoi cambiare pacchetto in qualsiasi momento"})]}),(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)(c.p,{label:"Nome completo *",...ee("name"),placeholder:"Il tuo nome"}),et.name&&(0,r.jsx)("p",{className:"text-destructive text-sm mt-1",children:et.name.message})]}),(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)(c.p,{label:"Email *",type:"email",...ee("email"),placeholder:"la-tua-email@esempio.com"}),et.email&&(0,r.jsx)("p",{className:"text-destructive text-sm mt-1",children:et.email.message})]}),(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)(c.p,{label:"Telefono *",...ee("phone"),placeholder:"+39 123 456 7890"}),et.phone&&(0,r.jsx)("p",{className:"text-destructive text-sm mt-1",children:et.phone.message})]}),!(es||Q)&&(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2 text-black",children:"Sede appuntamento"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",role:"group","aria-label":"Sede appuntamento",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>M("online"),"aria-pressed":"online"===R,className:"relative flex items-center gap-3 p-3 rounded-xl border-2 transition-all focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-[rgba(var(--primary-rgb),0.15)] ".concat("online"===R?"border-primary bg-primary/5 shadow-[0_0_0_3px_rgba(11,94,11,0.10)]":"border-border hover:border-primary/40"),children:[(0,r.jsx)("span",{className:"text-xl",children:"\uD83C\uDF10"}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"text-sm font-semibold ".concat("online"===R?"text-primary":"text-black"),children:"Online"}),(0,r.jsx)("div",{className:"text-[12px] text-foreground/60",children:"Videochiamata"})]})]}),(0,r.jsxs)("button",{type:"button",onClick:()=>M("studio"),"aria-pressed":"studio"===R,className:"relative flex items-center gap-3 p-3 rounded-xl border-2 transition-all focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-[rgba(var(--primary-rgb),0.15)] ".concat("studio"===R?"border-primary bg-primary/5 shadow-[0_0_0_3px_rgba(11,94,11,0.10)]":"border-border hover:border-primary/40"),children:[(0,r.jsx)("span",{className:"text-xl",children:"\uD83C\uDFE2"}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"text-sm font-semibold ".concat("studio"===R?"text-primary":"text-black"),children:"In studio"}),(0,r.jsx)("div",{className:"text-[12px] text-foreground/60",children:"Presso studio"})]})]})]}),(0,r.jsx)("p",{className:"text-xs text-black mt-2",children:"Per consultazioni gratuite la sede \xe8 sempre Online."})]}),"studio"===R&&(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2 text-black",children:"Seleziona sede"}),(0,r.jsxs)("select",{value:L,onChange:e=>{G(e.target.value),er("slot","")},className:"w-full p-3 border border-border rounded-lg bg-background text-black",children:[(0,r.jsx)("option",{value:"",children:"-- Seleziona sede --"}),H.map((e,o)=>(0,r.jsx)("option",{value:e.name,children:e.name},o))]}),""===L&&(0,r.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Seleziona una sede per visualizzare gli slot disponibili."})]}),l&&u&&!g&&(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Seleziona pacchetto"}),(0,r.jsxs)("select",{value:ea("packageId"),onChange:e=>{let o=e.target.value;er("packageId",o),O(D.find(e=>e.id===o)||null)},className:"w-full rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground",children:[(0,r.jsx)("option",{value:"",children:"Nessun pacchetto"}),D.map(e=>(0,r.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2 text-black",children:["Data * ",es&&(0,r.jsx)("span",{className:"text-green-600",children:"(Solo date con disponibilit\xe0)"})]}),(0,r.jsx)(S,{availableDates:I,selectedDate:F,onDateSelect:e=>{w(e),er("date",e),er("slot","")},showPromotionalBanner:es||!1}),et.date&&(0,r.jsx)("p",{className:"text-destructive text-sm mt-1",children:et.date.message}),0===I.length&&(0,r.jsx)("p",{className:"text-black text-sm mt-1",children:es?"Nessuna data disponibile per consultazioni gratuite":"Nessuna data disponibile per consulenze"})]}),F&&E.length>0&&(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2 text-black",children:["Orario disponibile * ",es&&(0,r.jsx)("span",{className:"text-green-600",children:"(Slot promozionali)"})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:E.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>er("slot",e),className:"p-3 border rounded-lg text-sm transition-colors ".concat(ea("slot")===e?"border-primary bg-[color:var(--secondary-bg)] text-[color:var(--secondary-fg)]":"border-border hover:border-primary/50"),children:(()=>{if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/.test(e))try{let o=new Date(e),t=String(o.getHours()).padStart(2,"0"),r=String(o.getMinutes()).padStart(2,"0");return"".concat(t,":").concat(r)}catch(e){}return e})()},e))}),et.slot&&(0,r.jsx)("p",{className:"text-destructive text-sm mt-1",children:et.slot.message})]}),(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2 text-black",children:"Parlami di te"}),(0,r.jsx)("textarea",{...ee("notes"),placeholder:"Raccontaci i tuoi obiettivi, esperienze precedenti, preferenze alimentari, eventuali limitazioni o qualsiasi altra informazione che ritieni importante per la tua consulenza...",className:"w-full rounded-lg border border-foreground/10 bg-background/70 backdrop-blur-sm px-3.5 py-2.5 text-sm text-black min-h-[120px] resize-y focus:outline-none focus:ring-4 focus:ring-[rgba(var(--primary-rgb),0.15)]",rows:5})]}),!l&&(0,r.jsx)("div",{className:"form-surface p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("input",{type:"checkbox",id:"gdprConsent",...ee("gdprConsent"),className:"mt-1 w-4 h-4 text-primary bg-background border-foreground/20 rounded focus:ring-primary focus:ring-2"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("label",{htmlFor:"gdprConsent",className:"text-sm text-black cursor-pointer",children:[(0,r.jsx)("span",{className:"font-medium",children:"Accetto il trattamento dei dati personali *"}),(0,r.jsx)("p",{className:"text-xs text-foreground/70 mt-1",children:(null==V||null==(o=V.legalInfo)?void 0:o.gdprConsentText)||"Acconsento al trattamento dei miei dati personali per la gestione della prenotazione e per ricevere comunicazioni relative al servizio, ai sensi del GDPR (Regolamento UE 2016/679). I dati saranno utilizzati esclusivamente per le finalit\xe0 indicate e non saranno comunicati a terzi."}),(0,r.jsx)("a",{href:"/privacy",className:"text-primary hover:underline text-xs mt-1 inline-block",children:"Leggi la Privacy Policy"})]}),et.gdprConsent&&(0,r.jsx)("p",{className:"text-destructive text-sm mt-1",children:et.gdprConsent.message})]})]})}),!l&&(null==V?void 0:V.recaptchaEnabled)&&(null==V?void 0:V.recaptchaSiteKey)&&(0,r.jsxs)("div",{className:"form-surface p-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2 text-black",children:"Verifica di sicurezza *"}),(0,r.jsx)(k.A,{ref:$,sitekey:V.recaptchaSiteKey,onChange:e=>{console.log("\uD83D\uDD11 CAPTCHA onChange:",e?"token ricevuto":"token null"),en()&&console.log("\uD83D\uDCF1 iOS - CAPTCHA token ricevuto"),W(e)},onExpired:()=>{console.log("⏰ CAPTCHA expired"),en()&&console.log("\uD83D\uDCF1 iOS - CAPTCHA scaduto"),W(null)},onError:e=>{console.error("❌ CAPTCHA error:",e),en()&&console.error("\uD83D\uDCF1 iOS - CAPTCHA errore:",e),W(null)},onLoad:()=>{console.log("✅ CAPTCHA loaded"),en()&&console.log("\uD83D\uDCF1 iOS - CAPTCHA caricato")}})]}),(0,r.jsxs)(s.$,{type:"submit",disabled:p||!l&&(null==V?void 0:V.recaptchaEnabled)&&!J||ei(),className:"w-full relative transition-all duration-300",style:{background:p?"linear-gradient(to right, rgba(".concat(ed.primaryRgb,", 0.8), rgba(").concat(ed.primaryRgb,", 0.9))"):"linear-gradient(to right, ".concat(ed.primary,", rgba(").concat(ed.primaryRgb,", 0.9))"),transform:p?"scale(0.98)":"scale(1)",boxShadow:p?"0 10px 20px rgba(".concat(ed.primaryRgb,", 0.3)"):"0 4px 12px rgba(".concat(ed.primaryRgb,", 0.2)")},onMouseEnter:e=>{p||(e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.boxShadow="0 15px 30px rgba(".concat(ed.primaryRgb,", 0.4)"))},onMouseLeave:e=>{p||(e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 12px rgba(".concat(ed.primaryRgb,", 0.2)"))},onMouseDown:e=>{p||(e.currentTarget.style.transform="scale(0.95)")},onMouseUp:e=>{p||(e.currentTarget.style.transform="scale(1.05)")},children:[p&&(0,r.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2",children:(0,r.jsx)("div",{className:"w-5 h-5 border-2 rounded-full animate-spin",style:{borderColor:"rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRightColor:"rgba(255, 255, 255, 0.6)"}})}),(0,r.jsx)("span",{className:"font-semibold transition-all duration-300 ".concat(p?"ml-8":""),children:ei()?"\uD83D\uDD75️ Non disponibile in modalit\xe0 incognito":p?"Invio in corso...":z?es?"Prenota Consultazione Gratuita":"Prenota Consulenza":"Invia richiesta"})]}),z&&es&&(0,r.jsx)("div",{className:"text-center text-sm text-black"})]}),p&&(0,r.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-black/40 to-black/60 backdrop-blur-md z-50 flex items-center justify-center animate-in fade-in duration-300",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl border border-gray-100 animate-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsx)("div",{className:"relative mb-6 flex justify-center",children:(0,r.jsxs)("div",{className:"relative w-16 h-16",children:[(0,r.jsx)("div",{className:"absolute inset-0 border-4 border-gray-200 rounded-full animate-spin",style:{borderTopColor:ed.primary,borderRightColor:ed.accent,borderBottomColor:"transparent",borderLeftColor:"transparent",animationDuration:"1s"}}),(0,r.jsx)("div",{className:"absolute inset-2 border-2 border-gray-100 rounded-full animate-spin",style:{borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:ed.primary,borderLeftColor:ed.accent,animationDirection:"reverse",animationDuration:"1.5s"}}),(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 w-2 h-2 rounded-full",style:{backgroundColor:ed.primary,transform:"translate(-50%, -50%)"}})]})}),(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:Q?"Consulenza Gratuita":"Nuova Prenotazione"})}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-4 animate-pulse",children:b||"Elaborazione in corso..."}),(0,r.jsx)("div",{className:"w-full bg-gray-100 rounded-full h-3 overflow-hidden shadow-inner",children:(0,r.jsx)("div",{className:"h-full rounded-full transition-all duration-700 ease-out shadow-sm relative overflow-hidden",style:{background:"linear-gradient(to right, ".concat(ed.primary,", rgba(").concat(ed.primaryRgb,", 0.8))"),width:b.includes("Preparando")?"25%":b.includes("Verificando")?"50%":b.includes("Inviando")?"75%":b.includes("Completato")||b.includes("Backup")?"100%":b.includes("Tentativo")?"90%":"15%"},children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"})})}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500 font-medium",children:[b.includes("Preparando")?"25%":b.includes("Verificando")?"50%":b.includes("Inviando")?"75%":b.includes("Completato")||b.includes("Backup")?"100%":b.includes("Tentativo")?"90%":"15%"," completato"]})]})})]})}},3998:(e,o,t)=>{t.d(o,{$:()=>l});var r=t(5155),a=t(2115),n=t(5889),i=t(2821);let l=(0,a.forwardRef)((e,o)=>{let{className:t,variant:a="primary",size:l="md",fullWidth:s,...c}=e;return(0,r.jsx)("button",{ref:o,className:(0,n.QP)((0,i.$)("btn",{primary:"btn-primary",secondary:"btn-outline",ghost:"hover:bg-[color:var(--muted-bg)]",outline:"btn-outline"}[a],{sm:"px-3 py-1 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"}[l],s&&"w-full"),t),...c})});l.displayName="Button"},4986:(e,o,t)=>{t.d(o,{J5:()=>a,v4:()=>n});let r="gznutrition_state",a=()=>{let e=new URLSearchParams(window.location.search).get("packageId");if(e){let o={selectedPackageId:e,isFreeConsultation:"free-consultation"===e};return localStorage.setItem(r,JSON.stringify(o)),o}try{let e=localStorage.getItem(r);if(e)return JSON.parse(e)}catch(e){console.error("DirectState: Errore lettura localStorage:",e)}return{selectedPackageId:null,isFreeConsultation:!1}},n=function(e){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t={selectedPackageId:e,isFreeConsultation:o};if(console.log("DirectState: Impostazione stato:",t),localStorage.setItem(r,JSON.stringify(t)),e){let o=new URL(window.location.href);o.searchParams.set("packageId",e),window.history.replaceState({},"",o.toString())}window.dispatchEvent(new CustomEvent("directStateChange",{detail:t}))}},5142:(e,o,t)=>{t.d(o,{p:()=>i});var r=t(5155),a=t(2115),n=t(5889);let i=(0,a.forwardRef)((e,o)=>{let{className:t,label:a,error:i,id:l,...s}=e,c=l||s.name||"input";return(0,r.jsxs)("div",{className:"w-full",children:[a&&(0,r.jsx)("label",{htmlFor:c,className:"block text-sm font-medium mb-1 text-foreground",children:a}),(0,r.jsx)("input",{id:c,ref:o,className:(0,n.QP)("w-full rounded-lg border border-foreground/10 bg-background/70 backdrop-blur-sm px-3.5 py-2.5 text-sm text-foreground placeholder:text-foreground/50","focus:outline-none focus:ring-4 focus:ring-[rgba(var(--primary-rgb),0.15)] focus:ring-offset-0",i&&"border-accent",t),"aria-invalid":!!i,"aria-describedby":i?"".concat(c,"-error"):void 0,...s}),i&&(0,r.jsx)("p",{id:"".concat(c,"-error"),className:"mt-1 text-xs text-destructive",children:i})]})});i.displayName="Input"},9060:(e,o,t)=>{t.d(o,{AT:()=>a,LH:()=>r});let r={"gz-default":{name:"Default",description:"Palette originale verde professionale",primary:"#0B5E0B",accent:"#00D084",background:"#FFFFFF",foreground:"#0E0F12",border:"#E2E8F0",card:"#FFFFFF",muted:"#F1F5F9",navbarBg:"rgba(0,0,0,0.8)",navbarText:"#FFFFFF",secondaryBg:"#F8FAFC",secondaryText:"#475569"},"modern-blue":{name:"Modern Blue",description:"Blu moderno e professionale",primary:"#2563EB",accent:"#3B82F6",background:"#FFFFFF",foreground:"#1E293B",border:"#E2E8F0",card:"#FFFFFF",muted:"#F1F5F9",navbarBg:"rgba(30, 41, 59, 0.9)",navbarText:"#FFFFFF",secondaryBg:"#EFF6FF",secondaryText:"#1E40AF"},"elegant-dark":{name:"Elegant Dark",description:"Elegante scuro con accenti dorati",primary:"#D97706",accent:"#F59E0B",background:"#FFFFFF",foreground:"#1F2937",border:"#E5E7EB",card:"#FFFFFF",muted:"#F9FAFB",navbarBg:"rgba(17, 24, 39, 0.95)",navbarText:"#F9FAFB",secondaryBg:"#FEF3C7",secondaryText:"#92400E"},"nature-green":{name:"Nature Green",description:"Verde naturale e rilassante",primary:"#059669",accent:"#10B981",background:"#FFFFFF",foreground:"#1F2937",border:"#D1FAE5",card:"#FFFFFF",muted:"#F0FDF4",navbarBg:"rgba(6, 78, 59, 0.9)",navbarText:"#FFFFFF",secondaryBg:"#ECFDF5",secondaryText:"#047857"},"warm-orange":{name:"Warm Orange",description:"Arancione caldo ed energico",primary:"#EA580C",accent:"#FB923C",background:"#FFFFFF",foreground:"#1C1917",border:"#E7E5E4",card:"#FFFFFF",muted:"#FAFAF9",navbarBg:"rgba(124, 45, 18, 0.9)",navbarText:"#FFFFFF",secondaryBg:"#FED7AA",secondaryText:"#C2410C"},"professional-gray":{name:"Professional Gray",description:"Grigio professionale e neutro",primary:"#374151",accent:"#6B7280",background:"#FFFFFF",foreground:"#111827",border:"#E5E7EB",card:"#FFFFFF",muted:"#F9FAFB",navbarBg:"rgba(17, 24, 39, 0.9)",navbarText:"#F9FAFB",secondaryBg:"#F3F4F6",secondaryText:"#374151"}};function a(e){return r[e]||r["gz-default"]}}}]);